import{c as Z,r as s,h as I,j as e,t as E,B as w}from"./app-Lw9toWEL.js";import{I as F}from"./input-yF94Vncd.js";import{C as K}from"./checkbox-Dh6dZe4H.js";import{p as ee}from"./purify.es-HRjpPm7y.js";import{C as te}from"./circle-check-big-ZA6qdrqv.js";import{C as P}from"./check-DtvS8aN0.js";const se=[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]],R=Z("PenLine",se);function ne(n){const a=/\{\{CLIENT_INITIALS\}\}/gi,i=n.match(a);if(!i)return[];const l=i.length,r=[];for(let o=0;o<l;o++)r.push({sectionKey:`section_${o+1}`,sectionTitle:`Section ${o+1}`,sectionSummary:"",orderIndex:o});return r}function re(n){return ne(n).map(i=>i.sectionKey)}function V(n,a,i){const l=i?n.indexOf(i):-1;for(let r=l+1;r<n.length;r++)if(!a[n[r]])return n[r];return null}function ie(n,a,i){const l=n.length,r=n.filter(c=>!!a[c]).length,o=r===l&&l>0,_=o&&i;let f="";return o?i?f="Agreement complete":f="All sections initialed - signature required":f=`${r} of ${l} sections initialed`,{requiredInitials:l,completedInitials:r,allInitialsComplete:o,hasSignature:i,isFullyComplete:_,progressText:f}}const q=[{name:"Dancing Script",className:"font-dancing"},{name:"Great Vibes",className:"font-great-vibes"},{name:"Pacifico",className:"font-pacifico"},{name:"Satisfy",className:"font-satisfy"}];function ue({agreementContent:n,defaultInitials:a,defaultSignatureName:i,onComplete:l,onBack:r,showBackButton:o=!0,initialSectionInitials:_={},initialSignature:f=""}){const c=re(n),[m,B]=s.useState(_),[N,y]=s.useState(null),[p,A]=s.useState(a),[b,M]=s.useState(q[0]),[v,z]=s.useState(!1),[S,T]=s.useState(!1),[h,O]=s.useState(i),[C,U]=s.useState(!1),L=s.useRef({}),k=s.useRef(null),d=ie(c,m,!!f);s.useEffect(()=>{d.allInitialsComplete&&!S&&(T(!0),I.success("All sections initialed! Please sign below."),setTimeout(()=>{k.current?.scrollIntoView({behavior:"smooth",block:"center"})},200))},[d.allInitialsComplete,S]);const D=s.useCallback(()=>{const t=V(c,m);t?(y(t),A(a),setTimeout(()=>{L.current[t]?.scrollIntoView({behavior:"smooth",block:"center"})},100)):(T(!0),setTimeout(()=>{k.current?.scrollIntoView({behavior:"smooth",block:"center"})},100))},[c,m,a]),G=s.useCallback(t=>{m[t]||(y(t),A(a))},[m,a]),H=s.useCallback(()=>{if(!N||!p.trim())return;const t=`${p}|${b.className}`,g={...m,[N]:t};B(g),v||z(!0);const u=V(c,g,N);u?(y(u),I.info(`Section initialed. ${c.length-Object.keys(g).length} remaining.`),setTimeout(()=>{L.current[u]?.scrollIntoView({behavior:"smooth",block:"center"})},150)):(y(null),T(!0),I.success("All sections initialed! Please sign below."),setTimeout(()=>{k.current?.scrollIntoView({behavior:"smooth",block:"center"})},150))},[N,p,b.className,v,c,m]),J=s.useCallback(()=>{if(!C){I.error("Please agree to the electronic signature terms");return}if(!h.trim()||h.trim().length<2){I.error("Please enter your full legal name");return}const t=`${h}|${b.className}`;l({sectionInitials:m,signature:t,signedAt:new Date})},[C,h,b.className,m,l]),Q=(t,g)=>{const u=m[t],$=N===t,[j,Y]=u?u.split("|"):["",""];return e.jsx("div",{ref:x=>{L.current[t]=x},className:"my-4 p-3 bg-primary/10 border border-primary/30 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Section ",g+1," - Client Initials Required:"]})}),u?e.jsxs("div",{className:`w-20 h-12 bg-primary/20 border-2 border-primary rounded flex items-center justify-center text-lg text-primary ${Y}`,children:[j,e.jsx(P,{className:"h-3 w-3 ml-1 text-green-500"})]}):$?e.jsxs("div",{className:"bg-background border-2 border-primary rounded p-3 min-w-[200px]",children:[e.jsx(F,{value:p,onChange:x=>A(x.target.value.toUpperCase()),className:"text-center text-lg mb-2",placeholder:"Initials",autoFocus:!0,maxLength:4}),!v&&e.jsx("div",{className:"grid grid-cols-2 gap-1 mb-2",children:q.map(x=>e.jsx("button",{onClick:()=>M(x),className:`p-2 text-sm border rounded ${x.className} ${b.name===x.name?"border-primary bg-primary/10":"border-border hover:border-primary/50"}`,children:p||"AB"},x.name))}),v&&e.jsx("div",{className:`text-center text-2xl mb-2 ${b.className}`,children:p||"AB"}),e.jsxs(w,{size:"sm",onClick:H,className:"w-full",disabled:!p.trim(),children:[e.jsx(P,{className:"h-4 w-4 mr-1"})," Confirm Initials"]})]}):e.jsxs("button",{onClick:()=>G(t),className:"w-20 h-12 border-2 border-dashed border-primary/50 rounded flex items-center justify-center text-xs text-primary/70 hover:border-primary hover:bg-primary/5 transition-colors cursor-pointer",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),"Initial"]})]})},t)},W=()=>{const t=/\{\{CLIENT_INITIALS\}\}/gi,g=n.split(t),u=g.length-1;return e.jsx("div",{className:"max-w-none agreement-content prose [&_p]:my-2 [&_p:empty]:min-h-[1.6em] [&_h1]:mt-6 [&_h1]:mb-3 [&_h1]:text-2xl [&_h1]:font-bold [&_h2]:mt-5 [&_h2]:mb-2 [&_h2]:text-lg [&_h2]:font-semibold [&_h3]:mt-4 [&_h3]:mb-2 [&_hr]:my-6 [&_hr]:border-border [&_strong]:font-semibold [&_br]:block",children:g.map(($,j)=>e.jsxs("div",{children:[e.jsx("div",{dangerouslySetInnerHTML:{__html:ee.sanitize($)},className:"prose-content"}),j<u&&Q(c[j],j)]},j))})},X=d.allInitialsComplete&&C&&h.trim().length>=2;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[d.allInitialsComplete?e.jsx(te,{className:"h-5 w-5 text-green-500"}):e.jsx(E,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:d.progressText})]}),!N&&!S&&c.length>0&&e.jsxs(w,{onClick:D,size:"sm",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Start Signing"]})]}),e.jsxs("div",{className:"bg-background/50 border border-border rounded-lg p-6 max-h-[600px] overflow-y-auto text-sm leading-relaxed",children:[W(),e.jsxs("div",{ref:k,className:`border-t-2 border-primary pt-8 mt-8 transition-opacity duration-300 ${S||d.allInitialsComplete?"opacity-100":"opacity-50"}`,children:[e.jsx("h2",{className:"font-display font-bold text-lg text-foreground mb-6 text-center",children:"ELECTRONIC SIGNATURE"}),d.allInitialsComplete?e.jsxs("div",{className:"space-y-6 max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-start space-x-3 p-4 bg-muted/50 rounded-lg",children:[e.jsx(K,{id:"esign-agreement",checked:C,onCheckedChange:t=>U(t===!0),className:"mt-0.5"}),e.jsx("label",{htmlFor:"esign-agreement",className:"text-sm leading-relaxed cursor-pointer",children:"I agree that my electronic signature is the legal equivalent of my manual signature on this agreement. By checking this box and typing my name below, I am signing this Master Services Agreement."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Type your full legal name to sign:"}),e.jsx(F,{value:h,onChange:t=>O(t.target.value),placeholder:"Full Legal Name",className:"text-center text-lg"}),h&&e.jsx("div",{className:"text-center py-4 border-b-2 border-foreground/30",children:e.jsx("span",{className:`text-3xl ${b.className}`,children:h})})]}),e.jsxs(w,{onClick:J,disabled:!X,className:"w-full",size:"lg",children:[e.jsx(R,{className:"h-5 w-5 mr-2"}),"Sign Agreement"]})]}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(E,{className:"h-8 w-8 mx-auto mb-3 text-muted-foreground/50"}),e.jsx("p",{children:"Please complete all required initials above to unlock the signature section."}),e.jsxs("p",{className:"text-sm mt-2",children:[d.completedInitials," of ",d.requiredInitials," sections complete"]})]})]})]}),o&&r&&e.jsx("div",{className:"flex justify-start",children:e.jsx(w,{variant:"outline",onClick:r,children:"Back"})})]})}export{ue as A};
