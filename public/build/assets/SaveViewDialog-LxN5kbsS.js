import{c as $,r,q as A,f as P,j as n,B as D}from"./app-DpPlT-lI.js";import{D as I,a as H,c as L,d as M,e as R,f as T}from"./dialog-GbyeoWks.js";import{I as B}from"./input-Zg97uL99.js";import{L as N}from"./label-CelXGX25.js";import{C as q}from"./checkbox-CQjUFhCO.js";const z=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],X=$("Save",z);function G(l){return{columnOrder:l.defaultColumnOrder,hiddenColumns:[],columnWidths:{},sortColumn:l.defaultSortColumn||"name",sortDirection:l.defaultSortDirection||"asc",activeFilters:{},rowsPerPage:50,savedViews:[],activeViewName:null,defaultViewName:null}}function Z(l){const u=G(l),[s,w]=r.useState(u),[m,C]=r.useState(!0),[V,v]=r.useState(!1),{toast:o}=A(),f=r.useCallback(async()=>{try{const e=await P.get(`/api/view-preferences/${l.tableName}`);if(e){const t=e.saved_views||[],i=e.default_view_name,d=i?t.find(h=>h.name===i):null;w(d?{columnOrder:d.columnOrder,hiddenColumns:d.hiddenColumns,columnWidths:d.columnWidths,sortColumn:d.sortColumn,sortDirection:d.sortDirection,activeFilters:d.activeFilters,rowsPerPage:e.rows_per_page||50,savedViews:t,activeViewName:i,defaultViewName:i}:{columnOrder:e.column_order||l.defaultColumnOrder,hiddenColumns:e.hidden_columns||[],columnWidths:e.column_widths||{},sortColumn:e.sort_column||l.defaultSortColumn||"name",sortDirection:e.sort_direction||l.defaultSortDirection||"asc",activeFilters:e.active_filters||{},rowsPerPage:e.rows_per_page||50,savedViews:t,activeViewName:e.active_view_name||null,defaultViewName:i})}}catch(e){console.error("Error loading preferences:",e)}finally{C(!1)}},[l.tableName,l.defaultColumnOrder,l.defaultSortColumn,l.defaultSortDirection]);r.useEffect(()=>{f()},[f]);const a=r.useCallback(async e=>{v(!0);try{const t={...s,...e};w(t);const i={column_order:t.columnOrder,hidden_columns:t.hiddenColumns,column_widths:t.columnWidths,sort_column:t.sortColumn,sort_direction:t.sortDirection,active_filters:t.activeFilters,rows_per_page:t.rowsPerPage,saved_views:t.savedViews,active_view_name:t.activeViewName,default_view_name:t.defaultViewName};await P.post(`/api/view-preferences/${l.tableName}`,i)}catch(t){console.error("Error saving preferences:",t),o({title:"Error",description:"Failed to save view preferences",variant:"destructive"})}finally{v(!1)}},[s,o,l.tableName]),p=r.useCallback(e=>{a({columnOrder:e})},[a]),c=r.useCallback(e=>{const t=s.hiddenColumns.includes(e)?s.hiddenColumns.filter(i=>i!==e):[...s.hiddenColumns,e];a({hiddenColumns:t})},[s.hiddenColumns,a]),_=r.useCallback((e,t)=>{a({columnWidths:{...s.columnWidths,[e]:t}})},[s.columnWidths,a]),g=r.useCallback((e,t)=>{a({sortColumn:e,sortDirection:t})},[a]),y=r.useCallback((e,t)=>{const i={...s.activeFilters};t?i[e]=t:delete i[e],a({activeFilters:i})},[s.activeFilters,a]),b=r.useCallback(()=>{a({activeFilters:{}})},[a]),k=r.useCallback(e=>{a({rowsPerPage:e})},[a]),S=r.useCallback((e,t=!1)=>{const i=s.savedViews.findIndex(x=>x.name===e);if(i>=0&&!t)return o({title:"Name already exists",description:`A view named "${e}" already exists. Please choose a different name.`,variant:"destructive"}),!1;if(i<0&&s.savedViews.length>=3)return o({title:"View limit reached",description:"You can save up to 3 views. Please delete an existing view first.",variant:"destructive"}),!1;const d={name:e,columnOrder:s.columnOrder,hiddenColumns:s.hiddenColumns,columnWidths:s.columnWidths,sortColumn:s.sortColumn,sortDirection:s.sortDirection,activeFilters:s.activeFilters,rowsPerPage:s.rowsPerPage},h=i>=0?s.savedViews.map((x,E)=>E===i?d:x):[...s.savedViews,d];return a({savedViews:h,activeViewName:e}),o({title:"View saved",description:`"${e}" has been saved`}),!0},[s,a,o]),F=r.useCallback(e=>{const t=s.savedViews.find(i=>i.name===e);t&&a({columnOrder:t.columnOrder,hiddenColumns:t.hiddenColumns,columnWidths:t.columnWidths,sortColumn:t.sortColumn,sortDirection:t.sortDirection,activeFilters:t.activeFilters,rowsPerPage:t.rowsPerPage??s.rowsPerPage,activeViewName:e})},[s.savedViews,s.rowsPerPage,a]),j=r.useCallback(e=>{const t=s.savedViews.filter(h=>h.name!==e),i=s.activeViewName===e?null:s.activeViewName,d=s.defaultViewName===e?null:s.defaultViewName;a({savedViews:t,activeViewName:i,defaultViewName:d}),o({title:"View deleted",description:`"${e}" has been deleted`})},[s.savedViews,s.activeViewName,s.defaultViewName,a,o]),W=r.useCallback(e=>{a({defaultViewName:e}),o(e?{title:"Default view set",description:`"${e}" will load automatically`}:{title:"Default view cleared",description:"No view will load automatically"})},[a,o]),O=r.useCallback(()=>{a(u),o({title:"Reset complete",description:"View reset to default settings"})},[a,o,u]);return{preferences:s,loading:m,saving:V,setColumnOrder:p,toggleColumnVisibility:c,setColumnWidth:_,setSort:g,setFilter:y,clearFilters:b,setRowsPerPage:k,saveView:S,loadView:F,deleteView:j,setDefaultView:W,resetToDefault:O}}function ee({open:l,onOpenChange:u,onSave:s,existingViewNames:w,defaultName:m=""}){const[C,V]=r.useState(m),[v,o]=r.useState(!1),[f,a]=r.useState("");r.useEffect(()=>{l&&(V(m),o(!1),a(""))},[l,m]);const p=()=>{const c=C.trim();if(!c){a("Please enter a name for the view");return}if(w.includes(c)&&c!==m){a("A view with this name already exists");return}s(c,v),u(!1)};return n.jsx(I,{open:l,onOpenChange:u,children:n.jsxs(H,{className:"sm:max-w-md",children:[n.jsxs(L,{children:[n.jsx(M,{children:"Save Custom View"}),n.jsx(R,{children:"Give your view a name to save your current column settings, filters, and sort order."})]}),n.jsxs("div",{className:"space-y-4 py-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(N,{htmlFor:"view-name",children:"View Name"}),n.jsx(B,{id:"view-name",value:C,onChange:c=>{V(c.target.value),a("")},placeholder:"Enter view name",onKeyDown:c=>{c.key==="Enter"&&p()}}),f&&n.jsx("p",{className:"text-sm text-destructive",children:f})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(q,{id:"set-default",checked:v,onCheckedChange:c=>o(c===!0)}),n.jsx(N,{htmlFor:"set-default",className:"text-sm font-normal cursor-pointer",children:"Set as default view (loads automatically)"})]})]}),n.jsxs(T,{children:[n.jsx(D,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),n.jsx(D,{onClick:p,children:"Save View"})]})]})})}export{X as S,ee as a,Z as u};
