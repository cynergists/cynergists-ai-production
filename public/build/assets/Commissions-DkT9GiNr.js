import{ba as R,r as o,q as B,s as H,j as e,g as b,aN as k,R as N,V as U,K as m,e as V,C as q}from"./app-yl1YHj2k.js";import{I as Q}from"./input-B3tD5KH9.js";import{C as l,b as x,c as u,a as n,d as W}from"./card-Dxx2nlaR.js";import{T as Y,a as K,b as w,c as t,d as $,e as r}from"./table-Digz5nhl.js";import{S as z,a as G,b as J,c as O,d}from"./select-bZyWIIk8.js";import{S as X}from"./skeleton-CoYTk_MQ.js";import{C as y}from"./circle-check-CXfnWLUV.js";import{F as Z}from"./filter-DvbsL620.js";import{T as ee}from"./triangle-alert-SZFjwlm_.js";/* empty css            */import"./index-BdQq_4o_.js";import"./index-KgiDK8vA.js";import"./Combination-BU6xJxfT.js";import"./index-B4oGC8tk.js";import"./check-3ows1Yys.js";import"./chevron-up-CP4UIDax.js";const C={pending:{label:"Pending",icon:b,className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",description:"In clawback window"},earned:{label:"Earned",icon:y,className:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",description:"Clawback window passed"},payable:{label:"Payable",icon:k,className:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",description:"Ready for next payout"},paid:{label:"Paid",icon:y,className:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400",description:"Commission paid out"},clawed_back:{label:"Clawed Back",icon:ee,className:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",description:"Refund within 30 days"},disputed:{label:"Disputed",icon:U,className:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400",description:"Under review"}};function ge(){const{partner:h}=R(),[i,v]=o.useState([]),[_,S]=o.useState(!0),[j,M]=o.useState(""),[g,D]=o.useState("all"),{toast:P}=B();o.useEffect(()=>{T()},[h?.id]);const T=async()=>{if(h?.id)try{const{data:s,error:a}=await H.from("partner_commissions").select(`
          *,
          customer:clients!partner_commissions_customer_id_fkey(name, company)
        `).eq("partner_id",h.id).order("created_at",{ascending:!1});if(a)throw a;v(s||[])}catch(s){console.error("Error fetching commissions:",s),P({title:"Error",description:"Failed to load commissions",variant:"destructive"})}finally{S(!1)}},c=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(s),p=i.filter(s=>{const a=g==="all"||s.status===g,f=!j||s.customer?.name?.toLowerCase().includes(j.toLowerCase())||s.customer?.company?.toLowerCase().includes(j.toLowerCase());return a&&f}),I=i.filter(s=>s.status==="pending").reduce((s,a)=>s+a.net_amount,0),A=i.filter(s=>s.status==="earned").reduce((s,a)=>s+a.net_amount,0),E=i.filter(s=>s.status==="payable").reduce((s,a)=>s+a.net_amount,0),F=i.filter(s=>s.status==="paid").reduce((s,a)=>s+a.net_amount,0);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Commissions"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track your earnings from referred deals"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(l,{children:[e.jsx(x,{className:"pb-2",children:e.jsxs(u,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4"}),"Pending"]})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:c(I)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"In 30-day clawback window"})]})]}),e.jsxs(l,{children:[e.jsx(x,{className:"pb-2",children:e.jsxs(u,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),"Earned"]})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:c(A)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Ready to be batched"})]})]}),e.jsxs(l,{children:[e.jsx(x,{className:"pb-2",children:e.jsxs(u,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),"Payable"]})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:c(E)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"In next payout"})]})]}),e.jsxs(l,{children:[e.jsx(x,{className:"pb-2",children:e.jsxs(u,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4"}),"Total Paid"]})}),e.jsxs(n,{children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:c(F)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Lifetime earnings"})]})]})]}),e.jsx(l,{children:e.jsx(n,{className:"py-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Q,{placeholder:"Search by customer...",value:j,onChange:s=>M(s.target.value),className:"max-w-sm"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Your rate: ",e.jsxs("span",{className:"font-semibold text-foreground",children:[Math.round((h?.commission_rate||.2)*100),"%"]})]}),e.jsxs(z,{value:g,onValueChange:D,children:[e.jsxs(G,{className:"w-[180px]",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),e.jsx(J,{placeholder:"Filter by status"})]}),e.jsxs(O,{children:[e.jsx(d,{value:"all",children:"All Status"}),e.jsx(d,{value:"pending",children:"Pending"}),e.jsx(d,{value:"earned",children:"Earned"}),e.jsx(d,{value:"payable",children:"Payable"}),e.jsx(d,{value:"paid",children:"Paid"}),e.jsx(d,{value:"clawed_back",children:"Clawed Back"}),e.jsx(d,{value:"disputed",children:"Disputed"})]})]})]})]})})}),e.jsxs(l,{children:[e.jsxs(x,{children:[e.jsx(u,{children:"Commission History"}),e.jsxs(W,{children:[p.length," commission",p.length!==1?"s":""," found"]})]}),e.jsx(n,{children:_?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,a)=>e.jsx(X,{className:"h-16 w-full"},a))}):p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No commissions yet"}),e.jsx("p",{className:"text-muted-foreground",children:"You'll earn commissions when your referred deals close and payments are captured."})]}):e.jsxs(Y,{children:[e.jsx(K,{children:e.jsxs(w,{children:[e.jsx(t,{children:"Earned"}),e.jsx(t,{children:"Customer"}),e.jsx(t,{className:"text-right",children:"Basis"}),e.jsx(t,{className:"text-right",children:"Rate"}),e.jsx(t,{className:"text-right",children:"Commission"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Payable At"}),e.jsx(t,{children:"Clawback Until"}),e.jsx(t,{children:"Paid At"})]})}),e.jsx($,{children:p.map(s=>{const a=C[s.status]||C.pending,f=a.icon,L=s.clawback_eligible_until&&new Date(s.clawback_eligible_until)>new Date;return e.jsxs(w,{children:[e.jsx(r,{children:e.jsx("span",{className:"text-sm",children:s.earned_at?m(new Date(s.earned_at),"MMM d, yyyy"):m(new Date(s.created_at),"MMM d, yyyy")})}),e.jsx(r,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.customer?.name||"-"}),s.customer?.company&&e.jsx("div",{className:"text-xs text-muted-foreground",children:s.customer.company})]})}),e.jsx(r,{className:"text-right",children:e.jsx("span",{className:"text-muted-foreground",children:c(s.gross_amount)})}),e.jsx(r,{className:"text-right",children:e.jsxs("span",{className:"text-sm",children:[Math.round(s.commission_rate*100),"%"]})}),e.jsx(r,{className:"text-right",children:e.jsx("span",{className:"font-semibold text-foreground",children:c(s.net_amount)})}),e.jsx(r,{children:e.jsxs(V,{className:a.className,children:[e.jsx(f,{className:"h-3 w-3 mr-1"}),a.label]})}),e.jsx(r,{children:s.payable_at?e.jsx("span",{className:"text-sm text-muted-foreground",children:m(new Date(s.payable_at),"MMM d, yyyy")}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"—"})}),e.jsx(r,{children:s.clawback_eligible_until?e.jsx("span",{className:`text-sm ${L?"text-yellow-600":"text-muted-foreground"}`,children:m(new Date(s.clawback_eligible_until),"MMM d, yyyy")}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"—"})}),e.jsx(r,{children:s.paid_at?e.jsx("span",{className:"text-sm text-emerald-600",children:m(new Date(s.paid_at),"MMM d, yyyy")}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"—"})})]},s.id)})})]})})]}),e.jsx(l,{children:e.jsx(n,{className:"py-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-yellow-100 dark:bg-yellow-900/30 flex items-center justify-center flex-shrink-0",children:e.jsx(b,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"30-Day Clawback Window"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:'Commissions remain in "earned" status for 30 days after payment capture. If a refund occurs during this period, the commission is clawed back.'})]})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center flex-shrink-0",children:e.jsx(q,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Monthly Payouts"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Commissions earned by the 15th are paid on the 1st of the following month. Commissions earned after the 15th are paid the month after."})]})]})]})})})]})}export{ge as default};
