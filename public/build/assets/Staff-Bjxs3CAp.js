import{c as De,d as Ae,au as me,s as se,U as Ne,V as te,j as e,r as c,aP as Pe,p as Te,X as ke,g as Fe,k as oe,a as Ee,m as We,B as D,n as ue,T as Le,H as Ve,I as Oe,P as $e}from"./app-CjsYDFmT.js";import{I as x}from"./input-BBc2sdOt.js";import{P as Me,a as qe,b as Ie}from"./popover-BUPp5UYr.js";import{P as ze,a as Re,b as be,c as Ue,d as Be,e as He}from"./pagination-C5ybOfNz.js";import{S as A,a as P,b as T,c as E,d as o}from"./select-BZPifpxC.js";import{L as d}from"./label-Dvt0WIie.js";import{u as we}from"./useMutation-BrlSJFFx.js";import{u as Qe,S as Xe,a as Ge}from"./SaveViewDialog-D1UsRP9Z.js";import{C as Ye,a as Je}from"./card-Dz0yCaqc.js";import{U as Ze}from"./user-check-DpoP4Pqi.js";import{C as U}from"./CenteredDash-BzJmr0us.js";import{G as Ke}from"./grip-vertical-DDkZaat0.js";import{C as et}from"./check-BI7rB0RY.js";import{A as tt,a as st}from"./arrow-up-DJINd2l-.js";import{A as at}from"./arrow-down-CbLyxnD-.js";import{S as nt,a as rt,b as lt,c as it}from"./sheet-CaiYAMvK.js";import{P as ot}from"./phone-input-sSB_-G2z.js";import{T as Se}from"./textarea-DjNE0yWa.js";import{S as ne}from"./separator-Ve78g3In.js";import{f as ct}from"./errorMessages-9RXyVjba.js";import{u as dt}from"./useAutoSave-u9daHYak.js";import{A as ut,h as mt,a as ht,b as pt,c as xt,d as yt,e as jt,f as _t,g as vt}from"./alert-dialog-DYk0FKt6.js";import{T as gt,a as ft,b as ce,c as de}from"./tabs-B8c6-nWx.js";import{B as bt}from"./building-2-D1jCYprO.js";import{F as Nt}from"./filter-fyqNCUYX.js";/* empty css            */import"./Combination-Mg1W9W58.js";import"./index-BdQq_4o_.js";import"./index-G0k2b-8C.js";import"./index-BSKaJvun.js";import"./chevron-up-CP4nq72x.js";import"./index-CSw9D2VK.js";import"./dialog-vfH9N2qe.js";import"./index-58Jk2LJy.js";import"./checkbox-DEKwJfYN.js";import"./index-DT8TtvXW.js";import"./index-Dgr0VTlB.js";import"./index-CHEq1ta4.js";const wt=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Ct=De("UserX",wt);function St(s){return Ae({queryKey:["staff",s],queryFn:async()=>{let u=se.from("staff").select("*").order("name",{ascending:!0});const{data:j,error:y}=await u;if(y)throw y;return j}})}function kt(){const s=me();return we({mutationFn:async u=>{const{data:j,error:y}=await se.from("staff").insert(u).select().single();if(y)throw y;return j},onSuccess:()=>{s.invalidateQueries({queryKey:["staff"]})}})}function Ft(){const s=me();return we({mutationFn:async({id:u,...j})=>{const{data:y,error:f}=await se.from("staff").update(j).eq("id",u).select().single();if(f)throw f;return y},onSuccess:()=>{s.invalidateQueries({queryKey:["staff"]})}})}function Dt(){const s=me();return we({mutationFn:async u=>{const{error:j}=await se.from("staff").delete().eq("id",u);if(j)throw j},onSuccess:()=>{s.invalidateQueries({queryKey:["staff"]})}})}const At=["name","email","phone","status","staff_type","employment_type","pay_type","pay_rate","commission_type","commission_rate","start_date","end_date"];function Pt(){return Qe({tableName:"staff_view_preferences",defaultColumnOrder:At,defaultSortColumn:"name",defaultSortDirection:"asc"})}function Tt({staff:s}){const u=s.length,j=s.filter(h=>h.status==="active").length,y=s.filter(h=>h.status==="inactive").length,f=s.filter(h=>h.status==="active").reduce((h,V)=>h+(V.monthly_pay||0),0),L=[{label:"Total Staff",value:u,icon:Ne,color:"text-blue-500"},{label:"Active",value:j,icon:Ze,color:"text-green-500"},{label:"Inactive",value:y,icon:Ct,color:"text-muted-foreground"},{label:"Active Monthly Payroll",value:`$${f.toLocaleString()}`,icon:te,color:"text-primary"}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:L.map(h=>e.jsx(Ye,{children:e.jsx(Je,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h.icon,{className:`h-8 w-8 ${h.color}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:h.value}),e.jsx("p",{className:"text-sm text-muted-foreground",children:h.label})]})]})})},h.label))})}const Et=[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}],re={name:{key:"name",label:"Name",sortable:!0,minWidth:120,defaultWidth:180,editable:!1},title:{key:"title",label:"Title",sortable:!0,minWidth:100,defaultWidth:150,editable:!0,editType:"text",render:s=>s.title||e.jsx(U,{})},status:{key:"status",label:"Status",sortable:!0,minWidth:80,defaultWidth:120,centered:!0,editable:!0,editType:"select",render:s=>{const u=s.status||"inactive",j=u==="active"?"default":"secondary";return e.jsx(Fe,{variant:j,children:u.charAt(0).toUpperCase()+u.slice(1)})}},start_date:{key:"start_date",label:"Start Date",sortable:!0,minWidth:100,defaultWidth:120,centered:!0,editable:!0,editType:"date",render:s=>s.start_date?Te(s.start_date):e.jsx(U,{})},hourly_pay:{key:"hourly_pay",label:"Hourly Pay",sortable:!0,minWidth:100,defaultWidth:120,centered:!0,editable:!0,editType:"number",render:s=>s.hourly_pay?`$${s.hourly_pay.toFixed(2)}`:e.jsx(U,{})},hours_per_week:{key:"hours_per_week",label:"Hours/Week",sortable:!0,minWidth:100,defaultWidth:120,centered:!0,editable:!0,editType:"number",render:s=>s.hours_per_week??e.jsx(U,{})},commission_percent:{key:"commission_percent",label:"Commission",sortable:!0,minWidth:100,defaultWidth:110,centered:!0,editable:!0,editType:"number",render:s=>s.commission_percent?Pe(s.commission_percent):e.jsx(U,{})},total_clients:{key:"total_clients",label:"Clients",sortable:!0,minWidth:80,defaultWidth:100,centered:!0,editable:!0,editType:"number",render:s=>s.total_clients??e.jsx(U,{})},monthly_pay:{key:"monthly_pay",label:"Monthly",sortable:!0,minWidth:100,defaultWidth:120,centered:!0,editable:!0,editType:"number",render:s=>s.monthly_pay?`$${s.monthly_pay.toFixed(2)}`:e.jsx(U,{})}},Wt=["name","title","status","start_date","hourly_pay","hours_per_week","commission_percent","total_clients","monthly_pay"];function Lt({staff:s,onSelectStaff:u,onAddNew:j,onStaffUpdated:y}){const[f,L]=c.useState(""),[h,V]=c.useState("name"),[S,t]=c.useState("asc"),[B]=c.useState(Wt),[i,G]=c.useState({}),O=B.filter(n=>re[n]),[ae,H]=c.useState(null),[Y,w]=c.useState({}),$=c.useRef(0),Q=c.useRef(0),[M,b]=c.useState(null),[k,C]=c.useState(null),[a,_]=c.useState(null),[v,q]=c.useState(""),[I,J]=c.useState(!1),he=[...s].filter(n=>{if(!f)return!0;const r=f.toLowerCase();return n.name.toLowerCase().includes(r)||n.title?.toLowerCase().includes(r)||n.email?.toLowerCase().includes(r)}).sort((n,r)=>{const p=n[h],m=r[h];if(typeof p=="number"&&typeof m=="number")return S==="asc"?p-m:m-p;const N=String(p||"").localeCompare(String(m||""));return S==="asc"?N:-N}),le=n=>{h===n?t(S==="asc"?"desc":"asc"):(V(n),t("asc"))},z=n=>Y[n]!==void 0?Y[n]:i[n]||re[n]?.defaultWidth||150,X=c.useCallback((n,r)=>{n.preventDefault(),n.stopPropagation(),H(r),$.current=n.clientX,Q.current=i[r]||re[r]?.defaultWidth||150;const p=N=>{const F=N.clientX-$.current,R=Math.max(20,Q.current+F);w(g=>({...g,[r]:R}))},m=N=>{const F=N.clientX-$.current,R=Math.max(20,Q.current+F);G(g=>({...g,[r]:R})),w(g=>{const ge={...g};return delete ge[r],ge}),H(null),document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",m)};document.addEventListener("mousemove",p),document.addEventListener("mouseup",m)},[i]),pe=c.useCallback((n,r)=>{b(r),n.dataTransfer.effectAllowed="move",n.dataTransfer.setData("text/plain",r)},[]),xe=c.useCallback((n,r)=>{n.preventDefault(),n.dataTransfer.dropEffect="move",M&&r!==M&&C(r)},[M]),ie=c.useCallback(()=>{C(null)},[]),ye=c.useCallback((n,r)=>{n.preventDefault(),b(null),C(null)},[]),je=c.useCallback(()=>{b(null),C(null)},[]),_e=(n,r,p)=>{_({staffId:n,field:r}),q(p?.toString()||"")},Z=()=>{_(null),q("")},K=async(n,r)=>{if(!I){J(!0);try{const p=["hourly_pay","hours_per_week","monthly_pay","commission_percent","quota","total_clients","monthly_revenue"];let m=v||null;p.includes(r)&&v&&(m=parseFloat(v));const{error:N}=await se.from("staff").update({[r]:m}).eq("id",n);if(N)throw N;oe.success("Staff updated"),_(null),q(""),y?.()}catch{oe.error("Failed to update staff")}finally{J(!1)}}},ve=(n,r,p)=>{n.key==="Enter"?(n.preventDefault(),K(r,p)):n.key==="Escape"&&Z()},ee=async(n,r,p)=>{if(!I){J(!0);try{const{error:m}=await se.from("staff").update({[r]:p}).eq("id",n);if(m)throw m;oe.success("Staff updated"),_(null),y?.()}catch{oe.error("Failed to update staff")}finally{J(!1)}}},l=({column:n})=>h!==n?e.jsx(tt,{className:"h-4 w-4 ml-1 opacity-50 flex-shrink-0"}):S==="asc"?e.jsx(st,{className:"h-4 w-4 ml-1 flex-shrink-0"}):e.jsx(at,{className:"h-4 w-4 ml-1 flex-shrink-0"});return s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:[e.jsx("p",{children:"No staff members yet"}),e.jsx("p",{className:"text-sm",children:"Add your first employee to get started"})]}):e.jsx("div",{className:"relative",children:e.jsxs("table",{style:{tableLayout:"fixed",width:"max-content",minWidth:"100%"},className:"w-full caption-bottom text-sm",children:[e.jsx("thead",{className:"[&_tr]:border-b sticky top-0 z-20",children:e.jsx("tr",{className:"border-b transition-colors bg-background",children:O.map((n,r)=>{const p=re[n],m=z(n),N=M===n,F=k===n,R=r===0;return e.jsxs("th",{className:`h-12 px-4 text-left align-middle font-medium text-muted-foreground bg-background relative group transition-all ${N?"opacity-50":""} ${F?"bg-primary/10 border-l-2 border-primary":""} ${R?"sticky left-0 z-30 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]":""}`,style:{width:`${m}px`,minWidth:"20px"},draggable:!0,onDragStart:g=>pe(g,n),onDragOver:g=>xe(g,n),onDragLeave:ie,onDrop:g=>ye(g,n),onDragEnd:je,children:[e.jsxs("div",{className:`flex items-start pr-3 ${p.sortable?"cursor-pointer select-none hover:text-foreground":""}`,onClick:()=>p.sortable&&le(n),children:[e.jsx(Ke,{className:"h-4 w-4 mr-1 opacity-30 group-hover:opacity-70 cursor-grab flex-shrink-0 mt-0.5"}),e.jsx("span",{style:{wordBreak:"keep-all",overflowWrap:"normal",whiteSpace:"normal"},children:p.label}),p.sortable&&e.jsx(l,{column:n})]}),e.jsx("div",{className:`absolute right-0 top-0 h-full w-1 cursor-col-resize hover:bg-primary/50 transition-colors ${ae===n?"bg-primary":"bg-transparent group-hover:bg-border"}`,onMouseDown:g=>X(g,n)})]},n)})})}),e.jsx("tbody",{className:"[&_tr:last-child]:border-0",children:he.map(n=>e.jsx("tr",{className:"border-b transition-colors hover:bg-muted/50 align-top",children:O.map((r,p)=>{const m=re[r],N=r==="name",F=z(r),R=m.editable&&!N,g=a?.staffId===n.id&&a?.field===r,fe=p===0?"sticky left-0 z-10 bg-background shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]":"";if(g&&m.editType==="select")return e.jsx("td",{className:`p-1 align-middle ${fe}`,style:{width:`${F}px`,maxWidth:`${F}px`},children:e.jsxs(A,{value:v,onValueChange:W=>ee(n.id,r,W),children:[e.jsx(P,{className:"h-8",children:e.jsx(T,{placeholder:"Select..."})}),e.jsx(E,{children:Et.map(W=>e.jsx(o,{value:W.value,children:W.label},W.value))})]})},r);if(g)return e.jsx("td",{className:`p-1 align-middle ${fe}`,style:{width:`${F}px`,maxWidth:`${F}px`},children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(x,{type:m.editType==="date"?"date":m.editType==="number"?"number":"text",value:v,onChange:W=>q(W.target.value),onKeyDown:W=>ve(W,n.id,r),onBlur:()=>K(n.id,r),autoFocus:!0,className:"h-8 text-sm",disabled:I}),e.jsx("button",{onClick:()=>K(n.id,r),className:"p-1 hover:bg-primary/10 rounded",disabled:I,children:e.jsx(et,{className:"h-4 w-4 text-green-600"})}),e.jsx("button",{onClick:Z,className:"p-1 hover:bg-destructive/10 rounded",children:e.jsx(ke,{className:"h-4 w-4 text-destructive"})})]})},r);const Ce=m.render?m.render(n):n[r]?.toString()||e.jsx(U,{});return e.jsx("td",{onClick:W=>{N?u(n):R&&(W.stopPropagation(),_e(n.id,r,n[r]))},className:`p-4 align-middle ${N?"font-medium text-primary hover:underline cursor-pointer":""} ${R?"cursor-pointer hover:bg-muted/80":""} ${fe} ${m.centered?"text-center":""}`,style:{width:`${F}px`,maxWidth:`${F}px`},children:m.centered?e.jsx("div",{className:"flex justify-center items-center",children:Ce}):Ce},r)})},n.id))})]})})}const Vt={operational:"Operational Staff",sales_rep:"Sales Rep",contractor:"Contractor",intern:"Intern"},Ot={operational:We,sales_rep:Ne,contractor:bt,intern:Ne};function $t({staff:s,isNew:u=!1,open:j,onClose:y,defaultStaffType:f="operational"}){const{toast:L}=Ee(),h=kt(),V=Ft(),S=Dt(),[t,B]=c.useState({name:"",first_name:"",last_name:"",title:"",status:"active",staff_type:f,start_date:"",end_date:"",department:"",employment_type:"full_time",termination_reason:"",termination_notes:"",email:"",phone:"",city:"",country:"",timezone:"",pay_type:"hourly",hourly_pay:"",hours_per_week:"",expected_hours_week:"",monthly_pay:"",salary:"",commission_type:"percentage",commission_percent:"",quota:"",commission_status:"active",total_clients:"",monthly_revenue:"",account_type:"",bank_name:"",account_number:"",routing_number:"",performance_status:"on_track",last_review_date:"",next_review_date:"",notes:""});c.useEffect(()=>{s&&!u?B({name:s.name||"",first_name:s.first_name||"",last_name:s.last_name||"",title:s.title||"",status:s.status,staff_type:s.staff_type||"operational",start_date:s.start_date||"",end_date:s.end_date||"",department:s.department||"",employment_type:s.employment_type||"full_time",termination_reason:s.termination_reason||"",termination_notes:s.termination_notes||"",email:s.email||"",phone:s.phone||"",city:s.city||"",country:s.country||"",timezone:s.timezone||"",pay_type:s.pay_type||"hourly",hourly_pay:s.hourly_pay?.toString()||"",hours_per_week:s.hours_per_week?.toString()||"",expected_hours_week:s.expected_hours_week?.toString()||"",monthly_pay:s.monthly_pay?.toString()||"",salary:s.salary?.toString()||"",commission_type:s.commission_type||"percentage",commission_percent:s.commission_percent?.toString()||"",quota:s.quota?.toString()||"",commission_status:s.commission_status||"active",total_clients:s.total_clients?.toString()||"",monthly_revenue:s.monthly_revenue?.toString()||"",account_type:s.account_type||"",bank_name:s.bank_name||"",account_number:s.account_number||"",routing_number:s.routing_number||"",performance_status:s.performance_status||"on_track",last_review_date:s.last_review_date||"",next_review_date:s.next_review_date||"",notes:s.notes||""}):u&&B(a=>({...a,name:"",first_name:"",last_name:"",title:"",status:"active",staff_type:f,start_date:"",end_date:"",department:"",employment_type:"full_time",termination_reason:"",termination_notes:"",email:"",phone:"",city:"",country:"",timezone:"",pay_type:"hourly",hourly_pay:"",hours_per_week:"",expected_hours_week:"",monthly_pay:"",salary:"",commission_type:"percentage",commission_percent:"",quota:"",commission_status:"active",total_clients:"",monthly_revenue:"",account_type:"",bank_name:"",account_number:"",routing_number:"",performance_status:"on_track",last_review_date:"",next_review_date:"",notes:""}))},[s,u,f]);const i=(a,_)=>{B(v=>({...v,[a]:_}))},G=()=>{const a=parseFloat(t.hourly_pay)||0,_=parseFloat(t.hours_per_week)||0,v=a*_,q=v*2,I=v*4.33;return{weeklyPay:v,biWeeklyPay:q,monthlyFromHourly:I}},O=c.useCallback(()=>({name:`${t.first_name.trim()} ${t.last_name.trim()}`,first_name:t.first_name||null,last_name:t.last_name||null,title:t.title||null,status:t.status,staff_type:t.staff_type,start_date:t.start_date||null,end_date:t.end_date||null,department:t.department||null,employment_type:t.employment_type||null,termination_reason:t.termination_reason||null,termination_notes:t.termination_notes||null,email:t.email||null,phone:t.phone||null,city:t.city||null,country:t.country||null,timezone:t.timezone||null,pay_type:t.pay_type||null,hourly_pay:t.hourly_pay?parseFloat(t.hourly_pay):null,hours_per_week:t.hours_per_week?parseFloat(t.hours_per_week):null,expected_hours_week:t.expected_hours_week?parseFloat(t.expected_hours_week):null,monthly_pay:t.monthly_pay?parseFloat(t.monthly_pay):null,salary:t.salary?parseFloat(t.salary):null,commission_type:t.staff_type==="sales_rep"?t.commission_type:null,commission_percent:t.commission_percent?parseFloat(t.commission_percent):null,quota:t.quota?parseFloat(t.quota):null,commission_status:t.commission_status||null,total_clients:t.total_clients?parseInt(t.total_clients):null,monthly_revenue:t.monthly_revenue?parseFloat(t.monthly_revenue):null,account_type:t.account_type||null,bank_name:t.bank_name||null,account_number:t.account_number||null,routing_number:t.routing_number||null,performance_status:t.performance_status||null,last_review_date:t.last_review_date||null,next_review_date:t.next_review_date||null,notes:t.notes||null}),[t]),ae=c.useCallback(async()=>{if(u||!s||!t.first_name.trim()||!t.last_name.trim())return!1;try{const a=O(),{name:_,...v}=a;return await V.mutateAsync({id:s.id,name:_,...v}),!0}catch{return!1}},[u,s,t.first_name,t.last_name,O,V]),{isSaving:H}=dt({data:t,onSave:ae,enabled:!u&&!!s&&j}),Y=async()=>{if(!t.first_name.trim()||!t.last_name.trim()){L({title:"Error",description:"First name and last name are required",variant:"destructive"});return}try{const a=O();await h.mutateAsync(a),L({title:"Success",description:"Staff member added"}),y()}catch(a){const _=a instanceof Error?a.message:"Failed to save",v=ct(_,"employee");L({title:"Error",description:v,variant:"destructive"})}},w=async()=>{if(s)try{await S.mutateAsync(s.id),L({title:"Success",description:"Staff member deleted"}),y()}catch(a){L({title:"Error",description:a instanceof Error?a.message:"Failed to delete",variant:"destructive"})}},{weeklyPay:$,biWeeklyPay:Q,monthlyFromHourly:M}=G(),b=t.staff_type==="sales_rep",k=h.isPending,C=Ot[t.staff_type];return e.jsx(nt,{open:j,onOpenChange:a=>!a&&y(),children:e.jsxs(rt,{className:"w-full sm:max-w-2xl overflow-y-auto",children:[e.jsxs(lt,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5 text-primary"}),e.jsx(it,{children:u?"Add Employee":"Edit Employee"})]}),!u&&s&&e.jsxs(Fe,{variant:s.status==="active"?"default":"secondary",children:[Vt[s.staff_type]," â€¢ ",s.status]})]}),e.jsxs(gt,{defaultValue:"basic",className:"mt-6",children:[e.jsxs(ft,{className:"grid w-full grid-cols-4",children:[e.jsx(ce,{value:"basic",children:"Basic"}),e.jsx(ce,{value:"compensation",children:"Pay"}),e.jsx(ce,{value:"contact",children:"Contact"}),e.jsx(ce,{value:"banking",children:"Banking"})]}),e.jsxs(de,{value:"basic",className:"space-y-6 mt-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground uppercase tracking-wide",children:"Identity"}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"first_name",children:"First Name *"}),e.jsx(x,{id:"first_name",value:t.first_name,onChange:a=>i("first_name",a.target.value)})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"last_name",children:"Last Name *"}),e.jsx(x,{id:"last_name",value:t.last_name,onChange:a=>i("last_name",a.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"title",children:"Title"}),e.jsx(x,{id:"title",value:t.title,onChange:a=>i("title",a.target.value)})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"department",children:"Department"}),e.jsx(x,{id:"department",value:t.department,onChange:a=>i("department",a.target.value)})]})]})]})]}),e.jsx(ne,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground uppercase tracking-wide",children:"Employment"}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"employment_type",children:"Employment Type"}),e.jsxs(A,{value:t.employment_type,onValueChange:a=>i("employment_type",a),children:[e.jsx(P,{children:e.jsx(T,{})}),e.jsxs(E,{children:[e.jsx(o,{value:"full_time",children:"Full Time"}),e.jsx(o,{value:"part_time",children:"Part Time"}),e.jsx(o,{value:"contractor",children:"Contractor"}),e.jsx(o,{value:"intern",children:"Intern"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"status",children:"Status"}),e.jsxs(A,{value:t.status,onValueChange:a=>i("status",a),children:[e.jsx(P,{children:e.jsx(T,{})}),e.jsxs(E,{children:[e.jsx(o,{value:"active",children:"Active"}),e.jsx(o,{value:"inactive",children:"Inactive"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"performance_status",children:"Performance"}),e.jsxs(A,{value:t.performance_status,onValueChange:a=>i("performance_status",a),children:[e.jsx(P,{children:e.jsx(T,{})}),e.jsxs(E,{children:[e.jsx(o,{value:"on_track",children:"On Track"}),e.jsx(o,{value:"exceeding",children:"Exceeding"}),e.jsx(o,{value:"needs_improvement",children:"Needs Improvement"}),e.jsx(o,{value:"probation",children:"Probation"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"start_date",children:"Start Date"}),e.jsx(x,{id:"start_date",type:"date",value:t.start_date,onChange:a=>i("start_date",a.target.value)})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"end_date",children:"End Date"}),e.jsx(x,{id:"end_date",type:"date",value:t.end_date,onChange:a=>i("end_date",a.target.value)})]})]})]})]}),t.status==="inactive"&&e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground uppercase tracking-wide",children:"Termination Details"}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"termination_reason",children:"Reason"}),e.jsxs(A,{value:t.termination_reason,onValueChange:a=>i("termination_reason",a),children:[e.jsx(P,{children:e.jsx(T,{placeholder:"Select reason"})}),e.jsxs(E,{children:[e.jsx(o,{value:"resigned",children:"Resigned"}),e.jsx(o,{value:"terminated",children:"Terminated"}),e.jsx(o,{value:"contract_ended",children:"Contract Ended"}),e.jsx(o,{value:"layoff",children:"Layoff"}),e.jsx(o,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"termination_notes",children:"Notes"}),e.jsx(Se,{id:"termination_notes",value:t.termination_notes,onChange:a=>i("termination_notes",a.target.value),rows:3})]})]})]})]}),e.jsx(ne,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground uppercase tracking-wide",children:"Notes"}),e.jsx(Se,{id:"notes",value:t.notes,onChange:a=>i("notes",a.target.value),placeholder:"Internal notes about this staff member...",rows:4})]})]}),e.jsxs(de,{value:"compensation",className:"space-y-6 mt-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground uppercase tracking-wide",children:"Base Compensation"}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"pay_type",children:"Pay Type"}),e.jsxs(A,{value:t.pay_type,onValueChange:a=>i("pay_type",a),children:[e.jsx(P,{children:e.jsx(T,{})}),e.jsxs(E,{children:[e.jsx(o,{value:"hourly",children:"Hourly"}),e.jsx(o,{value:"salary",children:"Salary"}),e.jsx(o,{value:"commission_only",children:"Commission Only"})]})]})]}),t.pay_type==="hourly"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"hourly_pay",children:"Hourly Rate"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{id:"hourly_pay",type:"number",step:"0.01",value:t.hourly_pay,onChange:a=>i("hourly_pay",a.target.value),placeholder:"0.00",className:"pl-9"})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"hours_per_week",children:"Hours Per Week"}),e.jsx(x,{id:"hours_per_week",type:"number",step:"0.5",value:t.hours_per_week,onChange:a=>i("hours_per_week",a.target.value),placeholder:"40"})]})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Weekly Pay:"}),e.jsxs("span",{className:"font-medium",children:["$",$.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bi-Weekly Pay:"}),e.jsxs("span",{className:"font-medium",children:["$",Q.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Monthly (Est):"}),e.jsxs("span",{className:"font-medium",children:["$",M.toFixed(2)]})]})]})]}),t.pay_type==="salary"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"salary",children:"Annual Salary"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{id:"salary",type:"number",step:"1000",value:t.salary,onChange:a=>i("salary",a.target.value),placeholder:"0",className:"pl-9"})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"expected_hours_week",children:"Expected Hours/Week"}),e.jsx(x,{id:"expected_hours_week",type:"number",value:t.expected_hours_week,onChange:a=>i("expected_hours_week",a.target.value),placeholder:"40"})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"monthly_pay",children:"Monthly Pay (Override)"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{id:"monthly_pay",type:"number",step:"0.01",value:t.monthly_pay,onChange:a=>i("monthly_pay",a.target.value),placeholder:"0.00",className:"pl-9"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Set manually if different from calculated amount"})]})]})]}),b&&e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground uppercase tracking-wide",children:"Commission & Sales"}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"commission_type",children:"Commission Type"}),e.jsxs(A,{value:t.commission_type,onValueChange:a=>i("commission_type",a),children:[e.jsx(P,{children:e.jsx(T,{})}),e.jsxs(E,{children:[e.jsx(o,{value:"percentage",children:"Percentage"}),e.jsx(o,{value:"flat_fee",children:"Flat Fee"}),e.jsx(o,{value:"tiered",children:"Tiered"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"commission_percent",children:"Commission Rate (%)"}),e.jsxs("div",{className:"relative",children:[e.jsx(x,{id:"commission_percent",type:"number",step:"0.1",value:t.commission_percent,onChange:a=>i("commission_percent",a.target.value),placeholder:"10",className:"pr-8"}),e.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground text-sm",children:"%"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"quota",children:"Monthly Quota"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{id:"quota",type:"number",value:t.quota,onChange:a=>i("quota",a.target.value),placeholder:"0",className:"pl-9"})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"commission_status",children:"Commission Status"}),e.jsxs(A,{value:t.commission_status,onValueChange:a=>i("commission_status",a),children:[e.jsx(P,{children:e.jsx(T,{})}),e.jsxs(E,{children:[e.jsx(o,{value:"active",children:"Active"}),e.jsx(o,{value:"paused",children:"Paused"}),e.jsx(o,{value:"inactive",children:"Inactive"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"total_clients",children:"Total Clients"}),e.jsx(x,{id:"total_clients",type:"number",value:t.total_clients,onChange:a=>i("total_clients",a.target.value),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"monthly_revenue",children:"Monthly Revenue"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{id:"monthly_revenue",type:"number",step:"0.01",value:t.monthly_revenue,onChange:a=>i("monthly_revenue",a.target.value),placeholder:"0.00",className:"pl-9"})]})]})]})]})]})]})]}),e.jsx(de,{value:"contact",className:"space-y-6 mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground uppercase tracking-wide",children:"Contact Information"}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"email",children:"Email Address"}),e.jsx(x,{id:"email",type:"email",value:t.email,onChange:a=>i("email",a.target.value)})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"phone",children:"Phone"}),e.jsx(ot,{id:"phone",value:t.phone,onChange:a=>i("phone",a)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"city",children:"City"}),e.jsx(x,{id:"city",value:t.city,onChange:a=>i("city",a.target.value)})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"country",children:"Country"}),e.jsx(x,{id:"country",value:t.country,onChange:a=>i("country",a.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"timezone",children:"Timezone"}),e.jsx(x,{id:"timezone",value:t.timezone,onChange:a=>i("timezone",a.target.value),placeholder:"e.g., America/Denver"})]})]})]})}),e.jsx(de,{value:"banking",className:"space-y-6 mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-sm text-muted-foreground uppercase tracking-wide",children:"Banking Information"}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"account_type",children:"Account Type"}),e.jsxs(A,{value:t.account_type,onValueChange:a=>i("account_type",a),children:[e.jsx(P,{children:e.jsx(T,{placeholder:"Select type"})}),e.jsxs(E,{children:[e.jsx(o,{value:"checking",children:"Checking"}),e.jsx(o,{value:"savings",children:"Savings"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"bank_name",children:"Bank Name"}),e.jsx(x,{id:"bank_name",value:t.bank_name,onChange:a=>i("bank_name",a.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"account_number",children:"Account Number"}),e.jsx(x,{id:"account_number",value:t.account_number,onChange:a=>i("account_number",a.target.value)})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"routing_number",children:"Routing Number"}),e.jsx(x,{id:"routing_number",value:t.routing_number,onChange:a=>i("routing_number",a.target.value)})]})]})]})]})})]}),e.jsx(ne,{className:"my-6"}),e.jsx("div",{className:"flex items-center gap-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx(D,{variant:"outline",className:"flex-1",onClick:y,children:"Cancel"}),e.jsxs(D,{className:"flex-1",onClick:Y,disabled:k,children:[k&&e.jsx(ue,{className:"h-4 w-4 mr-2 animate-spin"}),"Add Employee"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(ut,{children:[e.jsx(mt,{asChild:!0,children:e.jsxs(D,{variant:"destructive",className:"flex-1",disabled:S.isPending,children:[S.isPending?e.jsx(ue,{className:"h-4 w-4 animate-spin"}):e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Delete",H&&e.jsx(ue,{className:"h-3 w-3 ml-2 animate-spin"})]})}),e.jsxs(ht,{children:[e.jsxs(pt,{children:[e.jsx(xt,{children:"Delete Staff Member"}),e.jsxs(yt,{children:["Are you sure you want to delete ",s?.name,"? This action cannot be undone."]})]}),e.jsxs(jt,{children:[e.jsx(_t,{children:"Cancel"}),e.jsx(vt,{onClick:w,children:"Delete"})]})]})]}),e.jsx(D,{variant:"outline",className:"flex-1",onClick:y,children:"Close"})]})})]})})}function Ns(){const{data:s=[],isLoading:u}=St(),j=me(),[y,f]=c.useState(null),[L,h]=c.useState(!1),[V,S]=c.useState(!1),[t,B]=c.useState("operational"),[i,G]=c.useState(!1),[O,ae]=c.useState(""),[H,Y]=c.useState(""),[w,$]=c.useState({}),[Q,M]=c.useState(!1),[b,k]=c.useState(1),[C,a]=c.useState(50),{preferences:_,loading:v,saveView:q,loadView:I,resetToDefault:J}=Pt(),he=l=>{ae(l);const n=setTimeout(()=>{Y(l),k(1)},300);return()=>clearTimeout(n)},le=s.filter(l=>{if(H){const n=H.toLowerCase();if(!`${l.first_name||""} ${l.last_name||""}`.toLowerCase().includes(n)&&!l.email?.toLowerCase().includes(n)&&!l.title?.toLowerCase().includes(n))return!1}return!(w.status&&l.status!==w.status||w.staff_type&&l.staff_type!==w.staff_type)}),z=le.length,X=Math.ceil(z/C),pe=le.slice((b-1)*C,b*C),xe=l=>{f(l),S(!1),h(!0)},ie=l=>{f(null),S(!0),B(l||"operational"),h(!0)},ye=()=>{h(!1),f(null),S(!1)},je=()=>{j.invalidateQueries({queryKey:["staff"]})},_e=(l,n)=>{q(l,!0)},Z=(l,n)=>{$(r=>{if(!n){const{[l]:p,...m}=r;return m}return{...r,[l]:n}}),k(1)},K=()=>{$({}),k(1)},ve=l=>{a(parseInt(l)),k(1)},ee=Object.keys(w).length;return u||v?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(ue,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(e.Fragment,{children:[e.jsxs(Ve,{children:[e.jsx("title",{children:"Staff | Cynergists Admin"}),e.jsx("meta",{name:"description",content:"Manage Cynergists staff members and sales reps"})]}),e.jsxs("div",{className:"flex flex-col h-[calc(100vh-64px)] overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 p-6 pb-4 space-y-4 bg-background",children:[e.jsx(Tt,{staff:s}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Employees"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[z," total employees"]})]}),e.jsxs("div",{className:"flex items-center gap-1 border-l pl-6",children:[e.jsx(D,{variant:_.activeViewName===null?"secondary":"ghost",size:"sm",onClick:J,className:"text-sm",children:"All"}),_.savedViews.map(l=>e.jsx(D,{variant:_.activeViewName===l.name?"secondary":"ghost",size:"sm",onClick:()=>I(l.name),className:"text-sm",children:l.name},l.name)),_.savedViews.length<3&&e.jsxs(D,{variant:"ghost",size:"sm",onClick:()=>G(!0),className:"text-sm text-muted-foreground",children:[e.jsx(Xe,{className:"h-3 w-3 mr-1"}),"Save View"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Search employees...",value:O,onChange:l=>he(l.target.value),className:"pl-9 w-64"})]}),e.jsxs(Me,{open:Q,onOpenChange:M,children:[e.jsx(qe,{asChild:!0,children:e.jsxs(D,{variant:"outline",className:"relative",children:[e.jsx(Nt,{className:"h-4 w-4 mr-2"}),"Filters",ee>0&&e.jsx("span",{className:"absolute -top-1 -right-1 h-5 w-5 rounded-full bg-primary text-primary-foreground text-xs flex items-center justify-center",children:ee})]})}),e.jsx(Ie,{className:"w-80",align:"end",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Filters"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Status"}),e.jsxs(A,{value:w.status||"",onValueChange:l=>Z("status",l),children:[e.jsx(P,{children:e.jsx(T,{placeholder:"All statuses"})}),e.jsxs(E,{children:[e.jsx(o,{value:"",children:"All"}),e.jsx(o,{value:"active",children:"Active"}),e.jsx(o,{value:"inactive",children:"Inactive"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Type"}),e.jsxs(A,{value:w.staff_type||"",onValueChange:l=>Z("staff_type",l),children:[e.jsx(P,{children:e.jsx(T,{placeholder:"All types"})}),e.jsxs(E,{children:[e.jsx(o,{value:"",children:"All"}),e.jsx(o,{value:"operational",children:"Operational"}),e.jsx(o,{value:"sales",children:"Sales"})]})]})]}),ee>0&&e.jsx(D,{variant:"ghost",size:"sm",onClick:K,className:"w-full",children:"Clear all filters"})]})})]}),e.jsxs(D,{onClick:()=>ie(),children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),"Add Employee"]})]})]}),ee>0&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Active filters:"}),Object.entries(w).map(([l,n])=>e.jsxs(D,{variant:"secondary",size:"sm",onClick:()=>Z(l,""),className:"h-6 text-xs",children:[l,": ",n,e.jsx(ke,{className:"h-3 w-3 ml-1"})]},l)),e.jsx(D,{variant:"ghost",size:"sm",onClick:K,className:"h-6 text-xs",children:"Clear all"})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden px-6",children:e.jsx("div",{className:"border rounded-lg h-full overflow-auto",children:e.jsx(Lt,{staff:pe,onSelectStaff:xe,onAddNew:ie,onStaffUpdated:je})})}),e.jsx("div",{className:"flex-shrink-0 px-6 py-4 bg-background border-t",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Rows per page:"}),e.jsxs(A,{value:C.toString(),onValueChange:ve,children:[e.jsx(P,{className:"w-20",children:e.jsx(T,{})}),e.jsxs(E,{children:[e.jsx(o,{value:"25",children:"25"}),e.jsx(o,{value:"50",children:"50"}),e.jsx(o,{value:"100",children:"100"})]})]}),e.jsxs("span",{className:"text-sm text-muted-foreground ml-4",children:["Showing ",Math.min((b-1)*C+1,z)," -"," ",Math.min(b*C,z)," of ",z]})]}),X>1&&e.jsx(ze,{children:e.jsxs(Re,{children:[e.jsx(be,{children:e.jsx(Ue,{onClick:()=>k(l=>Math.max(1,l-1)),className:b===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:Math.min(5,X)},(l,n)=>{const r=b<=3?n+1:b+n-2;return r<1||r>X?null:e.jsx(be,{children:e.jsx(Be,{onClick:()=>k(r),isActive:b===r,className:"cursor-pointer",children:r})},r)}),e.jsx(be,{children:e.jsx(He,{onClick:()=>k(l=>Math.min(X,l+1)),className:b===X?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})]}),e.jsx($t,{staff:y,isNew:V,open:L,onClose:ye,defaultStaffType:t}),e.jsx(Ge,{open:i,onOpenChange:G,onSave:_e,existingViewNames:_.savedViews.map(l=>l.name)})]})}export{Ns as default};
