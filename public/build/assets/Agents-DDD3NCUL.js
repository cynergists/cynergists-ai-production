import{d as G,r as f,j as e,B as o,P as K,T as Q,s as $,au as R,L as P,f as V,k as x}from"./app-DEGgoab9.js";import{u as F}from"./useMutation-BaBND5Q6.js";import{c as A}from"./admin-api-Ch68ZG0p.js";import{T as H,a as O,b as w,c as h,d as U,e as d}from"./table-g-WPvQjw.js";import{I as j}from"./input-1skZDOCu.js";import{L as c}from"./label-DyCc8r5j.js";import{T as k}from"./textarea-ChfsjVw9.js";import{S as E}from"./switch-DS_Y0Cbl.js";import{D as Y,a as J,c as Z,d as X,f as D}from"./dialog-CLfAwBUe.js";import{S as M,a as q,b as L,c as B,d as z}from"./select-JGGC0Mgv.js";import{S as ee}from"./scroll-area-fNnfEtsK.js";import{A as W}from"./AgentMediaUpload-DJ9RwPUh.js";import{C as se,a as re}from"./card-uxUAVHNy.js";import{C as te}from"./circle-8iK6bBXE.js";import{E as ae}from"./eye-CBE4axyN.js";import{P as ie}from"./pencil-CqB2RKJT.js";/* empty css            */import"./index-Dn_VlTCY.js";import"./index-D7gcp3at.js";import"./index-B4RoVyNO.js";import"./Combination-Dm0hFAPF.js";import"./index-BdQq_4o_.js";import"./index-CfEoTzS4.js";import"./check-RkjWs7wE.js";import"./chevron-up-Dry_WOTS.js";import"./upload-BvpHTGN2.js";const ne=["New","Popular","Software","Planned","Roadmap","Beta","Vote"];function le({open:m,onOpenChange:v,onSubmit:p,initialData:a,isEditing:u=!1,isLoading:C=!1}){const{data:g=[]}=G({queryKey:["agent-categories-names"],queryFn:async()=>{const{data:r,error:l}=await $.from("agent_categories").select("name").order("display_order",{ascending:!0});if(l)throw l;return r.map(s=>s.name)}}),[t,n]=f.useState({name:"",job_title:"",description:"",price:"",category:"General",website_category:"New",icon:"bot",is_popular:!1,is_active:!0,features:"",perfect_for:"",integrations:"",image_url:"",media:[],card_media:[],product_media:[],tiers:[]});f.useEffect(()=>{if(m){const r=a?.image_url?[{url:a.image_url,type:"image"}]:[];n({name:a?.name||"",job_title:a?.job_title||"",description:a?.description||"",price:a?.price??"",category:a?.category||"General",website_category:a?.website_category||"New",icon:a?.icon||"bot",is_popular:a?.is_popular||!1,is_active:a?.is_active??!0,features:a?.features||"",perfect_for:a?.perfect_for||"",integrations:a?.integrations||"",image_url:a?.image_url||"",media:a?.media||[],card_media:a?.card_media||r,product_media:a?.product_media||[],tiers:a?.tiers||[]})}},[m,a]);const y=r=>{r.preventDefault();const l={...t,image_url:t.card_media[0]?.url||""};p(l)},N=()=>{v(!1)},S=()=>{const r={price:0,description:""};n({...t,tiers:[...t.tiers,r]})},_=r=>{const l=t.tiers.filter((s,i)=>i!==r);n({...t,tiers:l})},b=(r,l,s)=>{const i=[...t.tiers];i[r]={...i[r],[l]:s},n({...t,tiers:i})};return e.jsx(Y,{open:m,onOpenChange:v,children:e.jsx(J,{className:"sm:max-w-[950px] max-h-[90vh] p-0 flex flex-col overflow-hidden",children:e.jsxs("form",{onSubmit:y,className:"flex flex-col flex-1 min-h-0",children:[e.jsx(Z,{className:"px-6 pt-6 pb-4 border-b border-border/50 flex-shrink-0",children:e.jsx(X,{className:"text-xl font-bold",children:u?"Edit AI Agent":"Add New AI Agent"})}),e.jsx(ee,{className:"h-[calc(90vh-180px)]",children:e.jsxs("div",{className:"grid lg:grid-cols-2 gap-8 px-8 py-4",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"text-base font-semibold",children:"Agent Player Card"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Media shown on the agent card in listings. Add multiple for a carousel."}),e.jsx(W,{media:t.card_media,onChange:r=>n({...t,card_media:r}),agentName:t.name,maxItems:1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"text-base font-semibold",children:"Agent Product Page"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Media shown on the agent's detail page. Add multiple for a carousel."}),e.jsx(W,{media:t.product_media,onChange:r=>n({...t,product_media:r}),agentName:t.name,maxItems:1})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"category",children:"Product Category"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"The type of product (e.g., Content, Software, Growth)"}),e.jsxs(M,{value:t.category,onValueChange:r=>n({...t,category:r}),children:[e.jsx(q,{children:e.jsx(L,{})}),e.jsx(B,{children:g.map(r=>e.jsx(z,{value:r,children:r},r))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"website_category",children:"Website Category"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Where this appears on the website (e.g., New, Popular, Planned)"}),e.jsxs(M,{value:t.website_category,onValueChange:r=>n({...t,website_category:r}),children:[e.jsx(q,{children:e.jsx(L,{})}),e.jsx(B,{children:ne.map(r=>e.jsx(z,{value:r,children:r},r))})]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{id:"is_popular",checked:t.is_popular,onCheckedChange:r=>n({...t,is_popular:r})}),e.jsx(c,{htmlFor:"is_popular",children:"Mark as Popular"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{id:"is_active",checked:t.is_active,onCheckedChange:r=>n({...t,is_active:r})}),e.jsx(c,{htmlFor:"is_active",children:"Active"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"features",children:"What's Included (one per line)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"These features apply to all tiers"}),e.jsx(k,{id:"features",placeholder:`Feature item one
Feature item two
Feature item three`,value:t.features,onChange:r=>n({...t,features:r.target.value}),rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"integrations",children:"Integrations (one per line)"}),e.jsx(k,{id:"integrations",placeholder:`Slack
Zapier
Google Workspace`,value:t.integrations,onChange:r=>n({...t,integrations:r.target.value}),rows:3})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"name",children:"AI Agent Name"}),e.jsx(j,{id:"name",placeholder:"e.g., Mosaic",value:t.name,onChange:r=>n({...t,name:r.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"job_title",children:"Job Title"}),e.jsx(j,{id:"job_title",placeholder:"e.g., Content Writer Pro",value:t.job_title,onChange:r=>n({...t,job_title:r.target.value})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"A short title that appears under the agent name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"description",children:"Short Description"}),e.jsx(k,{id:"description",placeholder:"Summarize what this AI Agent does and its key value proposition...",value:t.description,onChange:r=>n({...t,description:r.target.value}),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"price",children:"Base Price ($/month)"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Used when no tiers are defined"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-primary",children:"$"}),e.jsx(j,{id:"price",type:"number",min:"0",step:"0.01",className:"text-xl font-bold",value:t.price,onChange:r=>n({...t,price:r.target.value===""?"":parseFloat(r.target.value)||0})}),e.jsx("span",{className:"text-muted-foreground",children:"/month"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Pricing Tiers"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Add tiers to enable slider-based pricing"})]}),e.jsxs(o,{type:"button",variant:"outline",size:"sm",onClick:S,children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"Add Tier"]})]}),t.tiers.length===0?e.jsx("div",{className:"p-4 rounded-lg border border-dashed border-border/50 text-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:'No tiers defined. Click "Add Tier" to enable tiered pricing.'})}):e.jsx("div",{className:"space-y-3",children:t.tiers.map((r,l)=>e.jsx(se,{className:"bg-muted/30",children:e.jsx(re,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-6 h-6 mt-1 shrink-0",children:e.jsx(te,{className:"h-3 w-3 fill-lime-400 text-lime-400"})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx(c,{className:"text-xs",children:"Price ($/mo)"}),e.jsx(j,{type:"number",min:"0",step:"0.01",placeholder:"0",value:r.price||"",onChange:s=>b(l,"price",parseFloat(s.target.value)||0)})]})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{className:"text-xs",children:"Tier Description"}),e.jsx(j,{placeholder:"e.g., 1 Website and 1 Domain",value:r.description,onChange:s=>b(l,"description",s.target.value)})]})]}),e.jsx(o,{type:"button",variant:"ghost",size:"icon",className:"shrink-0 text-muted-foreground hover:text-destructive",onClick:()=>_(l),children:e.jsx(Q,{className:"h-4 w-4"})})]})})},l))})]})]})]})}),e.jsxs(D,{className:"px-6 py-4 border-t border-border/50 flex-shrink-0",children:[e.jsx(o,{type:"button",variant:"outline",onClick:N,children:"Cancel"}),e.jsx(o,{type:"submit",disabled:C,children:u?"Update AI Agent":"Create AI Agent"})]})]})})})}function Me(){const m=R(),[v,p]=f.useState(!1),[a,u]=f.useState(null),[C,g]=f.useState(void 0),{data:t,isLoading:n}=G({queryKey:["portal-agents"],queryFn:async()=>A("get_ai_agents")}),y=F({mutationFn:async s=>{const i=s.features.split(`
`).map(T=>T.trim()).filter(Boolean),I=s.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"");await A("create_ai_agent",void 0,{name:s.name,slug:I,job_title:s.job_title||null,description:s.description,price:typeof s.price=="number"?s.price:0,category:s.category,icon:s.icon,is_popular:s.is_popular,is_active:s.is_active,features:i,tiers:s.tiers||[],sort_order:(t?.length||0)+1})},onSuccess:()=>{m.invalidateQueries({queryKey:["portal-agents"]}),x.success("AI Agent created successfully"),_()},onError:s=>{x.error("Failed to create AI Agent: "+s.message)}}),N=F({mutationFn:async({id:s,data:i})=>{const I=i.features.split(`
`).map(T=>T.trim()).filter(Boolean);await A("update_ai_agent",{id:s},{name:i.name,job_title:i.job_title||null,description:i.description,price:typeof i.price=="number"?i.price:0,category:i.category,icon:i.icon,is_popular:i.is_popular,is_active:i.is_active,features:I,tiers:i.tiers||[]})},onSuccess:()=>{m.invalidateQueries({queryKey:["portal-agents"]}),x.success("AI Agent updated successfully"),_()},onError:s=>{x.error("Failed to update AI Agent: "+s.message)}}),S=F({mutationFn:async s=>{await A("delete_ai_agent",{id:s})},onSuccess:()=>{m.invalidateQueries({queryKey:["portal-agents"]}),x.success("AI Agent deleted successfully")},onError:s=>{x.error("Failed to delete AI Agent: "+s.message)}}),_=()=>{g(void 0),u(null),p(!1)},b=s=>{u(s),g({name:s.name,job_title:s.job_title||"",description:s.description||"",price:s.price,category:s.category,icon:s.icon||"bot",is_popular:s.is_popular,is_active:s.is_active,features:s.features?.join(`
`)||"",perfect_for:"",integrations:"",image_url:""}),p(!0)},r=()=>{u(null),g(void 0),p(!0)},l=s=>{a?N.mutate({id:a.id,data:s}):y.mutate(s)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(P,{href:"/admin/client-portal",children:e.jsx(o,{variant:"ghost",size:"icon",children:e.jsx(V,{className:"h-4 w-4"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Manage AI Agents"}),e.jsx("p",{className:"text-muted-foreground",children:"Configure AI Agents available in the customer marketplace"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{asChild:!0,variant:"outline",children:e.jsxs(P,{href:"/admin/ai-agent-template",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Preview Template"]})}),e.jsxs(o,{onClick:r,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Add AI Agent"]})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(H,{children:[e.jsx(O,{children:e.jsxs(w,{children:[e.jsx(h,{children:"Name"}),e.jsx(h,{children:"Category"}),e.jsx(h,{children:"Price"}),e.jsx(h,{children:"Popular"}),e.jsx(h,{children:"Active"}),e.jsx(h,{className:"text-right",children:"Actions"})]})}),e.jsx(U,{children:n?e.jsx(w,{children:e.jsx(d,{colSpan:6,className:"text-center",children:"Loading..."})}):t?.length===0?e.jsx(w,{children:e.jsx(d,{colSpan:6,className:"text-center text-muted-foreground",children:'No AI Agents yet. Click "Add AI Agent" to create one.'})}):t?.map(s=>e.jsxs(w,{children:[e.jsx(d,{className:"font-medium text-lime-400 hover:text-lime-300",children:s.name}),e.jsx(d,{children:s.category}),e.jsxs(d,{children:["$",s.price,"/mo"]}),e.jsx(d,{children:s.is_popular?"Yes":"—"}),e.jsx(d,{children:s.is_active?"Yes":"—"}),e.jsxs(d,{className:"text-right",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>b(s),children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>{confirm("Are you sure you want to delete this AI Agent?")&&S.mutate(s.id)},children:e.jsx(Q,{className:"h-4 w-4"})})]})]},s.id))})]})}),e.jsx(le,{open:v,onOpenChange:p,onSubmit:l,initialData:C,isEditing:!!a,isLoading:y.isPending||N.isPending})]})}export{Me as default};
