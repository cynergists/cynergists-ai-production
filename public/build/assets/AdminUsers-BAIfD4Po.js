import{d as ce,au as de,k as I,r as o,aF as J,j as e,aG as ue,n as M,B as _,T as he,X as le,g as ae,i as pe,z as je,p as ge,U as ve,H as fe,I as _e,P as ye}from"./app-DEGgoab9.js";import{I as g}from"./input-1skZDOCu.js";import{L as m}from"./label-DyCc8r5j.js";import{P as Ne,a as be,b as Ce}from"./popover-B9mpw4eE.js";import{P as we,a as Se,b as ne,c as Ae,d as ke,e as Fe}from"./pagination-DgjxnQY5.js";import{S as b,a as C,b as w,c as S,d as n}from"./select-JGGC0Mgv.js";import{u as De}from"./useMutation-BaBND5Q6.js";import{c as Q}from"./admin-api-Ch68ZG0p.js";import{A as Ue,a as Pe,b as Te,c as Le,d as Ee,e as We,f as ze,g as Re}from"./alert-dialog-Do43ikJr.js";import{C as ie}from"./CenteredDash-COrKOGcy.js";import{A as Ie,a as Me}from"./arrow-up-C-wNQHX4.js";import{A as qe}from"./arrow-down-DGf3_0RY.js";import{C as Oe}from"./check-RkjWs7wE.js";import{S as He,a as Ve,b as $e,c as Be}from"./sheet-CjCqnXjR.js";import{S as P}from"./separator-eKjU6q3J.js";import{S as Qe}from"./switch-DS_Y0Cbl.js";import{u as Xe}from"./useAutoSave-CYW_GAfS.js";import{U as me}from"./user-CKr1UnUQ.js";import{B as Ye}from"./building-2-ADJFy-6W.js";import{S as Ge}from"./shield-BOYdibSh.js";import{C as Ze}from"./chevron-up-Dry_WOTS.js";import{C as Je,a as Ke}from"./card-uxUAVHNy.js";import{D as es,a as ss,c as ts,d as as,e as ns,f as is}from"./dialog-CLfAwBUe.js";import{F as rs}from"./filter-BkuWtzCT.js";/* empty css            */import"./index-Dn_VlTCY.js";import"./Combination-Dm0hFAPF.js";import"./index-BdQq_4o_.js";import"./index-CfEoTzS4.js";import"./index-D7gcp3at.js";import"./index-B4RoVyNO.js";import"./index-D-qTxAoe.js";function ls({page:s=1,limit:d=25,sortColumn:v="created_at",sortDirection:i="desc",search:y="",role:h="",userType:f}={}){return ce({queryKey:["admin","admin-users",s,d,v,i,y,h,f],queryFn:async()=>{const N=(s-1)*d;return Q("get_admin_users",{limit:d.toString(),offset:N.toString(),sortColumn:v,sortDirection:i,search:y,role:h,userType:f??""})},retry:1,staleTime:120*1e3})}function xe(){const s=de();return De({mutationFn:async({id:d,...v})=>Q("update_admin_user",{id:d},v),onSuccess:()=>{s.invalidateQueries({queryKey:["admin","admin-users"]}),I.success("User updated successfully")},onError:d=>{I.error(d.message||"Failed to update user")}})}function cs(){return ce({queryKey:["admin","companies"],queryFn:async()=>Q("get_companies"),staleTime:300*1e3})}function ds(s){return ce({queryKey:["admin","login-history",s],queryFn:async()=>s?Q("get_user_login_history",{userId:s}):[],enabled:!!s,staleTime:60*1e3})}const os={client:"Client",partner:"Partner",employee:"Employee",sales_rep:"Sales Rep",admin:"Admin",super_admin:"Super Admin"},ms=[{value:"client",label:"Client"},{value:"partner",label:"Partner"},{value:"employee",label:"Employee"},{value:"sales_rep",label:"Sales Rep"},{value:"admin",label:"Admin"},{value:"super_admin",label:"Super Admin"}],us=[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"suspended",label:"Suspended"}],Z={display_name:{key:"display_name",label:"Name",sortable:!0,minWidth:150,defaultWidth:180,editable:!0,editType:"text",render:s=>s.display_name},phone:{key:"phone",label:"Phone",sortable:!1,minWidth:130,defaultWidth:150,editable:!0,editType:"text",render:s=>s.phone?ue(s.phone):e.jsx(ie,{})},email:{key:"email",label:"Email",sortable:!0,minWidth:180,defaultWidth:220,editable:!1,render:s=>s.email},user_type:{key:"user_type",label:"User Type",sortable:!0,minWidth:100,defaultWidth:120,editable:!0,editType:"select",options:ms,render:s=>os[s.user_type]||s.user_type},status:{key:"status",label:"Status",sortable:!0,minWidth:80,defaultWidth:100,editable:!0,editType:"select",options:us,render:s=>s.status.charAt(0).toUpperCase()+s.status.slice(1)},primary_company:{key:"primary_company",label:"Primary Company",sortable:!1,minWidth:140,defaultWidth:180,editable:!0,editType:"text",render:s=>s.primary_company_name||"Individual"},subscription_status:{key:"subscription_status",label:"Subscription",sortable:!0,minWidth:100,defaultWidth:120,editable:!0,editType:"text",render:s=>s.subscription_status||e.jsx(ie,{})},last_login:{key:"last_login",label:"Last Login",sortable:!0,minWidth:130,defaultWidth:160,centered:!0,editable:!1,render:s=>s.last_login?J(s.last_login):"Never"},created_at:{key:"created_at",label:"Created",sortable:!0,minWidth:130,defaultWidth:160,centered:!0,editable:!1,render:s=>s.created_at?J(s.created_at):e.jsx(ie,{})}},hs=["display_name","phone","email","user_type","status","primary_company","subscription_status","last_login","created_at"];function xs({adminUsers:s,loading:d,sortColumn:v,sortDirection:i,onSort:y,onUserClick:h}){const f=de(),N=xe(),A=hs.filter(a=>Z[a]),[p,x]=o.useState({}),[q,D]=o.useState(null),[u,t]=o.useState({}),U=o.useRef(0),T=o.useRef(0),[k,O]=o.useState(null),[H,L]=o.useState(""),[V,X]=o.useState(null),[E,$]=o.useState(!1),Y=a=>u[a]!==void 0?u[a]:p[a]||Z[a]?.defaultWidth||150,W=o.useCallback((a,l)=>{a.preventDefault(),a.stopPropagation(),D(l),U.current=a.clientX,T.current=p[l]||Z[l]?.defaultWidth||150;const r=j=>{const F=j.clientX-U.current,B=Math.max(20,T.current+F);t(R=>({...R,[l]:B}))},c=j=>{const F=j.clientX-U.current,B=Math.max(20,T.current+F);x(R=>({...R,[l]:B})),t(R=>{const oe={...R};return delete oe[l],oe}),D(null),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",c)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",c)},[p]),z=(a,l)=>{O({userId:a.id,field:l}),L(a[l]||"")},G=()=>{O(null),L("")},K=async a=>{if(k)try{await N.mutateAsync({id:a.id,[k.field]:H}),O(null),L("")}catch{}},se=async()=>{if(V){$(!0);try{await Q("delete_admin_user",{id:V}),I.success("User deleted successfully"),f.invalidateQueries({queryKey:["admin","admin-users"]})}catch(a){I.error(a instanceof Error?a.message:"Failed to delete user")}finally{$(!1),X(null)}}},te=({column:a})=>v!==a?e.jsx(Ie,{className:"h-4 w-4 ml-1 opacity-50 flex-shrink-0"}):i==="asc"?e.jsx(Me,{className:"h-4 w-4 ml-1 flex-shrink-0"}):e.jsx(qe,{className:"h-4 w-4 ml-1 flex-shrink-0"}),ee=(a,l)=>k?.userId===a.id&&k?.field===l.key?l.editType==="select"&&l.options?e.jsxs("div",{className:"flex items-center gap-1",onClick:c=>c.stopPropagation(),children:[e.jsxs(b,{value:H,onValueChange:c=>{L(c),N.mutate({id:a.id,[l.key]:c}),O(null)},children:[e.jsx(C,{className:"h-7 text-xs",children:e.jsx(w,{})}),e.jsx(S,{children:l.options.map(c=>e.jsx(n,{value:c.value,children:c.label},c.value))})]}),e.jsx(_,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:G,children:e.jsx(le,{className:"h-3 w-3"})})]}):e.jsxs("div",{className:"flex items-center gap-1",onClick:c=>c.stopPropagation(),children:[e.jsx(g,{value:H,onChange:c=>L(c.target.value),className:"h-7 text-xs",autoFocus:!0,onKeyDown:c=>{c.key==="Enter"&&K(a),c.key==="Escape"&&G()}}),e.jsx(_,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>K(a),children:e.jsx(Oe,{className:"h-3 w-3"})}),e.jsx(_,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:G,children:e.jsx(le,{className:"h-3 w-3"})})]}):e.jsx("div",{className:`truncate ${l.editable?"cursor-pointer hover:bg-muted/50 rounded px-1 -mx-1":""}`,onDoubleClick:l.editable?()=>z(a,l.key):void 0,title:l.editable?"Double-click to edit":void 0,children:l.render?l.render(a):"â€”"});return d&&s.length===0?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(M,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):!d&&s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:[e.jsx("p",{children:"No users found"}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[d&&e.jsx("div",{className:"absolute inset-0 bg-background/50 flex items-center justify-center z-20",children:e.jsx(M,{className:"h-6 w-6 animate-spin text-primary"})}),e.jsxs("table",{style:{tableLayout:"fixed",width:"max-content",minWidth:"100%"},className:"w-full caption-bottom text-sm",children:[e.jsx("thead",{className:"[&_tr]:border-b",children:e.jsxs("tr",{className:"border-b transition-colors bg-background",children:[A.map((a,l)=>{const r=Z[a],c=Y(a),j=l===0;return e.jsxs("th",{className:`h-12 px-4 text-left align-middle font-medium text-muted-foreground bg-background relative group transition-all sticky top-0 ${j?"left-0 z-30 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]":"z-20"}`,style:{width:`${c}px`,minWidth:"20px"},children:[e.jsxs("div",{className:`flex items-center ${r.centered?"justify-center":""} ${r.sortable?"cursor-pointer select-none hover:text-foreground":""}`,onClick:()=>r.sortable&&y(a),children:[e.jsx("span",{style:{wordBreak:"keep-all",overflowWrap:"normal",whiteSpace:"nowrap"},children:r.label}),r.sortable&&e.jsx(te,{column:a})]}),e.jsx("div",{className:`absolute right-0 top-0 h-full w-1 cursor-col-resize hover:bg-primary/50 transition-colors ${q===a?"bg-primary":"bg-transparent group-hover:bg-border"}`,onMouseDown:F=>W(F,a)})]},a)}),e.jsx("th",{className:"h-12 px-4 text-center align-middle font-medium text-muted-foreground bg-background sticky top-0 z-20",style:{width:"60px"},children:e.jsx("span",{className:"sr-only",children:"Actions"})})]})}),e.jsx("tbody",{className:"[&_tr:last-child]:border-0",children:s.map(a=>e.jsxs("tr",{className:"border-b transition-colors hover:bg-muted/50 align-top",children:[A.map((l,r)=>{const c=Z[l],j=l==="display_name",F=Y(l),R=r===0?"sticky left-0 z-10 bg-background shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]":"";return e.jsx("td",{className:`p-4 align-middle ${c.centered?"text-center":""} ${j&&!k?"cursor-pointer hover:text-lime-300 font-medium text-lime-400":""} ${R}`,style:{width:`${F}px`,maxWidth:`${F}px`},onClick:j&&!k?()=>h(a):void 0,children:ee(a,c)},l)}),e.jsx("td",{className:"p-4 align-middle text-center",style:{width:"60px"},children:e.jsx(_,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:l=>{l.stopPropagation(),X(a.id)},title:"Delete user",children:e.jsx(he,{className:"h-4 w-4"})})})]},a.id))})]})]}),e.jsx(Ue,{open:!!V,onOpenChange:()=>X(null),children:e.jsxs(Pe,{children:[e.jsxs(Te,{children:[e.jsx(Le,{children:"Delete User"}),e.jsx(Ee,{children:"Are you sure you want to delete this user? This action cannot be undone."})]}),e.jsxs(We,{children:[e.jsx(ze,{disabled:E,children:"Cancel"}),e.jsxs(Re,{onClick:se,disabled:E,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[E&&e.jsx(M,{className:"h-4 w-4 mr-2 animate-spin"}),"Delete"]})]})]})})]})}const ps={client:"Client",partner:"Partner",employee:"Employee",sales_rep:"Sales Rep",admin:"Admin",super_admin:"Super Admin"},js={admin:"Admin",manager:"Manager",standard:"Standard",limited:"Limited"};function gs({user:s,open:d,onClose:v}){const[i,y]=o.useState({}),[h,f]=o.useState(!1),N=xe(),{data:A=[]}=cs(),{data:p=[]}=ds(s?.user_id||null);o.useEffect(()=>{s&&(y({first_name:s.first_name||"",last_name:s.last_name||"",phone:s.phone||"",timezone:s.timezone||"America/New_York",user_type:s.user_type,primary_company_id:s.primary_company_id,access_level:s.access_level,status:s.status,two_factor_status:s.two_factor_status,subscription_status:s.subscription_status||"",contract_signed:s.contract_signed,contract_signed_date:s.contract_signed_date,commission_rate:s.commission_rate,agreement_status:s.agreement_status||"",total_revenue_influenced:s.total_revenue_influenced,commission_structure:s.commission_structure||"",revenue_attributed:s.revenue_attributed,hire_date:s.hire_date,rep_status:s.rep_status||"active",start_date:s.start_date,employment_type:s.employment_type||""}),f(!1))},[s,d]);const x=o.useMemo(()=>s?{first_name:s.first_name||"",last_name:s.last_name||"",phone:s.phone||"",timezone:s.timezone||"America/New_York",user_type:s.user_type,primary_company_id:s.primary_company_id,access_level:s.access_level,status:s.status,two_factor_status:s.two_factor_status,subscription_status:s.subscription_status||"",contract_signed:s.contract_signed,contract_signed_date:s.contract_signed_date,commission_rate:s.commission_rate,agreement_status:s.agreement_status||"",total_revenue_influenced:s.total_revenue_influenced,commission_structure:s.commission_structure||"",revenue_attributed:s.revenue_attributed,hire_date:s.hire_date,rep_status:s.rep_status||"active",start_date:s.start_date,employment_type:s.employment_type||""}:null,[s]),q=o.useCallback(async t=>{if(!s)return!1;try{return await N.mutateAsync({id:s.id,...t}),!0}catch{return!1}},[s,N]),{isSaving:D}=Xe({data:i,onSave:q,enabled:!!s&&d,initialData:x}),u=(t,U)=>{y(T=>({...T,[t]:U}))};return s?e.jsx(He,{open:d,onOpenChange:v,children:e.jsxs(Ve,{className:"w-full sm:max-w-lg overflow-y-auto",children:[e.jsxs($e,{className:"pb-4",children:[e.jsxs(Be,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-5 w-5"}),s.display_name]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(ae,{variant:"outline",className:"capitalize",children:ps[s.user_type]}),e.jsx(ae,{variant:"outline",className:"capitalize",children:js[s.access_level]}),e.jsx(ae,{variant:s.status==="active"?"default":"destructive",className:"capitalize",children:s.status})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:[e.jsx(me,{className:"h-4 w-4"}),"Identity & Contact"]}),e.jsx(P,{}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"first_name",children:"First Name"}),e.jsx(g,{id:"first_name",value:i.first_name||"",onChange:t=>u("first_name",t.target.value),placeholder:"First name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"last_name",children:"Last Name"}),e.jsx(g,{id:"last_name",value:i.last_name||"",onChange:t=>u("last_name",t.target.value),placeholder:"Last name"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"email",children:"Email Address (Login Identifier)"}),e.jsx(g,{id:"email",type:"email",value:s.email,disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Editable only by Admin"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"phone",children:"Phone Number"}),e.jsx(g,{id:"phone",value:i.phone||"",onChange:t=>u("phone",t.target.value),placeholder:"(555) 123-4567"}),i.phone&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Display: ",ue(i.phone)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"timezone",children:"Time Zone"}),e.jsxs(b,{value:i.timezone||"America/New_York",onValueChange:t=>u("timezone",t),children:[e.jsx(C,{children:e.jsx(w,{placeholder:"Select timezone"})}),e.jsxs(S,{children:[e.jsx(n,{value:"America/New_York",children:"Eastern (ET)"}),e.jsx(n,{value:"America/Chicago",children:"Central (CT)"}),e.jsx(n,{value:"America/Denver",children:"Mountain (MT)"}),e.jsx(n,{value:"America/Los_Angeles",children:"Pacific (PT)"}),e.jsx(n,{value:"America/Phoenix",children:"Arizona (AZ)"}),e.jsx(n,{value:"America/Anchorage",children:"Alaska (AK)"}),e.jsx(n,{value:"Pacific/Honolulu",children:"Hawaii (HI)"}),e.jsx(n,{value:"UTC",children:"UTC"})]})]})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:[e.jsx(Ye,{className:"h-4 w-4"}),"Account Classification"]}),e.jsx(P,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"user_type",children:"User Type"}),e.jsxs(b,{value:i.user_type,onValueChange:t=>{u("user_type",t),u("access_level",{client:"limited",partner:"limited",employee:"manager",sales_rep:"manager",admin:"manager",super_admin:"admin"}[t])},children:[e.jsx(C,{children:e.jsx(w,{placeholder:"Select user type"})}),e.jsxs(S,{children:[e.jsx(n,{value:"client",children:"Client"}),e.jsx(n,{value:"partner",children:"Partner"}),e.jsx(n,{value:"employee",children:"Employee"}),e.jsx(n,{value:"sales_rep",children:"Sales Rep"}),e.jsx(n,{value:"admin",children:"Admin"}),e.jsx(n,{value:"super_admin",children:"Super Admin"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"primary_company",children:"Primary Company"}),e.jsxs(b,{value:i.primary_company_id||"individual",onValueChange:t=>u("primary_company_id",t==="individual"?null:t),children:[e.jsx(C,{children:e.jsx(w,{placeholder:"Select company"})}),e.jsxs(S,{children:[e.jsx(n,{value:"individual",children:"Individual"}),A.map(t=>e.jsx(n,{value:t.id,children:t.name},t.id))]})]})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:[e.jsx(Ge,{className:"h-4 w-4"}),"Access & Security"]}),e.jsx(P,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"two_factor_status",children:"2FA Status"}),e.jsxs(b,{value:i.two_factor_status,onValueChange:t=>u("two_factor_status",t),children:[e.jsx(C,{children:e.jsx(w,{placeholder:"Select 2FA status"})}),e.jsxs(S,{children:[e.jsx(n,{value:"disabled",children:"Disabled"}),e.jsx(n,{value:"enabled",children:"Enabled"}),e.jsx(n,{value:"required",children:"Required"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"status",children:"Status"}),e.jsxs(b,{value:i.status,onValueChange:t=>u("status",t),children:[e.jsx(C,{children:e.jsx(w,{placeholder:"Select status"})}),e.jsxs(S,{children:[e.jsx(n,{value:"active",children:"Active"}),e.jsx(n,{value:"inactive",children:"Inactive"}),e.jsx(n,{value:"suspended",children:"Suspended"})]})]}),i.status==="suspended"&&e.jsx("p",{className:"text-xs text-destructive",children:"Suspending immediately revokes access"})]}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Last Login"}),e.jsx("span",{className:"text-sm font-medium",children:s.last_login?J(s.last_login):"Never"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(_,{type:"button",variant:"ghost",size:"sm",className:"w-full justify-between",onClick:()=>f(!h),children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),"Login History"]}),h?e.jsx(Ze,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})]}),h&&e.jsx("div",{className:"bg-muted/50 rounded-md p-3 space-y-2 max-h-40 overflow-y-auto",children:p.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"No login history"}):p.map(t=>e.jsxs("div",{className:"text-xs flex justify-between",children:[e.jsx("span",{children:J(t.created_at)}),e.jsx("span",{className:"text-muted-foreground truncate ml-2",children:t.ip_address||"Unknown IP"})]},t.id))})]})]}),i.user_type==="client"&&e.jsxs("section",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Client Details"}),e.jsx(P,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"subscription_status",children:"Subscription Status"}),e.jsx(g,{id:"subscription_status",value:i.subscription_status||"",onChange:t=>u("subscription_status",t.target.value),placeholder:"e.g., Active, Cancelled, Paused"})]}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx(m,{htmlFor:"contract_signed",className:"cursor-pointer",children:"Contract Signed"}),e.jsx(Qe,{id:"contract_signed",checked:i.contract_signed||!1,onCheckedChange:t=>u("contract_signed",t)})]}),i.contract_signed&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"contract_signed_date",children:"Contract Signed Date"}),e.jsx(g,{id:"contract_signed_date",type:"date",value:i.contract_signed_date||"",onChange:t=>u("contract_signed_date",t.target.value||null)})]})]}),i.user_type==="partner"&&e.jsxs("section",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Partner Details"}),e.jsx(P,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"commission_rate",children:"Commission Rate (%)"}),e.jsx(g,{id:"commission_rate",type:"number",step:"0.01",value:i.commission_rate??"",onChange:t=>u("commission_rate",t.target.value?parseFloat(t.target.value):null),placeholder:"e.g., 10.00"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"agreement_status",children:"Agreement Status"}),e.jsx(g,{id:"agreement_status",value:i.agreement_status||"",onChange:t=>u("agreement_status",t.target.value),placeholder:"e.g., Signed, Pending, Expired"})]}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Revenue Influenced"}),e.jsxs("span",{className:"text-sm font-medium",children:["$",(i.total_revenue_influenced||0).toLocaleString()]})]})]}),i.user_type==="sales_rep"&&e.jsxs("section",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Sales Rep Details"}),e.jsx(P,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"commission_structure",children:"Commission Structure"}),e.jsx(g,{id:"commission_structure",value:i.commission_structure||"",onChange:t=>u("commission_structure",t.target.value),placeholder:"e.g., 5% of revenue"})]}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Revenue Attributed"}),e.jsxs("span",{className:"text-sm font-medium",children:["$",(i.revenue_attributed||0).toLocaleString()]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"hire_date",children:"Hire Date"}),e.jsx(g,{id:"hire_date",type:"date",value:i.hire_date||"",onChange:t=>u("hire_date",t.target.value||null)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"rep_status",children:"Rep Status"}),e.jsxs(b,{value:i.rep_status||"active",onValueChange:t=>u("rep_status",t),children:[e.jsx(C,{children:e.jsx(w,{placeholder:"Select rep status"})}),e.jsxs(S,{children:[e.jsx(n,{value:"active",children:"Active"}),e.jsx(n,{value:"inactive",children:"Inactive"})]})]})]})]}),i.user_type==="employee"&&e.jsxs("section",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"Employee Details"}),e.jsx(P,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"title",children:"Title"}),e.jsx(g,{id:"title",value:s.title||"",disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"start_date",children:"Start Date"}),e.jsx(g,{id:"start_date",type:"date",value:i.start_date||"",onChange:t=>u("start_date",t.target.value||null)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"employment_type",children:"Employment Type"}),e.jsxs(b,{value:i.employment_type||"",onValueChange:t=>u("employment_type",t),children:[e.jsx(C,{children:e.jsx(w,{placeholder:"Select employment type"})}),e.jsxs(S,{children:[e.jsx(n,{value:"full_time",children:"Full-Time"}),e.jsx(n,{value:"part_time",children:"Part-Time"}),e.jsx(n,{value:"contractor",children:"Contractor"})]})]})]})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide",children:"System Metadata"}),e.jsx(P,{}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between py-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"User ID (UUID)"}),e.jsx("span",{className:"font-mono text-xs truncate max-w-[180px]",title:s.user_id,children:s.user_id})]}),e.jsxs("div",{className:"flex justify-between py-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Created By"}),e.jsx("span",{children:s.created_by||"System"})]}),e.jsxs("div",{className:"flex justify-between py-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Created Date"}),e.jsx("span",{children:ge(s.created_at)})]}),e.jsxs("div",{className:"flex justify-between py-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last Updated"}),e.jsx("span",{children:J(s.updated_at)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t",children:[e.jsxs(_,{variant:"destructive",className:"flex-1",disabled:!0,children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Delete",D&&e.jsx(M,{className:"h-3 w-3 ml-2 animate-spin"})]}),e.jsx(_,{variant:"outline",className:"flex-1",onClick:v,children:"Close"})]})]})]})}):null}function vs({total:s,loading:d}){return d?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(M,{className:"h-6 w-6 animate-spin text-primary"})}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:e.jsx(Je,{children:e.jsx(Ke,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-full",children:e.jsx(ve,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Registered Users"}),e.jsx("p",{className:"text-2xl font-bold",children:s})]})]})})})})}const re={client:"limited",partner:"limited",employee:"manager",sales_rep:"manager",admin:"manager",super_admin:"admin"};function fs({open:s,onOpenChange:d}){const v=de(),[i,y]=o.useState(!1),[h,f]=o.useState({first_name:"",last_name:"",email:"",phone:"",user_type:"client"}),N=p=>{f(x=>({...x,user_type:p}))},A=async p=>{if(p.preventDefault(),!h.email||!h.first_name||!h.last_name){I.error("Please fill in all required fields");return}y(!0);try{const x={...h,access_level:re[h.user_type]};await Q("create_admin_user",void 0,x),I.success("User created successfully"),v.invalidateQueries({queryKey:["admin","admin-users"]}),d(!1),f({first_name:"",last_name:"",email:"",phone:"",user_type:"client"})}catch(x){I.error(x instanceof Error?x.message:"Failed to create user")}finally{y(!1)}};return e.jsx(es,{open:s,onOpenChange:d,children:e.jsxs(ss,{className:"sm:max-w-md",children:[e.jsxs(ts,{children:[e.jsx(as,{children:"Add New User"}),e.jsx(ns,{children:"Create a new user account in the system."})]}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"first_name",children:"First Name *"}),e.jsx(g,{id:"first_name",value:h.first_name,onChange:p=>f(x=>({...x,first_name:p.target.value})),placeholder:"First name",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"last_name",children:"Last Name *"}),e.jsx(g,{id:"last_name",value:h.last_name,onChange:p=>f(x=>({...x,last_name:p.target.value})),placeholder:"Last name",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"email",children:"Email *"}),e.jsx(g,{id:"email",type:"email",value:h.email,onChange:p=>f(x=>({...x,email:p.target.value})),placeholder:"user@example.com",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"phone",children:"Phone"}),e.jsx(g,{id:"phone",value:h.phone,onChange:p=>f(x=>({...x,phone:p.target.value})),placeholder:"Phone number"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"user_type",children:"User Type"}),e.jsxs(b,{value:h.user_type,onValueChange:N,children:[e.jsx(C,{children:e.jsx(w,{placeholder:"Select user type"})}),e.jsxs(S,{children:[e.jsx(n,{value:"client",children:"Client"}),e.jsx(n,{value:"partner",children:"Partner"}),e.jsx(n,{value:"employee",children:"Employee"}),e.jsx(n,{value:"sales_rep",children:"Sales Rep"}),e.jsx(n,{value:"admin",children:"Admin"}),e.jsx(n,{value:"super_admin",children:"Super Admin"})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Access level: ",re[h.user_type].charAt(0).toUpperCase()+re[h.user_type].slice(1)]})]}),e.jsxs(is,{children:[e.jsx(_,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsxs(_,{type:"submit",disabled:i,children:[i&&e.jsx(M,{className:"h-4 w-4 mr-2 animate-spin"}),"Create User"]})]})]})]})})}function Js(){const[s,d]=o.useState(1),[v,i]=o.useState(50),[y,h]=o.useState(""),[f,N]=o.useState(""),[A,p]=o.useState("created_at"),[x,q]=o.useState("desc"),[D,u]=o.useState({}),[t,U]=o.useState(!1),[T,k]=o.useState(null),[O,H]=o.useState(!1),[L,V]=o.useState(!1),X=r=>{h(r);const c=setTimeout(()=>{N(r),d(1)},300);return()=>clearTimeout(c)},{data:E,isLoading:$}=ls({page:s,limit:v,sortColumn:A,sortDirection:x,search:f}),Y=E?.adminUsers||[],W=E?.total||0,z=E?.totalPages||0,G=r=>{A===r?q(x==="asc"?"desc":"asc"):(p(r),q("asc")),d(1)},K=r=>{k(r),H(!0)},se=()=>{H(!1),k(null)},te=r=>{i(parseInt(r)),d(1)},ee=(r,c)=>{u(j=>{if(!c){const{[r]:F,...B}=j;return B}return{...j,[r]:c}}),d(1)},a=()=>{u({}),d(1)},l=Object.keys(D).length;return $&&Y.length===0?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(M,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{children:e.jsx("title",{children:"Users | Admin"})}),e.jsxs("div",{className:"flex flex-col h-[calc(100vh-64px)] overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 p-6 pb-4 space-y-4 bg-background",children:[e.jsx(vs,{total:W,loading:$}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Users"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[W," registered users"]})]}),e.jsx("div",{className:"flex items-center gap-1 border-l pl-6",children:e.jsx(_,{variant:"secondary",size:"sm",className:"text-sm",children:"All"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(_e,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(g,{placeholder:"Search users...",value:y,onChange:r=>X(r.target.value),className:"pl-9 w-64"})]}),e.jsxs(Ne,{open:t,onOpenChange:U,children:[e.jsx(be,{asChild:!0,children:e.jsxs(_,{variant:"outline",className:"relative",children:[e.jsx(rs,{className:"h-4 w-4 mr-2"}),"Filters",l>0&&e.jsx("span",{className:"absolute -top-1 -right-1 h-5 w-5 rounded-full bg-primary text-primary-foreground text-xs flex items-center justify-center",children:l})]})}),e.jsx(Ce,{className:"w-80",align:"end",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Filters"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Role"}),e.jsxs(b,{value:D.role||"",onValueChange:r=>ee("role",r),children:[e.jsx(C,{children:e.jsx(w,{placeholder:"All roles"})}),e.jsxs(S,{children:[e.jsx(n,{value:"",children:"All"}),e.jsx(n,{value:"client",children:"Client"}),e.jsx(n,{value:"partner",children:"Partner"}),e.jsx(n,{value:"sales_rep",children:"Sales Rep"}),e.jsx(n,{value:"employee",children:"Employee"}),e.jsx(n,{value:"admin",children:"Admin"})]})]})]}),l>0&&e.jsx(_,{variant:"ghost",size:"sm",onClick:a,className:"w-full",children:"Clear all filters"})]})})]}),e.jsxs(_,{onClick:()=>V(!0),children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Add User"]})]})]}),l>0&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Active filters:"}),Object.entries(D).map(([r,c])=>e.jsxs(_,{variant:"secondary",size:"sm",onClick:()=>ee(r,""),className:"h-6 text-xs",children:[r,": ",c,e.jsx(le,{className:"h-3 w-3 ml-1"})]},r)),e.jsx(_,{variant:"ghost",size:"sm",onClick:a,className:"h-6 text-xs",children:"Clear all"})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden px-6",children:e.jsx("div",{className:"border rounded-lg h-full overflow-auto",children:e.jsx(xs,{adminUsers:Y,loading:$,sortColumn:A,sortDirection:x,onSort:G,onUserClick:K})})}),e.jsx("div",{className:"flex-shrink-0 px-6 py-4 bg-background border-t",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Rows per page:"}),e.jsxs(b,{value:v.toString(),onValueChange:te,children:[e.jsx(C,{className:"w-20",children:e.jsx(w,{})}),e.jsxs(S,{children:[e.jsx(n,{value:"25",children:"25"}),e.jsx(n,{value:"50",children:"50"}),e.jsx(n,{value:"100",children:"100"})]})]}),e.jsxs("span",{className:"text-sm text-muted-foreground ml-4",children:["Showing ",Math.min((s-1)*v+1,W)," -"," ",Math.min(s*v,W)," of ",W]})]}),z>1&&e.jsx(we,{children:e.jsxs(Se,{children:[e.jsx(ne,{children:e.jsx(Ae,{onClick:()=>d(r=>Math.max(1,r-1)),className:s===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:Math.min(5,z)},(r,c)=>{const j=s<=3?c+1:s+c-2;return j<1||j>z?null:e.jsx(ne,{children:e.jsx(ke,{onClick:()=>d(j),isActive:s===j,className:"cursor-pointer",children:j})},j)}),e.jsx(ne,{children:e.jsx(Fe,{onClick:()=>d(r=>Math.min(z,r+1)),className:s===z?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})]}),e.jsx(gs,{user:T,open:O,onClose:se}),e.jsx(fs,{open:L,onOpenChange:V})]})}export{Js as default};
