import{ba as L,r as n,q as F,s as I,j as e,E,k as W,g as V,e as A}from"./app-4HzrmfBH.js";import{I as P}from"./input-CBRyo5y3.js";import{C as a,b as c,c as o,a as r,d as U}from"./card-Bm8wZBfx.js";import{T as B,a as H,b as f,c as d,d as R,e as i}from"./table-B19ek79J.js";import{S as q,a as Q,b as Y,c as O,d as x}from"./select-B8OCnYr5.js";import{S as X}from"./skeleton-DjRgmFeK.js";import{F as z}from"./filter-DVyDn7yP.js";import{C as G}from"./circle-x-BjVJplgf.js";import{C as J}from"./circle-check-CNlsgO6M.js";import{A as K}from"./arrow-up-right-BSjjFVWD.js";import{T as M}from"./trending-up-qOy8bAKG.js";/* empty css            */import"./index-BdQq_4o_.js";import"./index-x88ZtXLl.js";import"./Combination-Qxmo0n5Z.js";import"./index-Bs0kLRia.js";import"./check-Cdb1fOfs.js";import"./chevron-up-D1ZX3dXR.js";const N={new:{label:"New",icon:V,className:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400"},in_progress:{label:"In Progress",icon:K,className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400"},closed_won:{label:"Closed Won",icon:J,className:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400"},closed_lost:{label:"Closed Lost",icon:G,className:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}};function pe(){const{partner:h,status:Z}=L(),[l,b]=n.useState([]),[w,y]=n.useState(!0),[u,C]=n.useState(""),[g,v]=n.useState("all"),{toast:_}=F();n.useEffect(()=>{S()},[h?.id]);const S=async()=>{if(h?.id)try{const{data:s,error:t}=await I.from("partner_deals").select("*").eq("partner_id",h.id).order("created_at",{ascending:!1});if(t)throw t;b(s||[])}catch(s){console.error("Error fetching deals:",s),_({title:"Error",description:"Failed to load deals",variant:"destructive"})}finally{y(!1)}},p=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),m=l.filter(s=>{const t=s.client_name.toLowerCase().includes(u.toLowerCase())||s.client_email?.toLowerCase().includes(u.toLowerCase()),j=g==="all"||s.stage===g;return t&&j});l.reduce((s,t)=>s+t.deal_value,0);const D=l.filter(s=>s.stage==="closed_won").reduce((s,t)=>s+t.deal_value,0),k=l.filter(s=>s.stage==="new"||s.stage==="in_progress").length,T=l.filter(s=>s.stage==="closed_won").length;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Deals"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track the progress of your referred deals"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(a,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Total Deals"})}),e.jsx(r,{children:e.jsx("div",{className:"text-2xl font-bold",children:l.length})})]}),e.jsxs(a,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Open Deals"})}),e.jsx(r,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:k})})]}),e.jsxs(a,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Won Deals"})}),e.jsx(r,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:T})})]}),e.jsxs(a,{children:[e.jsx(c,{className:"pb-2",children:e.jsx(o,{className:"text-sm font-medium text-muted-foreground",children:"Won Value"})}),e.jsx(r,{children:e.jsx("div",{className:"text-2xl font-bold text-primary",children:p(D)})})]})]}),e.jsx(a,{children:e.jsx(r,{className:"py-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(E,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(P,{placeholder:"Search by client name or email...",className:"pl-10",value:u,onChange:s=>C(s.target.value)})]}),e.jsxs(q,{value:g,onValueChange:v,children:[e.jsxs(Q,{className:"w-[180px]",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),e.jsx(Y,{placeholder:"Filter by stage"})]}),e.jsxs(O,{children:[e.jsx(x,{value:"all",children:"All Stages"}),e.jsx(x,{value:"new",children:"New"}),e.jsx(x,{value:"in_progress",children:"In Progress"}),e.jsx(x,{value:"closed_won",children:"Closed Won"}),e.jsx(x,{value:"closed_lost",children:"Closed Lost"})]})]})]})})}),e.jsxs(a,{children:[e.jsxs(c,{children:[e.jsx(o,{children:"Your Deals"}),e.jsxs(U,{children:[m.length," deal",m.length!==1?"s":""," found"]})]}),e.jsx(r,{children:w?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,t)=>e.jsx(X,{className:"h-16 w-full"},t))}):m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(W,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No deals yet"}),e.jsx("p",{className:"text-muted-foreground",children:"When your referrals convert to deals, they'll appear here."})]}):e.jsxs(B,{children:[e.jsx(H,{children:e.jsxs(f,{children:[e.jsx(d,{children:"Client"}),e.jsx(d,{children:"Deal Value"}),e.jsx(d,{children:"Stage"}),e.jsx(d,{children:"Expected Close"}),e.jsx(d,{children:"Created"})]})}),e.jsx(R,{children:m.map(s=>{const t=N[s.stage]||N.new,j=t.icon;return e.jsxs(f,{children:[e.jsx(i,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.client_name}),s.client_email&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.client_email})]})}),e.jsx(i,{children:e.jsx("span",{className:"font-semibold",children:p(s.deal_value)})}),e.jsx(i,{children:e.jsxs(A,{className:t.className,children:[e.jsx(j,{className:"h-3 w-3 mr-1"}),t.label]})}),e.jsx(i,{children:s.stage==="closed_won"&&s.closed_at?e.jsxs("span",{className:"text-sm text-green-600",children:["Won ",new Date(s.closed_at).toLocaleDateString()]}):s.stage==="closed_lost"?e.jsx("span",{className:"text-sm text-red-600",children:"Lost"}):s.expected_close_date?e.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(s.expected_close_date).toLocaleDateString()}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"â€”"})}),e.jsx(i,{children:e.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(s.created_at).toLocaleDateString()})})]},s.id)})})]})})]}),e.jsx(a,{children:e.jsx(r,{className:"py-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center flex-shrink-0",children:e.jsx(M,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Deal Stages"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Deal stages are updated by our team as they progress through the sales pipeline. You'll earn a commission when a deal closes and the first payment is captured."})]})]})})})]})}export{pe as default};
