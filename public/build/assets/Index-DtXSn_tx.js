import{aP as p,b0 as C,j as e,a as x,e as k,K as g,u as M,s as h,r as b,U as D,R as N,E as w,ac as L,Z as q,b8 as S}from"./app-Lw9toWEL.js";import{D as _,A as f}from"./AnalyticsCard-r6nlW8vZ.js";import{C as $}from"./card-HJJ00fMS.js";import{E as F}from"./eye-COYcjsCX.js";import{T as A}from"./trending-up-DvuLVGDQ.js";import{C as E}from"./credit-card-pJcqw7N1.js";import{s as V}from"./calendar-D-sUXNp2.js";/* empty css            */import"./popover-CLKur1-R.js";import"./Combination-DTrGx453.js";import"./select-DbGhKeTs.js";import"./index-BdQq_4o_.js";import"./index-DVcw4AEI.js";import"./index-Di_FMiVt.js";import"./check-DtvS8aN0.js";import"./chevron-up-DIuzYlEQ.js";import"./endOfDay-BOU20L8Q.js";import"./subYears-DoOtRaaB.js";import"./endOfMonth-B-xDjHGe.js";function I(o,s){const t=p(o),a=p(s),n=j(t,a),l=Math.abs(C(t,a));t.setDate(t.getDate()-n*l);const c=+(j(t,a)===-n),r=n*(l-c);return r===0?0:r}function j(o,s){const t=o.getFullYear()-s.getFullYear()||o.getMonth()-s.getMonth()||o.getDate()-s.getDate()||o.getHours()-s.getHours()||o.getMinutes()-s.getMinutes()||o.getSeconds()-s.getSeconds()||o.getMilliseconds()-s.getMilliseconds();return t<0?-1:t>0?1:t}function d({name:o,icon:s,primaryMetric:t,primaryLabel:a,status:n,iconColor:l="text-muted-foreground"}){const c=r=>r===void 0?"—":typeof r=="string"?r:r>=1e6?`${(r/1e6).toFixed(1)}M`:r>=1e3?`${(r/1e3).toFixed(1)}K`:r.toLocaleString();return e.jsxs($,{className:"p-4 hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:x("p-2 rounded-lg bg-muted",l),children:typeof s=="function"&&!("$$typeof"in s)?e.jsx(s,{}):e.jsx(s,{className:"h-4 w-4"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:o}),n==="connected"?e.jsx("p",{className:"text-lg font-bold",children:a==="Revenue"?`$${c(t)}`:c(t)}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"Not configured"})]})]}),e.jsx(k,{variant:n==="connected"?"default":"secondary",className:x("shrink-0 text-[10px] px-1.5",n==="connected"&&"bg-green-500/20 text-green-400 hover:bg-green-500/30",n==="error"&&"bg-red-500/20 text-red-400",n==="not_configured"&&"bg-muted text-muted-foreground"),children:n==="connected"?"Live":n==="error"?"Error":"Setup"})]}),n==="connected"&&a&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1 ml-11",children:a})]})}function T(o){const s=o?.from?g(o.from,"yyyy-MM-dd"):void 0,t=o?.to?g(o.to,"yyyy-MM-dd"):void 0,a=!!s&&!!t,n=M({queryKey:["platform-square",s,t],queryFn:async()=>{try{const{data:u,error:y}=await h.functions.invoke("square-analytics",{body:{startDate:s,endDate:t}});return y||u?.error==="NOT_CONFIGURED"?{configured:!1,status:"not_configured"}:{configured:!0,status:"connected",primaryMetric:u.totalRevenue/100,primaryLabel:"Revenue",secondaryMetric:u.transactionCount,secondaryLabel:"Transactions"}}catch{return{configured:!1,status:"error"}}},enabled:a,retry:!1}),l=M({queryKey:["platform-clarity",s,t],queryFn:async()=>{try{const{data:u,error:y}=await h.functions.invoke("microsoft-clarity",{body:{startDate:s,endDate:t}});return y||u?.configured===!1?{configured:!1,status:"not_configured"}:{configured:!0,status:"connected",primaryMetric:u.totalSessions||0,primaryLabel:"Sessions",secondaryMetric:u.rageClicks||0,secondaryLabel:"Rage Clicks"}}catch{return{configured:!1,status:"error"}}},enabled:a,retry:!1}),c=()=>({configured:!1,status:"not_configured"}),r={ga4:c(),searchConsole:c(),youtube:c(),tiktok:c(),linkedin:c(),meta:c(),clarity:l.data||c(),square:n.data||c()},m=n.isLoading||l.isLoading,i={totalVisitors:r.ga4.configured&&r.ga4.primaryMetric||0,totalImpressions:(r.searchConsole.configured&&r.searchConsole.primaryMetric||0)+(r.youtube.configured&&r.youtube.primaryMetric||0)+(r.tiktok.configured&&r.tiktok.primaryMetric||0)+(r.linkedin.configured&&r.linkedin.primaryMetric||0)+(r.meta.configured&&r.meta.primaryMetric||0),totalEngagement:(r.youtube.configured&&r.youtube.secondaryMetric||0)+(r.tiktok.configured&&r.tiktok.secondaryMetric||0)+(r.linkedin.configured&&r.linkedin.secondaryMetric||0)+(r.meta.configured&&r.meta.secondaryMetric||0),totalRevenue:r.square.configured&&r.square.primaryMetric||0,transactionCount:r.square.configured&&r.square.secondaryMetric||0},v=Object.values(r).filter(u=>u.configured).length;return{data:r,aggregated:i,isLoading:m,connectedCount:v}}const P=()=>e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"h-4 w-4",children:e.jsx("path",{d:"M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"})}),R=()=>e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"h-4 w-4",children:e.jsx("path",{d:"M12 2.04c-5.5 0-10 4.49-10 10.02 0 5 3.66 9.15 8.44 9.9v-7H7.9v-2.9h2.54V9.85c0-2.51 1.49-3.89 3.78-3.89 1.09 0 2.23.19 2.23.19v2.47h-1.26c-1.24 0-1.63.77-1.63 1.56v1.88h2.78l-.45 2.9h-2.33v7a10 10 0 0 0 8.44-9.9c0-5.53-4.5-10.02-10-10.02z"})}),U=()=>e.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:"h-4 w-4",children:e.jsx("path",{d:"M22.84 2.998v17.997a3.003 3.003 0 0 1-6.005 0V2.998a3.003 3.003 0 0 1 6.005 0zM7.163 2.998v17.997a3.003 3.003 0 0 1-6.005 0V2.998a3.003 3.003 0 0 1 6.005 0zm7.84 8.998v9a3 3 0 0 1-6 0v-9a3 3 0 0 1 6 0z"})});function ie(){const[o,s]=b.useState({from:V(new Date,30),to:new Date}),{data:t,aggregated:a,connectedCount:n}=T(o),l=b.useMemo(()=>{if(!o?.from||!o?.to)return"Selected Period";const i=I(o.to,o.from);return i===0?"Today":i===6?"Last 7 Days":i===29||i===30?"Last 30 Days":i===89||i===90?"Last 90 Days":`${g(o.from,"M/d/yy")} - ${g(o.to,"M/d/yy")}`},[o]),c=i=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(i),r=i=>i>=1e6?`${(i/1e6).toFixed(1)}M`:i>=1e3?`${(i/1e3).toFixed(1)}K`:i.toLocaleString(),m=n>0;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Dashboard"}),e.jsxs("p",{className:"text-muted-foreground text-sm mt-1",children:[n," of 8 platforms connected"]})]}),e.jsx(_,{dateRange:o,onDateRangeChange:s})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(f,{title:`Visitors (${l})`,value:m&&a.totalVisitors>0?r(a.totalVisitors):"—",description:t.ga4.configured?"From Google Analytics":"Configure GA4 to see data",icon:D}),e.jsx(f,{title:`Impressions (${l})`,value:m&&a.totalImpressions>0?r(a.totalImpressions):"—",description:m?"Across all platforms":"Configure platforms to see data",icon:F}),e.jsx(f,{title:`Engagement (${l})`,value:m&&a.totalEngagement>0?r(a.totalEngagement):"—",description:"Likes, comments, shares",icon:A}),e.jsx(f,{title:`Gross Revenue (${l})`,value:t.square.configured?c(a.totalRevenue):"—",description:t.square.configured?`${a.transactionCount} transactions`:"Configure Square to see data",icon:N})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Platform Overview"}),e.jsxs("div",{className:"grid gap-3 grid-cols-2 lg:grid-cols-4",children:[e.jsx(d,{name:"Google Analytics",icon:()=>e.jsx(U,{}),primaryMetric:t.ga4.primaryMetric,primaryLabel:"Users",status:t.ga4.status||"not_configured",iconColor:"text-orange-500"}),e.jsx(d,{name:"Search Console",icon:w,primaryMetric:t.searchConsole.primaryMetric,primaryLabel:"Clicks",status:t.searchConsole.status||"not_configured",iconColor:"text-blue-500"}),e.jsx(d,{name:"YouTube",icon:L,primaryMetric:t.youtube.primaryMetric,primaryLabel:"Views",status:t.youtube.status||"not_configured",iconColor:"text-red-500"}),e.jsx(d,{name:"TikTok",icon:()=>e.jsx(P,{}),primaryMetric:t.tiktok.primaryMetric,primaryLabel:"Views",status:t.tiktok.status||"not_configured",iconColor:"text-foreground"}),e.jsx(d,{name:"LinkedIn",icon:q,primaryMetric:t.linkedin.primaryMetric,primaryLabel:"Impressions",status:t.linkedin.status||"not_configured",iconColor:"text-blue-600"}),e.jsx(d,{name:"Meta",icon:()=>e.jsx(R,{}),primaryMetric:t.meta.primaryMetric,primaryLabel:"Reach",status:t.meta.status||"not_configured",iconColor:"text-blue-500"}),e.jsx(d,{name:"Microsoft Clarity",icon:S,primaryMetric:t.clarity.primaryMetric,primaryLabel:"Sessions",status:t.clarity.status||"not_configured",iconColor:"text-purple-500"}),e.jsx(d,{name:"Square",icon:E,primaryMetric:t.square.primaryMetric,primaryLabel:"Revenue",status:t.square.status||"not_configured",iconColor:"text-green-500"})]})]})]})}export{ie as default};
