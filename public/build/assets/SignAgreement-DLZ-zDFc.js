import{D as E,q as D,r as i,s as c,j as e,n as j,t as I,H as y,F}from"./app-C9sJHYCL.js";import{A as T}from"./AgreementSigningFlow-C0BWLb-4.js";import{C as B}from"./circle-check-big-C6DyEQk3.js";/* empty css            */import"./input-BIyZmrfA.js";import"./checkbox-B_Z2dGVm.js";import"./index-C5ZtqSVZ.js";import"./index-H_9W4N8N.js";import"./check-BybgecC6.js";import"./purify.es-HRjpPm7y.js";const z=()=>{const{url:b}=E(),n=new URLSearchParams(b.split("?")[1]??"").get("token"),{toast:m}=D(),[N,d]=i.useState(!0),[t,g]=i.useState(null),[u,l]=i.useState(null),[_,x]=i.useState(!1),[w,f]=i.useState(!1),[v,k]=i.useState({});i.useEffect(()=>{n?S():(l("Invalid agreement link"),d(!1))},[n]);const S=async()=>{try{const{data:a,error:r}=await c.rpc("get_agreement_by_token",{agreement_token:n});if(r||!a||a.length===0){l("Agreement not found or link has expired");return}const s=a[0];if(s.status==="signed"){x(!0),g(s);return}if(s.expires_at&&new Date(s.expires_at)<new Date){l("This agreement link has expired. Please contact Cynergists for a new link.");return}g(s);const{data:o}=await c.rpc("get_agreement_sections_by_token",{agreement_token:n});if(o&&o.length>0){const h={};o.forEach((p,P)=>{p.initials&&(h[`section_${P+1}`]=p.initials)}),k(h)}await c.rpc("mark_agreement_viewed",{agreement_token:n,p_ip_address:null,p_user_agent:navigator.userAgent})}catch{l("Failed to load agreement")}finally{d(!1)}},A=async a=>{if(!(!t||!n)){f(!0);try{const{data:r,error:s}=await c.rpc("sign_agreement",{agreement_token:n,p_signer_name:a.signature.split("|")[0],p_signature:a.signature,p_ip_address:null});if(s)throw s;if(!r)throw new Error("Failed to sign agreement");x(!0),m({title:"Agreement Signed",description:"Thank you! Your agreement has been signed successfully."})}catch{m({title:"Error",description:"Failed to sign agreement. Please try again.",variant:"destructive"})}finally{f(!1)}}},C=()=>t?t.client_name.split(" ").map(r=>r[0]?.toUpperCase()||"").join(""):"AB";return N?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(j,{className:"h-8 w-8 animate-spin text-primary"})}):u?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx(I,{className:"h-16 w-16 text-destructive mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Unable to Load Agreement"}),e.jsx("p",{className:"text-muted-foreground",children:u}),e.jsxs("p",{className:"mt-4 text-sm",children:["Please contact"," ",e.jsx("a",{href:"mailto:team@cynergists.com",className:"text-primary underline",children:"team@cynergists.com"})," ","for assistance."]})]})}):_?e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:[e.jsx(y,{children:e.jsx("title",{children:"Agreement Signed | Cynergists"})}),e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx(B,{className:"h-20 w-20 text-green-500 mx-auto mb-6"}),e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Agreement Signed!"}),e.jsxs("p",{className:"text-muted-foreground mb-6",children:["Thank you, ",t?.client_name,"! Your ",t?.plan_name," Plan agreement has been signed successfully."]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-6 text-left",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"What happens next?"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-sm text-muted-foreground",children:[e.jsx("li",{children:"Our team will receive notification of your signed agreement"}),e.jsx("li",{children:"You'll receive an email to schedule your onboarding call"}),e.jsx("li",{children:"We'll set up your account and begin services"})]})]}),e.jsxs("p",{className:"mt-6 text-sm text-muted-foreground",children:["Questions? Contact us at"," ",e.jsx("a",{href:"mailto:team@cynergists.com",className:"text-primary underline",children:"team@cynergists.com"})]})]})]}):w?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(j,{className:"h-12 w-12 animate-spin text-primary mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"Signing agreement..."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Please wait"})]})}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs(y,{children:[e.jsx("title",{children:"Sign Agreement | Cynergists"}),e.jsx("meta",{name:"robots",content:"noindex, nofollow"}),e.jsx("link",{href:"https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Great+Vibes&family=Pacifico&family=Satisfy&display=swap",rel:"stylesheet"})]}),e.jsx("style",{children:`
        .font-dancing { font-family: 'Dancing Script', cursive; }
        .font-great-vibes { font-family: 'Great Vibes', cursive; }
        .font-pacifico { font-family: 'Pacifico', cursive; }
        .font-satisfy { font-family: 'Satisfy', cursive; }
      `}),e.jsx("header",{className:"border-b bg-card sticky top-0 z-40",children:e.jsx("div",{className:"container max-w-4xl py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{className:"h-7 w-7 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold",children:t?.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Prepared for ",t?.client_name,t?.client_company&&` â€¢ ${t.client_company}`]})]})]})})}),e.jsx("main",{className:"container max-w-4xl py-8",children:e.jsx("div",{className:"bg-card border rounded-lg p-8",children:e.jsx(T,{agreementContent:t?.content||"",defaultInitials:C(),defaultSignatureName:t?.client_name||"",onComplete:A,showBackButton:!1,initialSectionInitials:v})})})]})};export{z as default};
