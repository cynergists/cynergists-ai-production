import{w as M,r as f,u as q,h as u,j as e,B as g,P as K,e as D,T as Q,L as T,U as L,Q as E,aA as z,i as I}from"./app-yl1YHj2k.js";import{u as F}from"./useMutation-Dt0Tk2fE.js";import{c as v}from"./admin-api-G7yaMq_z.js";import{T as H,a as $,b as w,c as j,d as B,e as d}from"./table-Digz5nhl.js";import{I as O}from"./input-B3tD5KH9.js";import{D as U,a as G,c as R,d as V,e as J,f as W}from"./dialog-B01Lxjmp.js";import{A as Y,a as X,b as Z,c as ee,d as se,e as te,f as ae,g as re}from"./alert-dialog-DRoxD3tw.js";import{S as ne}from"./scroll-area-LKcc-MsV.js";import{T as ie}from"./tag-CHJaFGHC.js";import{T as le}from"./triangle-alert-SZFjwlm_.js";import{S as oe}from"./store-B5BUXr9u.js";import{A as ce,a as de}from"./arrow-up-CZ9sf6ut.js";import{A as me}from"./arrow-down-CHHK0kfZ.js";/* empty css            */import"./index-DC5Tape7.js";import"./Combination-BU6xJxfT.js";import"./index-KgiDK8vA.js";import"./index-BdQq_4o_.js";function xe({open:_,onOpenChange:N}){const l=M(),[i,b]=f.useState(""),[o,p]=f.useState(null),[r,A]=f.useState([]),{data:y,isLoading:m}=q({queryKey:["agent-categories"],queryFn:async()=>v("get_agent_categories")}),{data:c}=q({queryKey:["portal-agents-for-categories"],queryFn:async()=>(await v("get_ai_agents")).map(a=>({id:a.id,name:a.name,category:a.category}))}),C=F({mutationFn:async s=>{const a=y?.reduce((x,P)=>Math.max(x,P.display_order),0)||0;await v("create_agent_category",void 0,{name:s,display_order:a+1})},onSuccess:()=>{l.invalidateQueries({queryKey:["agent-categories"]}),l.invalidateQueries({queryKey:["agent-categories-names"]}),b(""),u.success("Category added successfully")},onError:s=>{s.message.includes("duplicate")?u.error("A category with this name already exists"):u.error("Failed to add category: "+s.message)}}),k=F({mutationFn:async s=>(await v("delete_agent_category",{id:s.id},{name:s.name}),r.length),onSuccess:s=>{l.invalidateQueries({queryKey:["agent-categories"]}),l.invalidateQueries({queryKey:["agent-categories-names"]}),l.invalidateQueries({queryKey:["portal-agents"]}),l.invalidateQueries({queryKey:["portal-agents-for-categories"]}),p(null),A([]),s>0?u.success(`Category deleted. ${s} agent(s) moved to "General"`):u.success("Category deleted successfully")},onError:s=>{u.error("Failed to delete category: "+s.message)}}),S=s=>{s.preventDefault(),i.trim()&&C.mutate(i.trim())},t=s=>{const a=c?.filter(x=>x.category===s.name)||[];A(a),p(s)},h=()=>{o&&k.mutate(o)},n=s=>s==="General";return e.jsxs(e.Fragment,{children:[e.jsx(U,{open:_,onOpenChange:N,children:e.jsxs(G,{className:"sm:max-w-[500px]",children:[e.jsxs(R,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),"Manage Categories"]}),e.jsx(J,{children:"Add or remove categories for AI Agents"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("form",{onSubmit:S,className:"flex gap-2",children:[e.jsx(O,{placeholder:"New category name...",value:i,onChange:s=>b(s.target.value),className:"flex-1"}),e.jsxs(g,{type:"submit",disabled:!i.trim()||C.isPending,children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"Add"]})]}),e.jsx("div",{className:"border rounded-lg",children:e.jsx(ne,{className:"h-[300px]",children:e.jsx("div",{className:"p-2 space-y-1",children:m?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Loading..."}):y?.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No categories"}):y?.map(s=>{const a=c?.filter(x=>x.category===s.name).length||0;return e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg hover:bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.name}),a>0&&e.jsxs(D,{variant:"secondary",className:"text-xs",children:[a," agent",a!==1?"s":""]}),n(s.name)&&e.jsx(D,{variant:"outline",className:"text-xs",children:"Default"})]}),!n(s.name)&&e.jsx(g,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>t(s),children:e.jsx(Q,{className:"h-4 w-4"})})]},s.id)})})})})]}),e.jsx(W,{children:e.jsx(g,{variant:"outline",onClick:()=>N(!1),children:"Close"})})]})}),e.jsx(Y,{open:!!o,onOpenChange:s=>!s&&p(null),children:e.jsxs(X,{children:[e.jsxs(Z,{children:[e.jsxs(ee,{className:"flex items-center gap-2",children:[r.length>0&&e.jsx(le,{className:"h-5 w-5 text-amber-500"}),'Delete "',o?.name,'" category?']}),e.jsx(se,{asChild:!0,children:e.jsx("div",{className:"space-y-3",children:r.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-amber-600 dark:text-amber-400 font-medium",children:["This category is currently being used by ",r.length," agent",r.length!==1?"s":"",":"]}),e.jsx("div",{className:"bg-muted/50 rounded-lg p-3 space-y-1",children:r.map(s=>e.jsxs("div",{className:"text-sm font-medium",children:["• ",s.name]},s.id))}),e.jsxs("p",{children:["If you proceed, these agents will be moved to the ",e.jsx("strong",{children:'"General"'})," category."]})]}):e.jsx("p",{children:"This category is not being used by any agents."})})})]}),e.jsxs(te,{children:[e.jsx(ae,{children:"Cancel"}),e.jsx(re,{onClick:h,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:r.length>0?`Delete & Move ${r.length} Agent${r.length!==1?"s":""}`:"Delete Category"})]})]})})]})}function qe(){const _=M(),[N,l]=f.useState(!1),[i,b]=f.useState("name"),[o,p]=f.useState("asc"),{data:r,isLoading:A}=q({queryKey:["portal-agents"],queryFn:async()=>v("get_ai_agents")}),y=f.useMemo(()=>r?[...r].sort((t,h)=>{let n=t[i],s=h[i];if(n===null&&(n=""),s===null&&(s=""),typeof n=="boolean"&&(n=n?1:0,s=s?1:0),typeof n=="string"){const x=n.localeCompare(s);return o==="asc"?x:-x}const a=n-s;return o==="asc"?a:-a}):[],[r,i,o]),m=t=>{i===t?p(h=>h==="asc"?"desc":"asc"):(b(t),p("asc"))},c=({field:t})=>i!==t?e.jsx(ce,{className:"h-4 w-4 ml-1 opacity-50"}):o==="asc"?e.jsx(de,{className:"h-4 w-4 ml-1"}):e.jsx(me,{className:"h-4 w-4 ml-1"}),C=F({mutationFn:async t=>{await v("delete_ai_agent",{id:t})},onSuccess:()=>{_.invalidateQueries({queryKey:["portal-agents"]}),u.success("AI Agent deleted successfully")},onError:t=>{u.error("Failed to delete AI Agent: "+t.message)}}),k=t=>{I.visit(`/admin/ai-agents/${t.id}`)},S=()=>{I.visit("/admin/ai-agents/new")};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"AI Agents"}),e.jsxs(g,{onClick:S,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Add AI Agent"]})]}),e.jsx("div",{className:"flex items-center justify-between p-3 rounded-lg bg-lime-500/10 border border-lime-500/20",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-lime-500 animate-pulse"}),e.jsx("span",{className:"text-sm text-lime-400 font-medium",children:"Live sync enabled:"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{asChild:!0,variant:"ghost",size:"sm",className:"h-7 px-2 text-muted-foreground hover:text-foreground",children:e.jsxs(T,{href:"/marketplace",target:"_blank",children:[e.jsx(oe,{className:"h-4 w-4 mr-1.5"}),"Marketplace"]})}),e.jsx(g,{asChild:!0,variant:"ghost",size:"sm",className:"h-7 px-2 text-muted-foreground hover:text-foreground",children:e.jsxs(T,{href:"/portal/browse",target:"_blank",children:[e.jsx(L,{className:"h-4 w-4 mr-1.5"}),"Client"]})}),e.jsx(g,{asChild:!0,variant:"ghost",size:"sm",className:"h-7 px-2 text-muted-foreground hover:text-foreground",children:e.jsxs(T,{href:"/partner/marketplace",target:"_blank",children:[e.jsx(E,{className:"h-4 w-4 mr-1.5"}),"Partner"]})})]})]})}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(H,{children:[e.jsx($,{children:e.jsxs(w,{children:[e.jsx(j,{children:e.jsxs("button",{className:"flex items-center hover:text-foreground transition-colors",onClick:()=>m("job_title"),children:["Job Title",e.jsx(c,{field:"job_title"})]})}),e.jsx(j,{children:e.jsxs("button",{className:"flex items-center hover:text-foreground transition-colors",onClick:()=>m("name"),children:["Name",e.jsx(c,{field:"name"})]})}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("button",{className:"flex items-center hover:text-foreground transition-colors",onClick:()=>m("category"),children:["Category",e.jsx(c,{field:"category"})]}),e.jsx("button",{className:"p-1 rounded hover:bg-muted/50 text-muted-foreground hover:text-foreground transition-colors",onClick:()=>l(!0),title:"Manage Categories",children:e.jsx(z,{className:"h-3.5 w-3.5"})})]})}),e.jsx(j,{children:e.jsxs("button",{className:"flex items-center hover:text-foreground transition-colors",onClick:()=>m("price"),children:["Price",e.jsx(c,{field:"price"})]})}),e.jsx(j,{children:e.jsxs("button",{className:"flex items-center hover:text-foreground transition-colors",onClick:()=>m("is_popular"),children:["Popular",e.jsx(c,{field:"is_popular"})]})}),e.jsx(j,{children:e.jsxs("button",{className:"flex items-center hover:text-foreground transition-colors",onClick:()=>m("is_active"),children:["Active",e.jsx(c,{field:"is_active"})]})}),e.jsx(j,{className:"text-right",children:"Actions"})]})}),e.jsx(B,{children:A?e.jsx(w,{children:e.jsx(d,{colSpan:7,className:"text-center",children:"Loading..."})}):y.length===0?e.jsx(w,{children:e.jsx(d,{colSpan:7,className:"text-center text-muted-foreground",children:'No AI Agents yet. Click "Add AI Agent" to create one.'})}):y.map(t=>e.jsxs(w,{className:"hover:bg-muted/50",children:[e.jsx(d,{className:"font-medium",children:e.jsx("button",{className:"text-lime-400 hover:text-lime-300 hover:underline cursor-pointer",onClick:()=>k(t),children:t.job_title||"—"})}),e.jsx(d,{className:"text-muted-foreground",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:t.name}),t.is_popular&&e.jsx(D,{variant:"secondary",className:"text-xs",children:"Popular"})]})}),e.jsx(d,{children:t.category}),e.jsxs(d,{children:["$",t.price,"/mo"]}),e.jsx(d,{children:t.is_popular?"Yes":"—"}),e.jsx(d,{children:e.jsx(D,{variant:t.is_active?"default":"secondary",children:t.is_active?"Active":"Inactive"})}),e.jsx(d,{className:"text-right",children:e.jsx(g,{variant:"ghost",size:"icon",onClick:h=>{h.stopPropagation(),confirm("Are you sure you want to delete this AI Agent?")&&C.mutate(t.id)},children:e.jsx(Q,{className:"h-4 w-4"})})})]},t.id))})]})}),e.jsx(xe,{open:N,onOpenChange:l})]})}export{qe as default};
