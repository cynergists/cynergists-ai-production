import{bd as me,w as xe,v as ue,r,u as P,j as e,E as pe,m as q,a,b as W,i as he,B as i,W as ge,Y as fe,C as U,T as be,a9 as je,U as Y,h as A,f}from"./app-yl1YHj2k.js";import{u as J}from"./useMutation-Dt0Tk2fE.js";import{S as ye}from"./scroll-area-LKcc-MsV.js";import{T as X}from"./textarea-CY5CbXPo.js";import{C as ve}from"./card-Dxx2nlaR.js";import{I as Z}from"./input-B3tD5KH9.js";import{L as F}from"./label-C79MsPnt.js";import{D as Ne,a as we,c as Se,d as Ce,e as ke}from"./dialog-B01Lxjmp.js";import{S as _e,a as Me,b as qe,c as Ae,d as b}from"./select-bZyWIIk8.js";import{S as Le}from"./sparkles-DD5bapHP.js";import{C as I}from"./circle-check-CXfnWLUV.js";import{T as ee}from"./target-BCTYrAYs.js";import{S as De}from"./send-C-r9GjtI.js";import{M as Ee}from"./mic-CdrHDD75.js";import{M as R}from"./message-square-CXNrGOna.js";import{A as Te}from"./activity-s15cNsjq.js";import{H as se}from"./headphones-DDUe3idQ.js";/* empty css            */import"./index-KgiDK8vA.js";import"./index-BdQq_4o_.js";import"./index-ClWG0nRm.js";import"./index-DC5Tape7.js";import"./Combination-BU6xJxfT.js";import"./index-B4oGC8tk.js";import"./check-3ows1Yys.js";import"./chevron-up-CP4UIDax.js";const B=5;function os(){const{user:O}=me(),te=xe(),{props:L}=ue(),[t,Q]=r.useState(L.agentId??null),[x,D]=r.useState(1),[u,o]=r.useState([]),[j,$]=r.useState(""),[c,E]=r.useState(!1),y=r.useRef(null),[d,m]=r.useState("chat"),[re,v]=r.useState(!1),[z,K]=r.useState("general"),[N,G]=r.useState(""),[w,V]=r.useState(""),[p,ae]=r.useState("");r.useEffect(()=>{Q(L.agentId??null)},[L.agentId]);const{data:S,isLoading:ne}=P({queryKey:["portal-agents",O?.id],queryFn:async()=>(await f.get("/api/portal/agents")).agents,enabled:!!O?.id,refetchOnMount:!0,refetchOnWindowFocus:!0,staleTime:0}),C=r.useMemo(()=>{if(!S)return[];if(!p.trim())return S;const s=p.toLowerCase();return S.filter(l=>l.agent_name.toLowerCase().includes(s)||l.agent_type.toLowerCase().includes(s))},[S,p]),k=Math.ceil(C.length/B),le=r.useMemo(()=>{const s=(x-1)*B;return C.slice(s,s+B)},[C,x]);r.useEffect(()=>{D(1)},[p]);const{data:n,isLoading:Pe}=P({queryKey:["agent-details",t],queryFn:async()=>t?(await f.get(`/api/portal/agents/${t}`)).agent:null,enabled:!!t}),{data:h}=P({queryKey:["agent-conversation",t],queryFn:async()=>t?(await f.get(`/api/portal/agents/${t}/conversation`)).conversation:null,enabled:!!t});r.useEffect(()=>{if(!h?.messages){o([]);return}try{const s=typeof h.messages=="string"?JSON.parse(h.messages):h.messages;o(s)}catch(s){console.error("Error parsing messages:",s),o([])}},[h]),r.useEffect(()=>{y.current&&(y.current.scrollTop=y.current.scrollHeight)},[u,c]);const ie=J({mutationFn:async s=>{if(!t)throw new Error("Select an agent to chat");const l=[...u,{role:"user",content:s}];return o(l),E(!0),f.post(`/api/portal/agents/${t}/message`,{message:s})},onSuccess:s=>{E(!1),o(s.messages),te.invalidateQueries({queryKey:["agent-details",t]})},onError:s=>{E(!1),A.error(s.message),o(l=>l.slice(0,-1))}}),H=s=>{s.preventDefault(),!(!j.trim()||c)&&(ie.mutate(j.trim()),$(""))},oe=()=>{window.confirm("Are you sure you want to clear this chat?")&&(o([]),A.success("Chat cleared"))},_=J({mutationFn:async()=>{if(!N.trim()||!w.trim())throw new Error("Please fill in all required fields");return f.post("/api/portal/support",{category:z,subject:N,message:w})},onSuccess:s=>{A.success(s.message||"Support request submitted successfully"),v(!1),K("general"),G(""),V("")},onError:s=>{A.error(s.message||"Failed to submit support request")}}),ce=s=>{s.preventDefault(),_.mutate()},g={completed:1,total:3,steps:[{id:"linkedin",label:"Connect LinkedIn",completed:!0},{id:"booking",label:"Add Booking Link",completed:!1},{id:"campaign",label:"Create Campaign",completed:!1}]},M={connectionsRequested:0,connectionsMade:0,messagesSent:0,meetingsScheduled:0};return e.jsxs("div",{className:"flex flex-col min-h-0 bg-background",children:[e.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row min-h-0 p-3 lg:p-6 gap-4 lg:gap-6 overflow-hidden",children:[e.jsxs("div",{className:"hidden lg:flex w-80 shrink-0 flex-col min-h-0",children:[e.jsxs("div",{className:"bg-card border border-primary/20 rounded-2xl p-4 flex-1 flex flex-col overflow-hidden",children:[e.jsx("h2",{className:"text-base font-semibold text-foreground mb-1",children:"Your AI Agents"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:"Select an agent to interact with"}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(Z,{type:"text",placeholder:"Search agents...",value:p,onChange:s=>ae(s.target.value),className:"pl-9 h-9 text-sm bg-background border-primary/15 focus:border-primary/40"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:ne?e.jsxs("div",{className:"flex items-center justify-center py-6 text-muted-foreground",children:[e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),"Loading agents..."]}):C.length===0?e.jsx("div",{className:"px-4 py-6 text-sm text-muted-foreground",children:"No agents found."}):e.jsx("div",{className:"space-y-2",children:le.map((s,l)=>{const de=l===0,T=t===s.id;return e.jsxs("button",{type:"button",onClick:()=>{Q(s.id),he.visit(`/portal/agents/${s.id}/chat`,{preserveState:!0,preserveScroll:!0})},className:a("flex w-full items-center gap-3 rounded-xl p-3 text-left transition-all",T&&"bg-primary/10 border-2 border-primary/40 shadow-[0_0_20px_rgba(136,203,21,0.15)]",!T&&"border-2 border-transparent hover:bg-accent"),children:[e.jsx("div",{className:a("w-12 h-12 rounded-lg overflow-hidden shrink-0",T&&"ring-2 ring-accent-purple/50 shadow-[0_0_12px_rgba(139,92,246,0.3)]"),children:s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:s.agent_name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-primary/10",children:e.jsx(W,{className:"h-6 w-6 text-primary"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-foreground text-sm",children:s.agent_name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.agent_type}),de&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(Le,{className:"w-3 h-3 text-accent-purple"}),e.jsx("span",{className:"text-xs text-accent-purple font-medium",children:"Featured"})]})]})]},s.id)})})})]}),k>1&&e.jsxs("div",{className:"flex items-center justify-between border-t border-border px-4 py-2",children:[e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>D(s=>Math.max(1,s-1)),disabled:x===1,className:"h-8 px-2",children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[x," / ",k]}),e.jsx(i,{variant:"ghost",size:"sm",onClick:()=>D(s=>Math.min(k,s+1)),disabled:x===k,className:"h-8 px-2",children:e.jsx(fe,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex min-w-0 flex-1 flex-col rounded-2xl border border-primary/20 bg-card overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-primary/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:a("w-9 h-9 rounded-lg overflow-hidden shrink-0",t&&"ring-2 ring-accent-purple/50 shadow-[0_0_12px_rgba(139,92,246,0.3)]"),children:n?.avatar_url?e.jsx("img",{src:n.avatar_url,alt:n.agent_name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-primary/10",children:e.jsx(W,{className:"h-5 w-5 text-primary"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground text-sm",children:n?.agent_name??"Select an agent"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n?.agent_type??"Ready when you are"})]})]}),t&&n?.is_active&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium bg-success/10 text-success border border-success/30",children:[e.jsx(I,{className:"w-3 h-3"}),"Connected"]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[t&&e.jsxs("div",{className:"space-y-1.5 mx-4 mt-3 mb-2 p-3 bg-muted/30 border border-primary/10 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Setup Progress"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[g.completed,"/",g.total]})]}),e.jsx("div",{className:"h-1.5 w-full rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${g.completed/g.total*100}%`}})}),e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:g.steps.map(s=>e.jsxs("div",{className:a("flex items-center gap-1 text-xs py-0.5 px-1.5 rounded-md",s.completed?"bg-green-500/10 text-green-600 dark:text-green-400":"bg-muted/50 text-muted-foreground"),children:[s.completed?e.jsx(I,{className:"h-3 w-3 text-green-500"}):s.id==="booking"?e.jsx(U,{className:"h-3 w-3 text-muted-foreground"}):e.jsx(ee,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"truncate text-[11px]",children:s.label})]},s.id))})]}),e.jsx(ye,{className:"flex-1 px-4 py-3",ref:y,children:t?e.jsxs("div",{className:"space-y-3",children:[u.length===0?e.jsxs("div",{className:"py-8 text-center text-sm text-muted-foreground",children:["Start the conversation with ",n?.agent_name??"your agent","."]}):u.map((s,l)=>e.jsxs("div",{className:a("flex gap-3",s.role==="user"?"justify-end":"justify-start"),children:[s.role==="assistant"&&n?.avatar_url&&e.jsx("div",{className:"w-7 h-7 rounded-full overflow-hidden shrink-0 ring-2 ring-accent-purple/40",children:e.jsx("img",{src:n.avatar_url,alt:n.agent_name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex flex-col gap-0.5",children:[e.jsx(ve,{className:a("max-w-[380px] rounded-xl px-3 py-2 text-foreground",s.role==="user"?"bg-primary text-primary-foreground rounded-br-sm":"bg-surface-2 border border-primary/10 rounded-bl-sm"),children:e.jsx("p",{className:"whitespace-pre-wrap leading-relaxed text-sm",children:s.content})}),e.jsx("span",{className:"text-[10px] text-muted-foreground/60 px-1 text-left",children:new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})]})]},`${s.role}-${l}`)),c&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(q,{className:"h-4 w-4 animate-spin"}),"Thinking..."]})]}):e.jsx("div",{className:"py-12 text-center text-sm text-muted-foreground",children:"Pick an agent on the left to begin."})})]}),e.jsxs("div",{className:"px-4 pt-3 pb-3 bg-card rounded-xl",children:[e.jsx("form",{onSubmit:H,children:e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx(X,{value:j,onChange:s=>$(s.target.value),placeholder:t?"Type your message...":"Select an agent to chat",disabled:!t||c,className:"flex-1 min-h-[40px] max-h-[100px] bg-background border-primary/15 text-sm px-3 py-2 rounded-lg focus:border-primary/40 focus:ring-primary/20 resize-none",rows:1,onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),H(s))}}),e.jsx(i,{type:"submit",disabled:!t||!j.trim()||c,className:"h-10 w-10 rounded-lg shrink-0 bg-primary hover:bg-primary-hover shadow-glow-primary",children:c?e.jsx(q,{className:"w-4 h-4 animate-spin"}):e.jsx(De,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2",children:[e.jsxs(i,{variant:"outline",size:"sm",className:"h-7 px-3 text-xs gap-1.5 rounded-button border-border-strong hover:bg-primary/10 hover:border-primary/40",disabled:!t,children:[e.jsx(Ee,{className:"w-3 h-3"}),"Voice Mode"]}),e.jsxs(i,{variant:"outline",size:"sm",className:"h-7 px-3 text-xs gap-1.5 rounded-button border-border-strong hover:bg-primary/10 hover:border-primary/40",onClick:oe,disabled:!t||u.length===0,children:[e.jsx(be,{className:"w-3 h-3"}),"Clear Chat"]})]})]})]}),e.jsxs("div",{className:"hidden lg:flex w-[300px] shrink-0 flex-col gap-6 min-h-0 transition-all duration-300",children:[e.jsxs("div",{className:"bg-card border border-primary/20 rounded-2xl p-5 flex flex-col",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-4 shrink-0",children:"Quick Links"}),e.jsxs("nav",{className:"flex flex-col space-y-2",children:[e.jsxs("button",{onClick:()=>m("chat"),className:a("flex items-center gap-3 text-left text-base font-medium py-3 px-4 rounded-xl transition-all duration-200 border-l-3",d==="chat"?"text-primary border-l-primary bg-primary/10":"text-foreground/70 hover:text-foreground hover:bg-muted/50 border-l-transparent"),children:[e.jsx(R,{className:"w-5 h-5 shrink-0"}),"Chat"]}),e.jsxs("button",{onClick:()=>m("dashboard"),className:a("flex items-center gap-3 text-left text-base font-medium py-3 px-4 rounded-xl transition-all duration-200 border-l-3",d==="dashboard"?"text-primary border-l-primary bg-primary/10":"text-foreground/70 hover:text-foreground hover:bg-muted/50 border-l-transparent"),children:[e.jsx(je,{className:"w-5 h-5 shrink-0"}),"Dashboard"]}),e.jsxs("button",{onClick:()=>m("campaigns"),className:a("flex items-center gap-3 text-left text-base font-medium py-3 px-4 rounded-xl transition-all duration-200 border-l-3",d==="campaigns"?"text-primary border-l-primary bg-primary/10":"text-foreground/70 hover:text-foreground hover:bg-muted/50 border-l-transparent"),children:[e.jsx(ee,{className:"w-5 h-5 shrink-0"}),"Campaigns"]}),e.jsxs("button",{onClick:()=>m("connections"),className:a("flex items-center gap-3 text-left text-base font-medium py-3 px-4 rounded-xl transition-all duration-200 border-l-3",d==="connections"?"text-primary border-l-primary bg-primary/10":"text-foreground/70 hover:text-foreground hover:bg-muted/50 border-l-transparent"),children:[e.jsx(Y,{className:"w-5 h-5 shrink-0"}),"Connections"]}),e.jsxs("button",{onClick:()=>m("messages"),className:a("flex items-center gap-3 text-left text-base font-medium py-3 px-4 rounded-xl transition-all duration-200 border-l-3",d==="messages"?"text-primary border-l-primary bg-primary/10":"text-foreground/70 hover:text-foreground hover:bg-muted/50 border-l-transparent"),children:[e.jsx(R,{className:"w-5 h-5 shrink-0"}),"Messages"]}),e.jsxs("button",{onClick:()=>m("activity"),className:a("flex items-center gap-3 text-left text-base font-medium py-3 px-4 rounded-xl transition-all duration-200 border-l-3",d==="activity"?"text-primary border-l-primary bg-primary/10":"text-foreground/70 hover:text-foreground hover:bg-muted/50 border-l-transparent"),children:[e.jsx(Te,{className:"w-5 h-5 shrink-0"}),"Activity Log"]})]})]}),e.jsxs("div",{className:"bg-card border border-primary/20 rounded-2xl p-5 flex-1 flex flex-col overflow-hidden min-h-0",children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-4 shrink-0",children:"Today's Activity"}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(Y,{className:"w-4 h-4 text-primary"})}),e.jsx("span",{className:"text-sm text-foreground",children:"Connections Requested"})]}),e.jsx("span",{className:"text-lg font-semibold text-foreground",children:M.connectionsRequested})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(I,{className:"w-4 h-4 text-primary"})}),e.jsx("span",{className:"text-sm text-foreground",children:"Connections Made"})]}),e.jsx("span",{className:"text-lg font-semibold text-foreground",children:M.connectionsMade})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(R,{className:"w-4 h-4 text-primary"})}),e.jsx("span",{className:"text-sm text-foreground",children:"Messages Sent"})]}),e.jsx("span",{className:"text-lg font-semibold text-foreground",children:M.messagesSent})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(U,{className:"w-4 h-4 text-primary"})}),e.jsx("span",{className:"text-sm text-foreground",children:"Meetings Scheduled"})]}),e.jsx("span",{className:"text-lg font-semibold text-foreground",children:M.meetingsScheduled})]})]})}),e.jsx("div",{className:"pt-4 border-t border-primary/20 shrink-0",children:e.jsxs(i,{variant:"outline",className:"w-full justify-start gap-2 text-sm",onClick:()=>v(!0),children:[e.jsx(se,{className:"w-4 h-4"}),"Get Support"]})})]})]})]}),e.jsx(Ne,{open:re,onOpenChange:v,children:e.jsxs(we,{className:"sm:max-w-[500px]",children:[e.jsxs(Se,{children:[e.jsxs(Ce,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-primary"}),"Get Support"]}),e.jsx(ke,{children:"Need help? We're here for you. Describe your issue below."})]}),e.jsxs("form",{onSubmit:ce,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"support-category",children:"Category"}),e.jsxs(_e,{value:z,onValueChange:K,children:[e.jsx(Me,{id:"support-category",children:e.jsx(qe,{})}),e.jsxs(Ae,{children:[e.jsx(b,{value:"general",children:"General Question"}),e.jsx(b,{value:"technical",children:"Technical Issue"}),e.jsx(b,{value:"billing",children:"Billing & Account"}),e.jsx(b,{value:"feature_request",children:"Feature Request"}),e.jsx(b,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"support-subject",children:["Subject ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(Z,{id:"support-subject",placeholder:"Brief summary of your request...",maxLength:200,value:N,onChange:s=>G(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(F,{htmlFor:"support-message",children:["Message ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(X,{id:"support-message",placeholder:"Tell us how we can help...",rows:6,className:"resize-none",value:w,onChange:s=>V(s.target.value),required:!0})]}),e.jsxs("div",{className:"flex gap-3 justify-end pt-2",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>v(!1),disabled:_.isPending,children:"Cancel"}),e.jsx(i,{type:"submit",disabled:_.isPending||!N.trim()||!w.trim(),children:_.isPending?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):"Send Request"})]})]})]})})]})}export{os as default};
