import{be as W,au as Y,w as Z,r as a,d as P,j as e,n as u,b as I,e as J,l as U,B as v,Y as V,Z as X,k as M,h as m}from"./app-Ce4dIZFB.js";import{u as O}from"./useMutation-Ck5dgKK9.js";import{S as ee}from"./scroll-area-DmGKFs8l.js";import{I as R}from"./input-Ck65_zG1.js";import{T as se}from"./textarea-C7BHIkU1.js";import{C as te}from"./card-adEYQJfr.js";import{S as ae}from"./send-B-7zc727.js";import{S as re}from"./settings-2-xrcQjJZS.js";/* empty css            */import"./index-B1d3PRdL.js";import"./index-BdQq_4o_.js";const $=5;function pe(){const{user:k}=W(),q=Y(),{props:b}=Z(),[t,L]=a.useState(b.agentId??null),[x,T]=a.useState(""),[i,y]=a.useState(1),[g,o]=a.useState([]),[f,A]=a.useState(""),[l,S]=a.useState(!1),[w,p]=a.useState(""),[K,C]=a.useState(""),[B,c]=a.useState(null),h=a.useRef(null);a.useEffect(()=>{L(b.agentId??null)},[b.agentId]);const{data:E,isLoading:F}=P({queryKey:["portal-agents",k?.id],queryFn:async()=>(await m.get("/api/portal/agents")).agents,enabled:!!k?.id}),j=a.useMemo(()=>{const s=x.trim().toLowerCase();return s?(E??[]).filter(r=>`${r.agent_name} ${r.agent_type}`.toLowerCase().includes(s)):E??[]},[E,x]),N=Math.ceil(j.length/$),z=a.useMemo(()=>{const s=(i-1)*$;return j.slice(s,s+$)},[j,i]);a.useEffect(()=>{y(1)},[x]);const{data:n,isLoading:Q}=P({queryKey:["agent-details",t],queryFn:async()=>t?(await m.get(`/api/portal/agents/${t}`)).agent:null,enabled:!!t}),{data:d}=P({queryKey:["agent-conversation",t],queryFn:async()=>t?(await m.get(`/api/portal/agents/${t}/conversation`)).conversation:null,enabled:!!t});a.useEffect(()=>{if(!d?.messages){o([]);return}try{const s=typeof d.messages=="string"?JSON.parse(d.messages):d.messages;o(s)}catch(s){console.error("Error parsing messages:",s),o([])}},[d]),a.useEffect(()=>{if(!n){p(""),C(""),c(null);return}const s=JSON.stringify(n.configuration??{},null,2);p(s),C(s),c(null)},[n]),a.useEffect(()=>{h.current&&(h.current.scrollTop=h.current.scrollHeight)},[g,l]);const D=O({mutationFn:async s=>{if(!t)throw new Error("Select an agent to chat");const r=[...g,{role:"user",content:s}];return o(r),S(!0),m.post(`/api/portal/agents/${t}/message`,{message:s})},onSuccess:s=>{S(!1),o(s.messages),q.invalidateQueries({queryKey:["agent-details",t]})},onError:s=>{S(!1),M.error(s.message),o(r=>r.slice(0,-1))}}),_=O({mutationFn:async()=>{if(!t)throw new Error("Select an agent to update configuration");let s;try{s=JSON.parse(w||"{}")}catch{throw new Error("Configuration must be valid JSON.")}return m.put(`/api/portal/agents/${t}/configuration`,{configuration:s})},onSuccess:s=>{const r=JSON.stringify(s.agent.configuration??{},null,2);p(r),C(r),c(null),M.success("Configuration saved."),q.invalidateQueries({queryKey:["agent-details",t]})},onError:s=>{c(s.message),M.error(s.message)}}),G=s=>{s.preventDefault(),!(!f.trim()||l)&&(D.mutate(f.trim()),A(""))},H=w!==K;return e.jsx("div",{className:"flex h-full flex-col",children:e.jsxs("div",{className:"flex h-full gap-4 p-6",children:[e.jsxs("div",{className:"flex w-[280px] flex-col gap-4 rounded-xl border border-border bg-card",children:[e.jsxs("div",{className:"border-b border-border p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Agents"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Select an agent to chat."}),e.jsx(R,{value:x,onChange:s=>T(s.target.value),placeholder:"Search agents",className:"mt-3"})]}),e.jsx("div",{className:"min-h-[340px] flex-1 overflow-hidden px-2",children:F?e.jsxs("div",{className:"flex items-center justify-center py-6 text-muted-foreground",children:[e.jsx(u,{className:"mr-2 h-4 w-4 animate-spin"}),"Loading agents..."]}):j.length===0?e.jsx("div",{className:"px-4 py-6 text-sm text-muted-foreground",children:"No agents found."}):e.jsx("div",{className:"space-y-2 px-2",children:z.map(s=>e.jsxs("button",{type:"button",onClick:()=>{L(s.id),U.visit(`/portal/agents/${s.id}/chat`,{preserveState:!0,preserveScroll:!0})},className:I("flex w-full items-center gap-3 rounded-lg border border-transparent px-3 py-2 text-left transition-colors",t===s.id?"border-primary/40 bg-primary/10":"hover:bg-accent"),children:[s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:s.agent_name,className:"h-11 w-11 rounded-full object-cover"}):e.jsx("div",{className:"flex h-11 w-11 items-center justify-center rounded-full bg-primary/10",children:e.jsx(J,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex min-w-0 flex-1 flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-foreground truncate",children:s.agent_name}),e.jsx("span",{className:"text-xs text-muted-foreground capitalize truncate",children:s.agent_type})]})]},s.id))})}),N>1&&e.jsxs("div",{className:"flex items-center justify-between border-t border-border px-4 py-2",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>y(s=>Math.max(1,s-1)),disabled:i===1,className:"h-8 px-2",children:e.jsx(V,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[i," / ",N]}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>y(s=>Math.min(N,s+1)),disabled:i===N,className:"h-8 px-2",children:e.jsx(X,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex min-w-0 flex-1 flex-col rounded-xl border border-border bg-card",children:[e.jsxs("div",{className:"flex items-center gap-3 border-b border-border px-4 py-3",children:[n?.avatar_url?e.jsx("img",{src:n.avatar_url,alt:n.agent_name,className:"h-12 w-12 rounded-full object-cover"}):e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-primary/10",children:e.jsx(J,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:n?.agent_name??"Select an agent"}),e.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:n?.agent_type??"Ready when you are"})]}),(Q||F)&&e.jsx(u,{className:"ml-auto h-4 w-4 animate-spin text-muted-foreground"})]}),e.jsx(ee,{className:"flex-1 px-6 py-4",ref:h,children:t?e.jsxs("div",{className:"space-y-4",children:[g.length===0?e.jsxs("div",{className:"py-12 text-center text-sm text-muted-foreground",children:["Start the conversation with ",n?.agent_name??"your agent","."]}):g.map((s,r)=>e.jsx("div",{className:I("flex gap-3",s.role==="user"?"justify-end":"justify-start"),children:e.jsx(te,{className:I("max-w-[75%] px-4 py-3 text-sm",s.role==="user"?"bg-primary text-primary-foreground":"bg-muted"),children:e.jsx("p",{className:"whitespace-pre-wrap",children:s.content})})},`${s.role}-${r}`)),l&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(u,{className:"h-4 w-4 animate-spin"}),"Thinking..."]})]}):e.jsx("div",{className:"py-16 text-center text-sm text-muted-foreground",children:"Pick an agent on the left to begin."})}),e.jsx("div",{className:"border-t border-border p-4",children:e.jsxs("form",{onSubmit:G,className:"flex gap-2",children:[e.jsx(R,{value:f,onChange:s=>A(s.target.value),placeholder:t?`Message ${n?.agent_name??"agent"}`:"Select an agent to chat",disabled:!t||l}),e.jsx(v,{type:"submit",disabled:!t||!f.trim()||l,children:l?e.jsx(u,{className:"h-4 w-4 animate-spin"}):e.jsx(ae,{className:"h-4 w-4"})})]})})]}),e.jsxs("div",{className:"flex w-[320px] flex-col gap-4 rounded-xl border border-border bg-card",children:[e.jsxs("div",{className:"border-b border-border p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Configuration"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Edit configuration JSON for the selected agent."})]}),e.jsx("div",{className:"flex-1 px-4 pb-4",children:t?e.jsxs("div",{className:"flex h-full flex-col gap-3",children:[e.jsx(se,{value:w,onChange:s=>{p(s.target.value),c(null)},className:"min-h-[320px] flex-1 font-mono text-xs",placeholder:`{
  "key": "value"
}`}),B&&e.jsx("p",{className:"text-xs text-destructive",children:B}),e.jsx(v,{onClick:()=>_.mutate(),disabled:!H||_.isPending,children:_.isPending?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Save Configuration"})]}):e.jsx("div",{className:"flex h-full items-center justify-center text-sm text-muted-foreground",children:"Select an agent to edit settings."})})]})]})})}export{pe as default};
