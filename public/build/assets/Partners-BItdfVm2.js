import{r as n,h as I,aF as E,j as e,aW as T,m as Q,e as ke,s as oe,F as Pe,R as ue,U as re,aA as Fe,B as v,T as Ae,g as Le,H as De,E as We,L as Oe,X as Te}from"./app-DpPlT-lI.js";import{I as O}from"./input-Zg97uL99.js";import{L as f}from"./label-CelXGX25.js";import{f as ce}from"./errorMessages-9RXyVjba.js";import{c as Z}from"./admin-api-CK9-sm5K.js";import{u as Ee,S as Re,a as Me}from"./SaveViewDialog-LxN5kbsS.js";import{C as de}from"./CenteredDash-BUOnjN3r.js";import{A as Ve,a as Ie}from"./arrow-up-DbhnmvA-.js";import{A as Ue}from"./arrow-down-B-WP3E6l.js";import{S as $e,a as ze,b as Be,c as Ge}from"./sheet-NDFqQkNK.js";import{T as Xe}from"./textarea-7o-aEwSM.js";import{S as U}from"./separator-DgFlhSyn.js";import{S as te}from"./switch-C_ndJk94.js";import{S as $,a as z,b as B,c as G,d as j}from"./select-NshM9K8S.js";import{u as qe}from"./useAutoSave-BYc7VSmY.js";import{U as He}from"./user-5a-lcCgG.js";import{U as xe}from"./user-plus-CD5tooGh.js";import{B as Je}from"./building-2-xAQ0pgzg.js";import{C as Qe}from"./check-BQSF1lV1.js";import{C as Ye}from"./copy-DplA_YA7.js";import{C as Ze,a as Ke}from"./card-CenXMO1c.js";import{U as es}from"./user-check-C4wcGIHP.js";import{P as ss}from"./percent-Bqp6vGTT.js";import{P as ts,a as as,b as rs}from"./popover-CGkBZ3d-.js";import{P as ns,a as ls,b as ae,c as is,d as os,e as cs}from"./pagination-DJgFKBhq.js";import{F as ds}from"./filter-DZMsi8QQ.js";import{E as ms}from"./external-link-Cl3P0Rml.js";/* empty css            */import"./index-CntF1Am5.js";import"./dialog-GbyeoWks.js";import"./index-CGp-8Qb2.js";import"./Combination-pOScT-mV.js";import"./checkbox-CQjUFhCO.js";import"./index-CnUV8fJE.js";import"./index-79SeQRXZ.js";import"./index-0xL_2Sqz.js";import"./index-BdQq_4o_.js";import"./index-DfuviWGr.js";import"./chevron-up-DLr7usxE.js";const me={total:0,active:0,inactive:0,totalReferrals:0,totalRevenue:0,totalCommissions:0,outstandingBalance:0};function us(){const[s,o]=n.useState([]),[h,F]=n.useState(!0),[A,L]=n.useState(null),[D,x]=n.useState(!1),[V,p]=n.useState(me),d=n.useCallback(async()=>{F(!0),L(null);try{const a=await Z("get_partners");o(a.partners||[]),p(a.summary||me)}catch(a){console.error("Error in fetchPartners:",a),L(a instanceof Error?a.message:"Unknown error"),o([])}finally{F(!1)}},[]),N=n.useCallback(async a=>{x(!0);try{const _=await Z("create_partner",void 0,a);return I.success("Partner created successfully"),await d(),_}catch(_){const b=_ instanceof Error?_.message:"Failed to create partner",i=ce(b,"partner");return I.error(i),null}finally{x(!1)}},[d]),R=n.useCallback(async(a,_)=>{x(!0);try{const b=await Z("update_partner",{id:a},_);return I.success("Partner updated successfully"),await d(),b}catch(b){const i=b instanceof Error?b.message:"Failed to update partner",l=ce(i,"partner");return I.error(l),null}finally{x(!1)}},[d]),W=n.useCallback(async a=>{x(!0);try{return await Z("delete_partner",{id:a}),I.success("Partner deleted successfully"),await d(),!0}catch(_){const b=_ instanceof Error?_.message:"Failed to delete partner";return I.error(b),!1}finally{x(!1)}},[d]);return n.useEffect(()=>{d()},[d]),{partners:s,loading:h,error:A,summary:V,refetch:d,createPartner:N,updatePartner:R,deletePartner:W,mutating:D}}const xs=["name","email","company_name","phone","status","partnership_interest","referral_volume","created_at"];function hs(){return Ee({tableName:"partner_view_preferences",defaultColumnOrder:xs,defaultSortColumn:"created_at",defaultSortDirection:"desc"})}const J={name:{key:"name",label:"Partner Name",sortable:!0,minWidth:150,defaultWidth:200,render:s=>`${s.first_name} ${s.last_name}`.trim()||s.email},company_name:{key:"company_name",label:"Company",sortable:!0,minWidth:120,defaultWidth:160,render:s=>s.company_name||"Individual"},partner_status:{key:"partner_status",label:"Partner Status",sortable:!0,minWidth:100,defaultWidth:130,centered:!0,render:s=>{const o=s.partner_status||"active",h=A=>{switch(A){case"active":return"bg-green-100 text-green-800 border-green-300 dark:bg-green-900/30 dark:text-green-400 dark:border-green-800";case"inactive":return"bg-amber-100 text-amber-800 border-amber-300 dark:bg-amber-900/30 dark:text-amber-400 dark:border-amber-800";case"terminated":return"bg-red-100 text-red-800 border-red-300 dark:bg-red-900/30 dark:text-red-400 dark:border-red-800";default:return"bg-muted text-muted-foreground border-border"}},F={active:"Active",inactive:"Inactive",terminated:"Terminated"};return e.jsx(ke,{variant:"outline",className:h(o),children:F[o]||o})}},referrals_given:{key:"referrals_given",label:"Referrals Given",sortable:!0,minWidth:100,defaultWidth:130,centered:!0,render:s=>s.referrals_given||0},last_referral_date:{key:"last_referral_date",label:"Last Referral Date",sortable:!0,minWidth:120,defaultWidth:140,centered:!0,render:s=>s.last_referral_date?E(s.last_referral_date):"Never"},revenue_generated:{key:"revenue_generated",label:"Revenue Generated",sortable:!0,minWidth:120,defaultWidth:150,centered:!0,render:s=>T(s.revenue_generated||0)},total_commissions_earned:{key:"total_commissions_earned",label:"Total Commissions",sortable:!0,minWidth:120,defaultWidth:150,centered:!0,render:s=>T(s.total_commissions_earned||0)},outstanding_commission_balance:{key:"outstanding_commission_balance",label:"Outstanding Balance",sortable:!0,minWidth:130,defaultWidth:160,centered:!0,render:s=>{const o=s.outstanding_commission_balance||0;return o>0?e.jsx("span",{className:"text-amber-600 dark:text-amber-400 font-medium",children:T(o)}):T(0)}},internal_owner:{key:"internal_owner",label:"Internal Owner",sortable:!1,minWidth:140,defaultWidth:180,render:s=>s.internal_owner?[s.internal_owner.first_name,s.internal_owner.last_name].filter(Boolean).join(" ")||s.internal_owner.email:e.jsx(de,{})},next_follow_up_date:{key:"next_follow_up_date",label:"Next Follow-Up Date",sortable:!0,minWidth:120,defaultWidth:150,centered:!0,render:s=>s.next_follow_up_date?E(s.next_follow_up_date):e.jsx(de,{})}},_s=["name","company_name","partner_status","referrals_given","last_referral_date","revenue_generated","total_commissions_earned","outstanding_commission_balance","internal_owner","next_follow_up_date"];function fs({partners:s,loading:o,sortColumn:h,sortDirection:F,onSort:A,onPartnerClick:L}){const D=_s.filter(l=>J[l]),[x,V]=n.useState({}),[p,d]=n.useState(null),[N,R]=n.useState({}),W=n.useRef(0),a=n.useRef(0),_=l=>N[l]!==void 0?N[l]:x[l]||J[l]?.defaultWidth||150,b=n.useCallback((l,m)=>{l.preventDefault(),l.stopPropagation(),d(m),W.current=l.clientX,a.current=x[m]||J[m]?.defaultWidth||150;const w=y=>{const S=y.clientX-W.current,M=Math.max(20,a.current+S);R(t=>({...t,[m]:M}))},g=y=>{const S=y.clientX-W.current,M=Math.max(20,a.current+S);V(t=>({...t,[m]:M})),R(t=>{const C={...t};return delete C[m],C}),d(null),document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",g)};document.addEventListener("mousemove",w),document.addEventListener("mouseup",g)},[x]),i=({column:l})=>h!==l?e.jsx(Ve,{className:"h-4 w-4 ml-1 opacity-50 flex-shrink-0"}):F==="asc"?e.jsx(Ie,{className:"h-4 w-4 ml-1 flex-shrink-0"}):e.jsx(Ue,{className:"h-4 w-4 ml-1 flex-shrink-0"});return o&&s.length===0?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(Q,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):!o&&s.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:[e.jsx("p",{children:"No partners found"}),e.jsx("p",{className:"text-sm",children:"Add partners to start tracking referrals and commissions"})]}):e.jsxs("div",{className:"relative",children:[o&&e.jsx("div",{className:"absolute inset-0 bg-background/50 flex items-center justify-center z-20",children:e.jsx(Q,{className:"h-6 w-6 animate-spin text-primary"})}),e.jsxs("table",{style:{tableLayout:"fixed",width:"max-content",minWidth:"100%"},className:"w-full caption-bottom text-sm",children:[e.jsx("thead",{className:"[&_tr]:border-b",children:e.jsx("tr",{className:"border-b transition-colors bg-background",children:D.map((l,m)=>{const w=J[l],g=_(l),y=m===0;return e.jsxs("th",{className:`h-12 px-4 text-left align-middle font-medium text-muted-foreground bg-background relative group transition-all sticky top-0 ${y?"left-0 z-30 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]":"z-20"}`,style:{width:`${g}px`,minWidth:"20px"},children:[e.jsxs("div",{className:`flex items-center ${w.centered?"justify-center":""} ${w.sortable?"cursor-pointer select-none hover:text-foreground":""}`,onClick:()=>w.sortable&&A(l),children:[e.jsx("span",{style:{wordBreak:"keep-all",overflowWrap:"normal",whiteSpace:"nowrap"},children:w.label}),w.sortable&&e.jsx(i,{column:l})]}),e.jsx("div",{className:`absolute right-0 top-0 h-full w-1 cursor-col-resize hover:bg-primary/50 transition-colors ${p===l?"bg-primary":"bg-transparent group-hover:bg-border"}`,onMouseDown:S=>b(S,l)})]},l)})})}),e.jsx("tbody",{className:"[&_tr:last-child]:border-0",children:s.map(l=>e.jsx("tr",{className:"border-b transition-colors hover:bg-muted/50 align-top",children:D.map((m,w)=>{const g=J[m],y=m==="name",S=_(m),t=w===0?"sticky left-0 z-10 bg-background shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]":"";return e.jsx("td",{className:`p-4 align-middle ${g.centered?"text-center":""} ${y?"cursor-pointer hover:text-lime-300 font-medium text-lime-400":""} ${t}`,style:{width:`${S}px`,maxWidth:`${S}px`},onClick:y?()=>L(l):void 0,children:e.jsx("div",{className:"truncate",children:g.render?g.render(l):String(l[m]??"â€”")})},m)})},l.id))})]})]})}function gs({partner:s,open:o,onClose:h,onSave:F,onUpdate:A,onDelete:L,saving:D=!1}){const x=!!s,[V,p]=n.useState([]),[d,N]=n.useState(!1),[R,W]=n.useState(null),[a,_]=n.useState({first_name:"",last_name:"",email:"",phone:"",company_name:"",partner_type:"sole_proprietor",partner_status:"active",commission_rate:20,agreement_sent:!1,agreement_signed:!1,internal_owner_id:void 0,partner_start_date:void 0,next_follow_up_date:void 0,partner_notes:"",portal_access_enabled:!1,access_level:"standard"});n.useEffect(()=>{o&&b()},[o]),n.useEffect(()=>{_(s?{first_name:s.first_name||"",last_name:s.last_name||"",email:s.email||"",phone:s.phone||"",company_name:s.company_name||"",partner_type:s.partner_type||"sole_proprietor",partner_status:s.partner_status||"active",commission_rate:s.commission_rate||20,agreement_sent:s.agreement_sent||!1,agreement_sent_date:s.agreement_sent_date||void 0,agreement_signed:s.agreement_signed||!1,agreement_signed_date:s.agreement_signed_date||void 0,agreement_version:s.agreement_version||void 0,internal_owner_id:s.internal_owner_id||void 0,partner_start_date:s.partner_start_date||void 0,next_follow_up_date:s.next_follow_up_date||void 0,partner_notes:s.partner_notes||"",portal_access_enabled:s.portal_access_enabled||!1,access_level:s.access_level||"standard"}:{first_name:"",last_name:"",email:"",phone:"",company_name:"",partner_type:"sole_proprietor",partner_status:"active",commission_rate:20,agreement_sent:!1,agreement_signed:!1,internal_owner_id:void 0,partner_notes:"",portal_access_enabled:!1,access_level:"standard"})},[s,o]);const b=async()=>{N(!0);try{const{data:{session:t}}=await oe.auth.getSession();if(!t)return;const C=await oe.functions.invoke("admin-data?action=get_internal_owners",{body:{}});C.data&&p(C.data)}catch(t){console.error("Error fetching internal owners:",t)}finally{N(!1)}},i=(t,C)=>{_(K=>({...K,[t]:C}))},l=n.useMemo(()=>s?{first_name:s.first_name||"",last_name:s.last_name||"",email:s.email||"",phone:s.phone||"",company_name:s.company_name||"",partner_type:s.partner_type||"sole_proprietor",partner_status:s.partner_status||"active",commission_rate:s.commission_rate||20,agreement_sent:s.agreement_sent||!1,agreement_sent_date:s.agreement_sent_date||void 0,agreement_signed:s.agreement_signed||!1,agreement_signed_date:s.agreement_signed_date||void 0,agreement_version:s.agreement_version||void 0,internal_owner_id:s.internal_owner_id||void 0,partner_start_date:s.partner_start_date||void 0,next_follow_up_date:s.next_follow_up_date||void 0,partner_notes:s.partner_notes||"",portal_access_enabled:s.portal_access_enabled||!1,access_level:s.access_level||"standard"}:null,[s]),m=n.useCallback(async t=>{if(!s||!t.first_name||!t.last_name||!t.email)return!1;try{return await A(s.id,t),!0}catch{return!1}},[s,A]),{isSaving:w}=qe({data:a,onSave:m,enabled:x&&o,initialData:l}),g=async()=>{if(!a.first_name||!a.last_name||!a.email){I.error("First name, last name, and email are required");return}x||(await F(a),h())},y=async()=>{!s||!L||window.confirm("Are you sure you want to delete this partner? This action cannot be undone.")&&await L(s.id)&&h()},S=(t,C)=>{navigator.clipboard.writeText(t),W(C),setTimeout(()=>W(null),2e3)},M=t=>[t.first_name,t.last_name].filter(Boolean).join(" ")||t.email;return e.jsx($e,{open:o,onOpenChange:t=>!t&&h(),children:e.jsxs(ze,{className:"w-full sm:max-w-xl overflow-y-auto",children:[e.jsx(Be,{className:"mb-6",children:e.jsx(Ge,{className:"flex items-center gap-2",children:x?e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"h-5 w-5"}),"Partner Details"]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-5 w-5"}),"Add New Partner"]})})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-muted-foreground",children:[e.jsx(Je,{className:"h-4 w-4"}),"Identity & Contact"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"first_name",children:"First Name *"}),e.jsx(O,{id:"first_name",value:a.first_name||"",onChange:t=>i("first_name",t.target.value),placeholder:"John"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"last_name",children:"Last Name *"}),e.jsx(O,{id:"last_name",value:a.last_name||"",onChange:t=>i("last_name",t.target.value),placeholder:"Doe"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"email",children:"Email Address *"}),e.jsx(O,{id:"email",type:"email",value:a.email||"",onChange:t=>i("email",t.target.value),placeholder:"john@company.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"phone",children:"Phone Number"}),e.jsx(O,{id:"phone",value:a.phone||"",onChange:t=>i("phone",t.target.value),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"company_name",children:"Company Name"}),e.jsx(O,{id:"company_name",value:a.company_name||"",onChange:t=>i("company_name",t.target.value),placeholder:"Acme Corp"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Partner Type"}),e.jsxs($,{value:a.partner_type||"sole_proprietor",onValueChange:t=>i("partner_type",t),children:[e.jsx(z,{children:e.jsx(B,{placeholder:"Select type"})}),e.jsxs(G,{children:[e.jsx(j,{value:"company",children:"Company"}),e.jsx(j,{value:"sole_proprietor",children:"Sole Proprietor"})]})]})]})]}),e.jsx(U,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-muted-foreground",children:[e.jsx(Pe,{className:"h-4 w-4"}),"Agreement & Legal"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Agreement Sent"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{checked:a.agreement_sent||!1,onCheckedChange:t=>{i("agreement_sent",t),t&&!a.agreement_sent_date&&i("agreement_sent_date",new Date().toISOString().split("T")[0])}}),a.agreement_sent&&a.agreement_sent_date&&e.jsx("span",{className:"text-sm text-muted-foreground",children:E(a.agreement_sent_date)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Agreement Signed"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{checked:a.agreement_signed||!1,onCheckedChange:t=>{i("agreement_signed",t),t&&!a.agreement_signed_date&&i("agreement_signed_date",new Date().toISOString().split("T")[0])}}),a.agreement_signed&&a.agreement_signed_date&&e.jsx("span",{className:"text-sm text-muted-foreground",children:E(a.agreement_signed_date)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"agreement_version",children:"Agreement Version"}),e.jsx(O,{id:"agreement_version",value:a.agreement_version||"",onChange:t=>i("agreement_version",t.target.value),placeholder:"1.0"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"commission_rate",children:"Commission Rate (%)"}),e.jsx(O,{id:"commission_rate",type:"number",min:"0",max:"100",step:"0.5",value:a.commission_rate||20,onChange:t=>i("commission_rate",parseFloat(t.target.value)||0)})]})]})]}),e.jsx(U,{}),x&&s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-muted-foreground",children:[e.jsx(ue,{className:"h-4 w-4"}),"Financial Performance"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-muted-foreground",children:"Referrals Given"}),e.jsx("div",{className:"text-xl font-semibold",children:s.referrals_given||0})]}),e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-muted-foreground",children:"Qualified Referrals"}),e.jsx("div",{className:"text-xl font-semibold",children:s.qualified_referrals||0})]}),e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-muted-foreground",children:"Closed-Won Deals"}),e.jsx("div",{className:"text-xl font-semibold",children:s.closed_won_deals||0})]}),e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-muted-foreground",children:"Revenue Generated"}),e.jsx("div",{className:"text-xl font-semibold text-emerald-600",children:T(s.revenue_generated||0)})]}),e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-muted-foreground",children:"Total Commissions Earned"}),e.jsx("div",{className:"text-xl font-semibold",children:T(s.total_commissions_earned||0)})]}),e.jsxs("div",{className:"p-3 bg-muted/50 rounded-lg",children:[e.jsx("div",{className:"text-muted-foreground",children:"Outstanding Balance"}),e.jsx("div",{className:`text-xl font-semibold ${s.outstanding_commission_balance>0?"text-amber-600":""}`,children:T(s.outstanding_commission_balance||0)})]})]}),s.last_commission_payout_date&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Last Commission Payout: ",E(s.last_commission_payout_date)]})]}),e.jsx(U,{})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-muted-foreground",children:[e.jsx(re,{className:"h-4 w-4"}),"Relationship Management"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Internal Owner *"}),e.jsxs($,{value:a.internal_owner_id||"",onValueChange:t=>i("internal_owner_id",t||void 0),children:[e.jsx(z,{children:e.jsx(B,{placeholder:d?"Loading...":"Select owner"})}),e.jsx(G,{children:V.map(t=>e.jsx(j,{value:t.id,children:M(t)},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"partner_start_date",children:"Partner Start Date"}),e.jsx(O,{id:"partner_start_date",type:"date",value:a.partner_start_date||"",onChange:t=>i("partner_start_date",t.target.value||void 0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"next_follow_up_date",children:"Next Follow-Up Date"}),e.jsx(O,{id:"next_follow_up_date",type:"date",value:a.next_follow_up_date||"",onChange:t=>i("next_follow_up_date",t.target.value||void 0)})]})]}),x&&s?.last_activity_date&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Last Activity: ",E(s.last_activity_date)]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"partner_notes",children:"Partner Notes (Internal Only)"}),e.jsx(Xe,{id:"partner_notes",value:a.partner_notes||"",onChange:t=>i("partner_notes",t.target.value),placeholder:"Internal notes about this partner...",rows:3})]})]}),e.jsx(U,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-muted-foreground",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Portal Access"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(f,{htmlFor:"portal_access",children:"Portal Access Enabled"}),e.jsx(te,{id:"portal_access",checked:a.portal_access_enabled||!1,onCheckedChange:t=>i("portal_access_enabled",t)})]}),a.portal_access_enabled&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Access Level"}),e.jsxs($,{value:a.access_level||"standard",onValueChange:t=>i("access_level",t),children:[e.jsx(z,{children:e.jsx(B,{placeholder:"Select level"})}),e.jsxs(G,{children:[e.jsx(j,{value:"standard",children:"Standard"}),e.jsx(j,{value:"limited",children:"Limited"})]})]})]}),x&&s?.last_login_date&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Last Login: ",E(s.last_login_date)]})]}),x&&s&&e.jsxs(e.Fragment,{children:[e.jsx(U,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm font-semibold text-muted-foreground",children:"System Metadata"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Partner ID"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"text-xs bg-muted px-2 py-1 rounded",children:s.id}),e.jsx(v,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>S(s.id,"id"),children:R==="id"?e.jsx(Qe,{className:"h-3 w-3"}):e.jsx(Ye,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Created"}),e.jsx("span",{children:E(s.created_at)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last Updated"}),e.jsx("span",{children:E(s.updated_at)})]})]})]})]}),e.jsx(U,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Partner Status"}),e.jsxs($,{value:a.partner_status||"active",onValueChange:t=>i("partner_status",t),children:[e.jsx(z,{children:e.jsx(B,{placeholder:"Select status"})}),e.jsxs(G,{children:[e.jsx(j,{value:"active",children:"Active"}),e.jsx(j,{value:"inactive",children:"Inactive"}),e.jsx(j,{value:"terminated",children:"Terminated"})]})]})]}),e.jsx("div",{className:"flex items-center gap-2 pt-4 border-t",children:x?e.jsxs(e.Fragment,{children:[L&&e.jsxs(v,{variant:"destructive",className:"flex-1",onClick:y,disabled:D,children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Delete",w&&e.jsx(Q,{className:"h-3 w-3 ml-2 animate-spin"})]}),e.jsx(v,{variant:"outline",className:"flex-1",onClick:h,children:"Close"})]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"outline",className:"flex-1",onClick:h,children:"Cancel"}),e.jsxs(v,{className:"flex-1",onClick:g,disabled:D,children:[D&&e.jsx(Q,{className:"h-4 w-4 mr-2 animate-spin"}),"Create Partner"]})]})})]})]})})}function ps({summary:s}){const o=[{label:"Total Partners",value:s.total.toString(),icon:re,color:"text-blue-500"},{label:"Active",value:s.active.toString(),icon:es,color:"text-green-500"},{label:"Total Referrals",value:s.totalReferrals.toString(),icon:re,color:"text-purple-500"},{label:"Revenue Generated",value:T(s.totalRevenue),icon:ue,color:"text-emerald-500"},{label:"Total Commissions",value:T(s.totalCommissions),icon:ss,color:"text-blue-500"},{label:"Outstanding Balance",value:T(s.outstandingBalance),icon:Le,color:s.outstandingBalance>0?"text-amber-500":"text-muted-foreground"}];return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:o.map(h=>e.jsx(Ze,{children:e.jsx(Ke,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:h.label}),e.jsx("p",{className:"text-lg font-bold truncate",children:h.value})]}),e.jsx(h.icon,{className:`h-6 w-6 ${h.color} opacity-80 flex-shrink-0`})]})})},h.label))})}function rt(){const{partners:s,loading:o,error:h,summary:F,refetch:A,createPartner:L,updatePartner:D,deletePartner:x,mutating:V}=us(),[p,d]=n.useState(1),[N,R]=n.useState(50),[W,a]=n.useState(""),[_,b]=n.useState(""),[i,l]=n.useState("created_at"),[m,w]=n.useState("desc"),[g,y]=n.useState({}),[S,M]=n.useState(!1),[t,C]=n.useState(!1),[K,ee]=n.useState(null),[he,se]=n.useState(!1),{preferences:X,loading:_e,saveView:fe,loadView:ge,resetToDefault:pe}=hs(),ve=r=>{a(r);const c=setTimeout(()=>{b(r),d(1)},300);return()=>clearTimeout(c)},ne=n.useMemo(()=>{let r=[...s];if(_){const c=_.toLowerCase();r=r.filter(u=>`${u.first_name||""} ${u.last_name||""}`.toLowerCase().includes(c)||u.email.toLowerCase().includes(c)||(u.company_name?.toLowerCase().includes(c)??!1))}return g.status&&(r=r.filter(c=>c.partner_status===g.status)),r.sort((c,u)=>{let k=null,P=null;switch(i){case"name":k=`${c.first_name||""} ${c.last_name||""}`.toLowerCase(),P=`${u.first_name||""} ${u.last_name||""}`.toLowerCase();break;case"company_name":k=(c.company_name||"").toLowerCase(),P=(u.company_name||"").toLowerCase();break;case"partner_status":k=c.partner_status,P=u.partner_status;break;case"referrals_given":k=c.referrals_given||0,P=u.referrals_given||0;break;case"revenue_generated":k=c.revenue_generated||0,P=u.revenue_generated||0;break;case"created_at":k=new Date(c.created_at).getTime(),P=new Date(u.created_at).getTime();break;default:return 0}return k===null||P===null?0:k<P?m==="asc"?-1:1:k>P?m==="asc"?1:-1:0}),r},[s,_,g,i,m]),q=ne.length,H=Math.ceil(q/N),je=ne.slice((p-1)*N,p*N),Ne=r=>{const c=i===r&&m==="asc"?"desc":"asc";l(r),w(c),d(1)},be=r=>{ee(r),se(!0)},we=()=>{ee(null),se(!0)},ye=()=>{se(!1),ee(null)},Ce=r=>{R(parseInt(r)),d(1)},le=(r,c)=>{y(u=>{if(!c){const{[r]:k,...P}=u;return P}return{...u,[r]:c}}),d(1)},ie=()=>{y({}),d(1)},Se=(r,c)=>{fe(r)},Y=Object.keys(g).length;return o&&s.length===0||_e?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(Q,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(e.Fragment,{children:[e.jsx(De,{children:e.jsx("title",{children:"Partners | Admin"})}),e.jsxs("div",{className:"flex flex-col h-[calc(100vh-64px)] overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 p-6 pb-4 space-y-4 bg-background",children:[e.jsx(ps,{summary:F}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Partners"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[q," total partners"]})]}),e.jsxs("div",{className:"flex items-center gap-1 border-l pl-6",children:[e.jsx(v,{variant:X.activeViewName===null?"secondary":"ghost",size:"sm",onClick:pe,className:"text-sm",children:"All"}),X.savedViews.map(r=>e.jsx(v,{variant:X.activeViewName===r.name?"secondary":"ghost",size:"sm",onClick:()=>ge(r.name),className:"text-sm",children:r.name},r.name)),X.savedViews.length<3&&e.jsxs(v,{variant:"ghost",size:"sm",onClick:()=>C(!0),className:"text-sm text-muted-foreground",children:[e.jsx(Re,{className:"h-3 w-3 mr-1"}),"Save View"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(We,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(O,{placeholder:"Search partners...",value:W,onChange:r=>ve(r.target.value),className:"pl-9 w-64"})]}),e.jsxs(ts,{open:S,onOpenChange:M,children:[e.jsx(as,{asChild:!0,children:e.jsxs(v,{variant:"outline",className:"relative",children:[e.jsx(ds,{className:"h-4 w-4 mr-2"}),"Filters",Y>0&&e.jsx("span",{className:"absolute -top-1 -right-1 h-5 w-5 rounded-full bg-primary text-primary-foreground text-xs flex items-center justify-center",children:Y})]})}),e.jsx(rs,{className:"w-80",align:"end",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Filters"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"Status"}),e.jsxs($,{value:g.status||"",onValueChange:r=>le("status",r),children:[e.jsx(z,{children:e.jsx(B,{placeholder:"All statuses"})}),e.jsxs(G,{children:[e.jsx(j,{value:"",children:"All"}),e.jsx(j,{value:"active",children:"Active"}),e.jsx(j,{value:"pending",children:"Pending"}),e.jsx(j,{value:"suspended",children:"Suspended"})]})]})]}),Y>0&&e.jsx(v,{variant:"ghost",size:"sm",onClick:ie,className:"w-full",children:"Clear all filters"})]})})]}),e.jsx(v,{variant:"outline",asChild:!0,children:e.jsxs(Oe,{href:"/partner",children:[e.jsx(ms,{className:"h-4 w-4 mr-2"}),"Partner Portal"]})}),e.jsxs(v,{onClick:we,children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Add Partner"]})]})]}),Y>0&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Active filters:"}),Object.entries(g).map(([r,c])=>e.jsxs(v,{variant:"secondary",size:"sm",onClick:()=>le(r,""),className:"h-6 text-xs",children:[r,": ",c,e.jsx(Te,{className:"h-3 w-3 ml-1"})]},r)),e.jsx(v,{variant:"ghost",size:"sm",onClick:ie,className:"h-6 text-xs",children:"Clear all"})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden px-6",children:e.jsx("div",{className:"border rounded-lg h-full overflow-auto",children:h?e.jsxs("div",{className:"text-center py-8 text-destructive",children:[e.jsxs("p",{children:["Error loading partners: ",h]}),e.jsx(v,{onClick:A,variant:"outline",className:"mt-4",children:"Try Again"})]}):e.jsx(fs,{partners:je,loading:o,sortColumn:i,sortDirection:m,onSort:Ne,onPartnerClick:be})})}),e.jsx("div",{className:"flex-shrink-0 px-6 py-4 bg-background border-t",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Rows per page:"}),e.jsxs($,{value:N.toString(),onValueChange:Ce,children:[e.jsx(z,{className:"w-20",children:e.jsx(B,{})}),e.jsxs(G,{children:[e.jsx(j,{value:"25",children:"25"}),e.jsx(j,{value:"50",children:"50"}),e.jsx(j,{value:"100",children:"100"})]})]}),e.jsxs("span",{className:"text-sm text-muted-foreground ml-4",children:["Showing ",Math.min((p-1)*N+1,q)," -"," ",Math.min(p*N,q)," of ",q]})]}),H>1&&e.jsx(ns,{children:e.jsxs(ls,{children:[e.jsx(ae,{children:e.jsx(is,{onClick:()=>d(r=>Math.max(1,r-1)),className:p===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:Math.min(5,H)},(r,c)=>{const u=p<=3?c+1:p+c-2;return u<1||u>H?null:e.jsx(ae,{children:e.jsx(os,{onClick:()=>d(u),isActive:p===u,className:"cursor-pointer",children:u})},u)}),e.jsx(ae,{children:e.jsx(cs,{onClick:()=>d(r=>Math.min(H,r+1)),className:p===H?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})]}),e.jsx(gs,{partner:K,open:he,onClose:ye,onSave:L,onUpdate:D,onDelete:x,saving:V}),e.jsx(Me,{open:t,onOpenChange:C,onSave:Se,existingViewNames:X.savedViews.map(r=>r.name)})]})}export{rt as default};
