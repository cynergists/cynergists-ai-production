import{c as N,r as b,q as v,as as C,u as _,j as e,L as x,B as h,d as S,z as T,n as L,J as M,s as p,e as t}from"./app-C9sJHYCL.js";import{u as k}from"./useMutation-Dhp3buk0.js";import{I as E}from"./input-BIyZmrfA.js";import{T as B,a as q,b as l,c as n,d as D,e as r}from"./table-DvSgZRYl.js";import{D as z,a as I,b as A,c as d}from"./dropdown-menu-DmNfL3dz.js";import{E as P}from"./external-link-BROgRsZh.js";import{E as Q}from"./eye-B3-dt3tC.js";import{B as F}from"./ban-DF4GKJjE.js";import{C as H}from"./circle-check-big-C6DyEQk3.js";/* empty css            */import"./index-gSJB1IAk.js";import"./index-mEKJzlVy.js";import"./Combination-Bv4OtcuM.js";import"./index-DWjtwfXH.js";import"./check-BybgecC6.js";import"./circle-YOvGJZDq.js";const K=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],R=N("Ellipsis",K);function ie(){const[c,j]=b.useState(""),{toast:o}=v(),g=C(),{data:f,isLoading:y}=_({queryKey:["admin-tenants"],queryFn:async()=>{const{data:s,error:a}=await p.from("portal_tenants").select("*").order("created_at",{ascending:!1});if(a)throw a;return s}}),m=k({mutationFn:async({id:s,status:a})=>{const{error:u}=await p.from("portal_tenants").update({status:a}).eq("id",s);if(u)throw u},onSuccess:()=>{g.invalidateQueries({queryKey:["admin-tenants"]}),o({title:"Tenant status updated"})},onError:s=>{o({title:"Error updating tenant",description:s.message,variant:"destructive"})}}),i=f?.filter(s=>s.company_name.toLowerCase().includes(c.toLowerCase())||s.subdomain.toLowerCase().includes(c.toLowerCase())),w=(s,a)=>{if(a)return e.jsx(t,{variant:"outline",className:"bg-yellow-500/10 text-yellow-500 border-yellow-500/20",children:"Pending Setup"});switch(s){case"active":return e.jsx(t,{variant:"outline",className:"bg-green-500/10 text-green-500 border-green-500/20",children:"Active"});case"suspended":return e.jsx(t,{variant:"outline",className:"bg-red-500/10 text-red-500 border-red-500/20",children:"Suspended"});case"cancelled":return e.jsx(t,{variant:"outline",className:"bg-gray-500/10 text-gray-500 border-gray-500/20",children:"Cancelled"});default:return e.jsx(t,{variant:"outline",children:s})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(x,{href:"/admin/client-portal",children:e.jsx(h,{variant:"ghost",size:"icon",children:e.jsx(S,{className:"h-4 w-4"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Tenant Management"}),e.jsx("p",{className:"text-muted-foreground",children:"View and manage customer portal instances"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(T,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(E,{placeholder:"Search tenants...",value:c,onChange:s=>j(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[i?.length||0," tenant",i?.length!==1?"s":""]})]}),y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(L,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsx("div",{className:"border rounded-lg",children:e.jsxs(B,{children:[e.jsx(q,{children:e.jsxs(l,{children:[e.jsx(n,{children:"Subdomain"}),e.jsx(n,{children:"Company"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Created"}),e.jsx(n,{className:"w-[50px]"})]})}),e.jsx(D,{children:i?.length===0?e.jsx(l,{children:e.jsx(r,{colSpan:5,className:"text-center py-12 text-muted-foreground",children:"No tenants found"})}):i?.map(s=>e.jsxs(l,{children:[e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"text-sm bg-muted px-2 py-0.5 rounded",children:s.subdomain}),!s.is_temp_subdomain&&e.jsx("a",{href:`https://${s.subdomain}.cynergists.com`,target:"_blank",rel:"noopener noreferrer",className:"text-muted-foreground hover:text-foreground",children:e.jsx(P,{className:"h-3 w-3"})})]})}),e.jsx(r,{className:"font-medium",children:s.company_name}),e.jsx(r,{children:w(s.status,s.is_temp_subdomain)}),e.jsx(r,{className:"text-muted-foreground",children:M(new Date(s.created_at),"MMM d, yyyy")}),e.jsx(r,{children:e.jsxs(z,{children:[e.jsx(I,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"icon",children:e.jsx(R,{className:"h-4 w-4"})})}),e.jsxs(A,{align:"end",children:[e.jsx(d,{asChild:!0,children:e.jsxs(x,{href:`/portal?tenant=${s.subdomain}`,target:"_blank",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Preview Portal"]})}),s.status==="active"?e.jsxs(d,{onClick:()=>m.mutate({id:s.id,status:"suspended"}),className:"text-destructive",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Suspend"]}):s.status==="suspended"?e.jsxs(d,{onClick:()=>m.mutate({id:s.id,status:"active"}),children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Activate"]}):null]})]})})]},s.id))})]})})]})}export{ie as default};
