import{r,j as e,B as i,E as q,t as K,e as p,K as G,s as k,h as N}from"./app-yl1YHj2k.js";import{I as J}from"./input-B3tD5KH9.js";import{T as Q}from"./textarea-CY5CbXPo.js";import{T as U,a as X,b as u,c as o,d as Y,e as l}from"./table-Digz5nhl.js";import{D as Z,a as $,c as ee,d as se,e as te,f as re}from"./dialog-B01Lxjmp.js";import{S as D,a as F,b as I,c as L,d as n}from"./select-bZyWIIk8.js";import{B as le}from"./bell-RKaSnC8-.js";import{R as ae}from"./refresh-cw-BzMi6-fJ.js";import{F as ie}from"./filter-DvbsL620.js";import{T as oe}from"./triangle-alert-SZFjwlm_.js";import{I as ne}from"./info-Oa8sZutY.js";import{C as ce}from"./circle-check-big-DT-NY01w.js";import{E as de}from"./external-link-CTFkYG5W.js";/* empty css            */import"./index-DC5Tape7.js";import"./Combination-BU6xJxfT.js";import"./index-BdQq_4o_.js";import"./index-KgiDK8vA.js";import"./index-B4oGC8tk.js";import"./check-3ows1Yys.js";import"./chevron-up-CP4UIDax.js";const me={info:{icon:ne,color:"bg-blue-500/10 text-blue-500 border-blue-500/20"},warning:{icon:oe,color:"bg-yellow-500/10 text-yellow-500 border-yellow-500/20"},critical:{icon:K,color:"bg-destructive/10 text-destructive border-destructive/20"}},B={webhook:"Webhooks",payout:"Payouts",report:"Reports",fraud:"Fraud",permissions:"Permissions",integrity:"Data Integrity",payment:"Payments",commission:"Commissions"};function Le(){const[c,O]=r.useState([]),[A,y]=r.useState(!0),[j,E]=r.useState(""),[v,M]=r.useState("all"),[f,z]=r.useState("all"),[d,W]=r.useState(!1),[a,b]=r.useState(null),[H,m]=r.useState(!1),[w,C]=r.useState(""),[S,R]=r.useState(!1),g=async()=>{try{y(!0);let s=k.from("notifications").select("*").order("created_at",{ascending:!1});d||(s=s.is("resolved_at",null));const{data:t,error:h}=await s;if(h)throw h;O(t||[])}catch(s){console.error("Failed to fetch notifications:",s),N.error("Failed to load notifications")}finally{y(!1)}};r.useEffect(()=>{g()},[d]);const P=async()=>{if(a)try{R(!0);const{error:s}=await k.from("notifications").update({resolved_at:new Date().toISOString(),resolution_notes:w||null}).eq("id",a.id);if(s)throw s;N.success("Notification resolved"),m(!1),C(""),b(null),g()}catch(s){console.error("Failed to resolve notification:",s),N.error("Failed to resolve notification")}finally{R(!1)}},_=c.filter(s=>{if(v!=="all"&&s.severity!==v||f!=="all"&&s.category!==f)return!1;if(j){const t=j.toLowerCase();return s.title.toLowerCase().includes(t)||s.details?.toLowerCase().includes(t)||s.category.toLowerCase().includes(t)}return!0}),x={total:c.length,critical:c.filter(s=>s.severity==="critical"&&!s.resolved_at).length,warning:c.filter(s=>s.severity==="warning"&&!s.resolved_at).length,info:c.filter(s=>s.severity==="info"&&!s.resolved_at).length},V=s=>s.resource_type&&{partner:"/admin/partners",payment:"/admin/payments",partner_commissions:"/admin/commissions",partner_payouts:"/admin/payouts",webhook_events:"/admin/tracking",partner_report_runs:"/admin/tracking",partner_scheduled_reports:"/admin/tracking"}[s.resource_type]||null;return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(le,{className:"h-6 w-6"}),"System Notifications"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Monitor system alerts and issues"})]}),e.jsxs(i,{onClick:g,variant:"outline",size:"sm",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg border bg-card",children:[e.jsx("div",{className:"text-2xl font-bold",children:x.total}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total"})]}),e.jsxs("div",{className:"p-4 rounded-lg border bg-destructive/10 border-destructive/20",children:[e.jsx("div",{className:"text-2xl font-bold text-destructive",children:x.critical}),e.jsx("div",{className:"text-sm text-destructive",children:"Critical"})]}),e.jsxs("div",{className:"p-4 rounded-lg border bg-yellow-500/10 border-yellow-500/20",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-500",children:x.warning}),e.jsx("div",{className:"text-sm text-yellow-500",children:"Warning"})]}),e.jsxs("div",{className:"p-4 rounded-lg border bg-blue-500/10 border-blue-500/20",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-500",children:x.info}),e.jsx("div",{className:"text-sm text-blue-500",children:"Info"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(q,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(J,{placeholder:"Search notifications...",value:j,onChange:s=>E(s.target.value),className:"pl-9"})]}),e.jsxs(D,{value:v,onValueChange:M,children:[e.jsx(F,{className:"w-[140px]",children:e.jsx(I,{placeholder:"Severity"})}),e.jsxs(L,{children:[e.jsx(n,{value:"all",children:"All Severity"}),e.jsx(n,{value:"critical",children:"Critical"}),e.jsx(n,{value:"warning",children:"Warning"}),e.jsx(n,{value:"info",children:"Info"})]})]}),e.jsxs(D,{value:f,onValueChange:z,children:[e.jsx(F,{className:"w-[160px]",children:e.jsx(I,{placeholder:"Category"})}),e.jsxs(L,{children:[e.jsx(n,{value:"all",children:"All Categories"}),Object.entries(B).map(([s,t])=>e.jsx(n,{value:s,children:t},s))]})]}),e.jsxs(i,{variant:d?"secondary":"outline",size:"sm",onClick:()=>W(!d),children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),d?"Showing Resolved":"Show Resolved"]})]}),e.jsx("div",{className:"border rounded-lg",children:e.jsxs(U,{children:[e.jsx(X,{children:e.jsxs(u,{children:[e.jsx(o,{className:"w-[100px]",children:"Severity"}),e.jsx(o,{className:"w-[120px]",children:"Category"}),e.jsx(o,{children:"Title"}),e.jsx(o,{className:"w-[160px]",children:"Created"}),e.jsx(o,{className:"w-[100px]",children:"Status"}),e.jsx(o,{className:"w-[120px]",children:"Actions"})]})}),e.jsx(Y,{children:A?e.jsx(u,{children:e.jsx(l,{colSpan:6,className:"text-center py-8",children:"Loading..."})}):_.length===0?e.jsx(u,{children:e.jsx(l,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No notifications found"})}):_.map(s=>{const t=me[s.severity],h=t.icon,T=V(s);return e.jsxs(u,{children:[e.jsx(l,{children:e.jsxs(p,{variant:"outline",className:t.color,children:[e.jsx(h,{className:"h-3 w-3 mr-1"}),s.severity]})}),e.jsx(l,{children:e.jsx("span",{className:"text-sm",children:B[s.category]||s.category})}),e.jsx(l,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.title}),s.details&&e.jsx("div",{className:"text-sm text-muted-foreground line-clamp-1",children:s.details})]})}),e.jsx(l,{className:"text-sm text-muted-foreground",children:G(new Date(s.created_at),"MMM d, h:mm a")}),e.jsx(l,{children:s.resolved_at?e.jsxs(p,{variant:"outline",className:"bg-green-500/10 text-green-500 border-green-500/20",children:[e.jsx(ce,{className:"h-3 w-3 mr-1"}),"Resolved"]}):e.jsx(p,{variant:"outline",children:"Open"})}),e.jsx(l,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[!s.resolved_at&&e.jsx(i,{variant:"outline",size:"sm",onClick:()=>{b(s),m(!0)},children:"Resolve"}),T&&e.jsx(i,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx("a",{href:T,children:e.jsx(de,{className:"h-4 w-4"})})})]})})]},s.id)})})]})})]}),e.jsx(Z,{open:H,onOpenChange:m,children:e.jsxs($,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Resolve Notification"}),e.jsx(te,{children:"Mark this notification as resolved. Optionally add notes about the resolution."})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[e.jsx("div",{className:"font-medium",children:a.title}),a.details&&e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:a.details})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Resolution Notes (optional)"}),e.jsx(Q,{placeholder:"What was done to resolve this issue?",value:w,onChange:s=>C(s.target.value),className:"mt-1"})]})]}),e.jsxs(re,{children:[e.jsx(i,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(i,{onClick:P,disabled:S,children:S?"Resolving...":"Mark Resolved"})]})]})})]})}export{Le as default};
