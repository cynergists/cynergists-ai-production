import{q as D,r as l,s as o,i as R,j as e,m as g,H as T,aC as I,B as x,L as M,d as B}from"./app-Lw9toWEL.js";import{I as y}from"./input-yF94Vncd.js";import{P as C}from"./password-input-C0oCUV2I.js";import{L as u}from"./label-BmZ0klfu.js";import{C as U,b as _,c as H,d as O,a as $}from"./card-HJJ00fMS.js";import{g as N}from"./logger-Ls6Omhf8.js";/* empty css            */import"./eye-off-CwyeFkCS.js";import"./eye-COYcjsCX.js";import"./index-Bewwc68W.js";const Z=()=>{const{toast:a}=D(),[r,f]=l.useState(""),[n,w]=l.useState(""),[v,b]=l.useState(""),[c,d]=l.useState(!1),[P,h]=l.useState(!0),[p,m]=l.useState("login");l.useEffect(()=>{const{data:{subscription:s}}=o.auth.onAuthStateChange((t,i)=>{i?.user?setTimeout(()=>{j(i.access_token)},0):h(!1)});return o.auth.getSession().then(({data:{session:t}})=>{t?.user?j(t.access_token):h(!1)}),()=>s.unsubscribe()},[]);const j=async s=>{try{const{data:t,error:i}=await o.functions.invoke("check-admin-status",{headers:{Authorization:`Bearer ${s}`}});if(i){a({title:"Error",description:"Failed to verify admin status",variant:"destructive"}),await o.auth.signOut(),h(!1);return}t?.isAdmin?R.visit("/admin/agreements"):(a({title:"Access Denied",description:"You don't have admin permissions",variant:"destructive"}),await o.auth.signOut(),h(!1))}catch{h(!1)}},F=async s=>{if(s.preventDefault(),!r||!n){a({title:"Missing Fields",description:"Please enter both email and password",variant:"destructive"});return}d(!0);try{const{data:t,error:i}=await o.auth.signInWithPassword({email:r,password:n});if(i)throw i;t.session&&await j(t.session.access_token)}catch(t){a({title:"Login Failed",description:N(t),variant:"destructive"})}finally{d(!1)}},E=async s=>{if(s.preventDefault(),!r||!n||!v){a({title:"Missing Fields",description:"Please fill in all fields",variant:"destructive"});return}if(r.split("@")[1]?.toLowerCase()!=="cynergists.com"){a({title:"Invalid Email Domain",description:"Only @cynergists.com email addresses are allowed to sign up",variant:"destructive"});return}if(n!==v){a({title:"Passwords Don't Match",description:"Please make sure your passwords match",variant:"destructive"});return}if(n.length<6){a({title:"Password Too Short",description:"Password must be at least 6 characters",variant:"destructive"});return}d(!0);try{const{data:i,error:k}=await o.auth.signUp({email:r,password:n,options:{emailRedirectTo:`${window.location.origin}/signin`}});if(k)throw k;i.user&&(a({title:"Account Created",description:"You can now sign in with your credentials"}),m("login"),w(""),b(""))}catch(i){a({title:"Sign Up Failed",description:N(i),variant:"destructive"})}finally{d(!1)}},A=async s=>{if(s.preventDefault(),!r){a({title:"Email Required",description:"Please enter your email address",variant:"destructive"});return}d(!0);try{const{error:t}=await o.auth.resetPasswordForEmail(r,{redirectTo:`${window.location.origin}/signin`});if(t)throw t;a({title:"Reset Email Sent",description:"Check your email for a password reset link"}),m("login")}catch(t){a({title:"Reset Failed",description:N(t),variant:"destructive"})}finally{d(!1)}},S=()=>{switch(p){case"signup":return"Admin Sign Up";case"reset":return"Reset Password";default:return"Admin Login"}},L=()=>{switch(p){case"signup":return"Create your admin account";case"reset":return"Enter your email to receive a reset link";default:return"Sign in to access the admin panel"}};return P?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx(g,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:[e.jsxs(T,{children:[e.jsxs("title",{children:[S()," | Cynergists"]}),e.jsx("meta",{name:"robots",content:"noindex, nofollow"})]}),e.jsxs(U,{className:"w-full max-w-md",children:[e.jsxs(_,{className:"text-center",children:[e.jsx("div",{className:"mx-auto mb-4",children:e.jsx("img",{src:I,alt:"Cynergists",className:"h-16 w-auto"})}),e.jsx(H,{className:"text-2xl",children:S()}),e.jsx(O,{children:L()})]}),e.jsxs($,{children:[p==="reset"?e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"reset-email",children:"Email"}),e.jsx(y,{id:"reset-email",type:"email",value:r,onChange:s=>f(s.target.value),placeholder:"admin@cynergists.com",autoComplete:"email"})]}),e.jsx(x,{type:"submit",className:"w-full",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"mr-2 h-4 w-4 animate-spin"}),"Sending..."]}):"Send Reset Link"}),e.jsx(x,{type:"button",variant:"ghost",className:"w-full",onClick:()=>m("login"),children:"Back to Login"})]}):p==="signup"?e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"signup-email",children:"Email"}),e.jsx(y,{id:"signup-email",type:"email",value:r,onChange:s=>f(s.target.value),placeholder:"admin@cynergists.com",autoComplete:"email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"signup-password",children:"Password"}),e.jsx(C,{id:"signup-password",value:n,onChange:s=>w(s.target.value),placeholder:"••••••••",autoComplete:"new-password"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"confirm-password",children:"Confirm Password"}),e.jsx(C,{id:"confirm-password",value:v,onChange:s=>b(s.target.value),placeholder:"••••••••",autoComplete:"new-password"})]}),e.jsx(x,{type:"submit",className:"w-full",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating Account..."]}):"Sign Up"}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:()=>m("login"),className:"text-sm text-primary hover:underline",children:"Already have an account? Sign in"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"email",children:"Email"}),e.jsx(y,{id:"email",type:"email",value:r,onChange:s=>f(s.target.value),placeholder:"admin@cynergists.com",autoComplete:"email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"password",children:"Password"}),e.jsx(C,{id:"password",value:n,onChange:s=>w(s.target.value),placeholder:"••••••••",autoComplete:"current-password"})]}),e.jsx(x,{type:"submit",className:"w-full",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"mr-2 h-4 w-4 animate-spin"}),"Signing in..."]}):"Sign In"})]}),e.jsxs("div",{className:"mt-4 flex flex-col items-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>m("reset"),className:"text-sm text-primary hover:underline",children:"Forgot your password?"}),e.jsx("button",{type:"button",onClick:()=>m("signup"),className:"text-sm text-muted-foreground hover:text-foreground",children:"Don't have an account? Sign up"})]})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs(M,{href:"/",className:"text-sm text-muted-foreground hover:text-foreground inline-flex items-center gap-1",children:[e.jsx(B,{className:"h-3 w-3"}),"Back to website"]})})]})]})]})};export{Z as default};
