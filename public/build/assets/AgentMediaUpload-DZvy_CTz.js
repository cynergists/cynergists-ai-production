import{r as o,q as R,j as t,a as k,m as C,B as g,X as B,W as E,Y as L,b as O}from"./app-C0WycfZe.js";import{I as W}from"./input-B1mdCLd5.js";import{U as q}from"./upload-BPhQo0Ew.js";function V({media:r,onChange:y,agentName:M,maxItems:c}){const[f,j]=o.useState(!1),[w,m]=o.useState(!1),[d,n]=o.useState(0),l=o.useRef(null),{toast:u}=R(),N=async e=>{const a=e.type.startsWith("image/"),s=e.type.startsWith("video/");if(!a&&!s){u({title:"Invalid file type",description:"Please select an image or video file.",variant:"destructive"});return}const x=s?50*1024*1024:5*1024*1024;if(e.size>x){u({title:"File too large",description:`Please select a file under ${s?"50MB":"5MB"}.`,variant:"destructive"});return}j(!0);try{const h=new FormData;h.append("file",e);const D=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),v=await fetch("/api/admin/ai-agents/media",{method:"POST",credentials:"same-origin",headers:D?{"X-CSRF-TOKEN":D}:void 0,body:h});if(!v.ok){const z=await v.json().catch(()=>({}));throw new Error(z.message||"Upload failed")}const b={url:(await v.json()).url,type:s?"video":"image"};let i;c===1?i=[b]:typeof c=="number"&&c>0?i=[...r,b].slice(-c):i=[...r,b],y(i),n(Math.max(0,i.length-1)),u({title:"File uploaded",description:`Your ${s?"video":"image"} has been uploaded successfully.`})}catch(h){console.error("Upload error:",h),u({title:"Upload failed",description:"Failed to upload file. Please try again.",variant:"destructive"})}finally{j(!1),l.current&&(l.current.value="")}},P=async e=>{const a=e.target.files;if(a)for(let s=0;s<a.length;s++)await N(a[s])},U=e=>{e.preventDefault(),e.stopPropagation(),m(!0)},A=e=>{e.preventDefault(),e.stopPropagation(),m(!1)},F=async e=>{e.preventDefault(),e.stopPropagation(),m(!1);const a=e.dataTransfer.files;if(a)for(let s=0;s<a.length;s++)await N(a[s])},I=e=>{const a=r.filter((s,x)=>x!==e);y(a),d>=a.length&&n(Math.max(0,a.length-1))},S=o.useCallback(()=>{n(e=>e>0?e-1:r.length-1)},[r.length]),T=o.useCallback(()=>{n(e=>e<r.length-1?e+1:0)},[r.length]),p=r[d];return t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:k("relative aspect-video rounded-2xl overflow-hidden border-2 transition-colors cursor-pointer",w?"border-primary bg-primary/10 border-dashed":r.length===0?"border-dashed border-border/50 bg-card/50 hover:border-primary/50":"border-border/50 bg-card/50"),onClick:()=>!r.length&&l.current?.click(),onDragOver:U,onDragLeave:A,onDrop:F,children:f?t.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[t.jsx(C,{className:"h-8 w-8 animate-spin text-muted-foreground mb-2"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Uploading..."})]}):p?t.jsxs(t.Fragment,{children:[p.type==="video"?t.jsx("video",{src:p.url,className:"w-full h-full object-cover",controls:!0}):t.jsx("img",{src:p.url,alt:M||"AI Agent",className:"w-full h-full object-cover"}),t.jsx(g,{type:"button",variant:"destructive",size:"icon",className:"absolute top-2 right-2 h-7 w-7",onClick:e=>{e.stopPropagation(),I(d)},children:t.jsx(B,{className:"h-4 w-4"})}),r.length>1&&t.jsxs(t.Fragment,{children:[t.jsx(g,{type:"button",variant:"secondary",size:"icon",className:"absolute left-2 top-1/2 -translate-y-1/2 h-8 w-8 opacity-80 hover:opacity-100",onClick:e=>{e.stopPropagation(),S()},children:t.jsx(E,{className:"h-4 w-4"})}),t.jsx(g,{type:"button",variant:"secondary",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8 opacity-80 hover:opacity-100",onClick:e=>{e.stopPropagation(),T()},children:t.jsx(L,{className:"h-4 w-4"})})]}),r.length>1&&t.jsx("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 flex gap-1.5",children:r.map((e,a)=>t.jsx("button",{type:"button",className:k("w-2 h-2 rounded-full transition-colors",a===d?"bg-white":"bg-white/50 hover:bg-white/75"),onClick:s=>{s.stopPropagation(),n(a)}},a))})]}):t.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8",children:[t.jsx("div",{className:"p-4 rounded-2xl bg-primary/10 border border-primary/30 mb-3",children:t.jsx(O,{className:"h-8 w-8 text-primary"})}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"AI Agent Media"}),t.jsx("p",{className:"text-xs text-muted-foreground",children:w?"Drop files here":"Drop images or videos here, or click to upload"})]})}),t.jsx(W,{ref:l,type:"file",accept:"image/*,video/*",multiple:!0,onChange:P,className:"hidden"}),r.length>0&&t.jsxs(g,{type:"button",variant:"outline",size:"sm",className:"w-full",onClick:()=>l.current?.click(),disabled:f,children:[f?t.jsx(C,{className:"h-4 w-4 mr-2 animate-spin"}):t.jsx(q,{className:"h-4 w-4 mr-2"}),"Add More Media"]})]})}export{V as A};
