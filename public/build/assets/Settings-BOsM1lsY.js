import{c as W,bd as X,q as J,w as O,be as V,r as t,f as w,j as e,aA as Z,G as ee,m as h,X as se,B as S}from"./app-C0WycfZe.js";import{C as p,b as j,c as g,d as N,a as y}from"./card-Bi-8_L45.js";import{I as u}from"./input-B1mdCLd5.js";import{L as r}from"./label-BqY6sEFX.js";import{S as k}from"./switch-weRXBmuD.js";import{S as F}from"./separator-DtO6fCux.js";import{u as ae}from"./useDebounce-BjLFdDYj.js";import{C as te}from"./check-43nAdBq2.js";import{E as re}from"./external-link-CBryBEte.js";import{U as ie}from"./user-DjluDWYY.js";import{B as ne}from"./bell-CRCdcVZ0.js";import{S as le}from"./shield-BQw2j_Wk.js";/* empty css            */import"./index-B-RSaXN7.js";import"./index-CuknWpgH.js";import"./index-Bv5Nm0Cj.js";const ce=[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]],oe=W("Palette",ce);function ke(){const{user:P}=X(),{toast:o}=J(),T=O(),{data:i,isLoading:Y}=V(),[v,L]=t.useState(""),[D,A]=t.useState(!1),[d,c]=t.useState(null),[M,l]=t.useState(""),[E,U]=t.useState(!1),[G,b]=t.useState(!1),[$,I]=t.useState(!1),[m,B]=t.useState(!1),[n,x]=t.useState({firstName:"",lastName:"",companyName:""}),[C,q]=t.useState({firstName:"",lastName:"",companyName:""}),_=ae(v,500);t.useEffect(()=>{i?.subdomain&&L(i.subdomain)},[i?.subdomain]),t.useEffect(()=>{if(!P?.id)return;(async()=>{I(!0);try{const a=await w.get("/api/portal/profile"),f={firstName:a.profile?.first_name??"",lastName:a.profile?.last_name??"",companyName:a.profile?.company_name??""};x(f),q(f)}catch(a){console.error("Error loading profile:",a),o({title:"Failed to load profile",description:"Please refresh and try again.",variant:"destructive"})}finally{I(!1)}})()},[P?.id,o]);const z=t.useCallback(async s=>{if(i?.subdomain&&s===i.subdomain){c(null),l(""),b(!1);return}if(s.length<3){c(null),l("Minimum 3 characters"),b(!1);return}b(!0),A(!0);try{const a=await w.post("/api/portal/tenant/check-subdomain",{subdomain:s});c(a.available),a.available?l("Available!"):a.reason==="invalid_format"?l(a.message||"Invalid format"):l("Already taken")}catch(a){console.error("Error checking subdomain:",a),c(null),l("Error checking availability")}finally{A(!1)}},[i?.subdomain]);t.useEffect(()=>{_?z(_):(c(null),l(""))},[_,z]);const H=s=>{const a=s.target.value.toLowerCase().replace(/[^a-z0-9-]/g,"");L(a),c(null),l("")},Q=async()=>{if(!(!d||E)){U(!0);try{const s=await w.post("/api/portal/tenant/claim-subdomain",{subdomain:v});if(s.success)o({title:"Portal address updated!",description:`Your portal is now at ${v}.cynergists.com`}),T.invalidateQueries({queryKey:["current-user-tenant"]}),b(!1),c(null),l("");else throw new Error(s.error||"Failed to update subdomain")}catch(s){console.error("Error updating subdomain:",s),o({title:"Failed to update address",description:s instanceof Error?s.message:"Please try again.",variant:"destructive"})}finally{U(!1)}}},R=t.useMemo(()=>n.firstName!==C.firstName||n.lastName!==C.lastName||n.companyName!==C.companyName,[n,C]),K=async()=>{if(!(m||!R)){B(!0);try{const s={first_name:n.firstName.trim()||null,last_name:n.lastName.trim()||null,company_name:n.companyName.trim()||null},a=await w.put("/api/portal/profile",s),f={firstName:a.profile?.first_name??s.first_name??"",lastName:a.profile?.last_name??s.last_name??"",companyName:a.profile?.company_name??s.company_name??""};x(f),q(f),o({title:"Profile updated",description:"Your profile information has been saved."})}catch(s){console.error("Error updating profile:",s),o({title:"Failed to update profile",description:s instanceof Error?s.message:"Please try again.",variant:"destructive"})}finally{B(!1)}}};return e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Z,{className:"h-8 w-8 text-primary"}),e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Settings"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your account preferences and settings."})]}),e.jsxs("div",{className:"space-y-6 max-w-2xl",children:[e.jsxs(p,{children:[e.jsxs(j,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(g,{children:"Portal Address"})]}),e.jsx(N,{children:"Your unique portal URL where your team accesses agents"})]}),e.jsx(y,{className:"space-y-4",children:Y?e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(h,{className:"h-4 w-4 animate-spin"}),"Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"subdomain",children:"Portal Address"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(u,{id:"subdomain",value:v,onChange:H,placeholder:"your-company",className:"pr-10",maxLength:30}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:D?e.jsx(h,{className:"h-4 w-4 animate-spin text-muted-foreground"}):d===!0?e.jsx(te,{className:"h-4 w-4 text-green-500"}):d===!1?e.jsx(se,{className:"h-4 w-4 text-destructive"}):null})]}),e.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:".cynergists.com"})]}),M&&e.jsx("p",{className:`text-xs ${d?"text-green-500":d===!1?"text-destructive":"text-muted-foreground"}`,children:M})]}),i?.subdomain&&!i.is_temp_subdomain&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:"Current:"}),e.jsxs("a",{href:`https://${i.subdomain}.cynergists.com`,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline flex items-center gap-1",children:[i.subdomain,".cynergists.com",e.jsx(re,{className:"h-3 w-3"})]})]}),e.jsx(S,{onClick:Q,disabled:!d||E||!G,children:E?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"h-4 w-4 animate-spin mr-2"}),"Saving..."]}):"Update Address"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use lowercase letters, numbers, and hyphens only. Minimum 3 characters."})]})})]}),e.jsxs(p,{children:[e.jsxs(j,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(g,{children:"Profile"})]}),e.jsx(N,{children:"Your account information"})]}),e.jsx(y,{className:"space-y-4",children:$?e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(h,{className:"h-4 w-4 animate-spin"}),"Loading profile..."]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"email",children:"Email"}),e.jsx(u,{id:"email",value:P?.email||"",disabled:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"firstName",children:"First Name"}),e.jsx(u,{id:"firstName",value:n.firstName,onChange:s=>x(a=>({...a,firstName:s.target.value})),placeholder:"Enter first name",disabled:m})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"lastName",children:"Last Name"}),e.jsx(u,{id:"lastName",value:n.lastName,onChange:s=>x(a=>({...a,lastName:s.target.value})),placeholder:"Enter last name",disabled:m})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"company",children:"Company"}),e.jsx(u,{id:"company",value:n.companyName,onChange:s=>x(a=>({...a,companyName:s.target.value})),placeholder:"Enter company name",disabled:m})]}),e.jsx(S,{onClick:K,disabled:m||!R,children:m?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"h-4 w-4 animate-spin mr-2"}),"Saving..."]}):"Save Changes"})]})})]}),e.jsxs(p,{children:[e.jsxs(j,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(g,{children:"Notifications"})]}),e.jsx(N,{children:"Configure how you receive notifications"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(r,{children:"Email Notifications"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive updates about your agents via email"})]}),e.jsx(k,{defaultChecked:!0})]}),e.jsx(F,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(r,{children:"Weekly Reports"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Get a weekly summary of agent activity"})]}),e.jsx(k,{defaultChecked:!0})]}),e.jsx(F,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(r,{children:"Product Updates"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Learn about new features and improvements"})]}),e.jsx(k,{})]})]})]}),e.jsxs(p,{children:[e.jsxs(j,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(g,{children:"Security"})]}),e.jsx(N,{children:"Manage your account security"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(r,{children:"Two-Factor Authentication"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add an extra layer of security"})]}),e.jsx(S,{variant:"outline",size:"sm",children:"Enable"})]}),e.jsx(F,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{children:"Password"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{type:"password",value:"••••••••••••",disabled:!0,className:"flex-1"}),e.jsx(S,{variant:"outline",children:"Change"})]})]})]})]}),e.jsxs(p,{children:[e.jsxs(j,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(g,{children:"Appearance"})]}),e.jsx(N,{children:"Customize your interface"})]}),e.jsx(y,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(r,{children:"Dark Mode"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use dark theme across the portal"})]}),e.jsx(k,{defaultChecked:!0})]})})]})]})]})}export{ke as default};
