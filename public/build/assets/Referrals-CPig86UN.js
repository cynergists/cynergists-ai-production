import{bb as H,r,a as Q,s as N,j as e,B as d,P as C,I as O,U as Y,v as U,i as V,g as $}from"./app-CjsYDFmT.js";import{I as c}from"./input-BBc2sdOt.js";import{C as w,a as S,b as J,c as X,d as z}from"./card-Dz0yCaqc.js";import{T as G,a as K,b as k,c as m,d as M,e as h}from"./table-eclqq7yM.js";import{D as W,g as Z,a as ee,c as ae,d as se,e as le,f as re}from"./dialog-vfH9N2qe.js";import{S as te,a as ie,b as ne,c as oe,d as n}from"./select-BZPifpxC.js";import{L as u}from"./label-Dvt0WIie.js";import{T as de}from"./textarea-DjNE0yWa.js";import{S as ce}from"./skeleton-CWsBq0yN.js";import{C as me}from"./copy-BKS4uOiM.js";import{F as he}from"./filter-fyqNCUYX.js";import{C as ue}from"./circle-x-DMjGwAh4.js";import{C as D}from"./circle-check-qJyH3kqC.js";/* empty css            */import"./index-58Jk2LJy.js";import"./Combination-Mg1W9W58.js";import"./index-BdQq_4o_.js";import"./index-G0k2b-8C.js";import"./index-BSKaJvun.js";import"./check-BI7rB0RY.js";import"./chevron-up-CP4nq72x.js";import"./index-CSw9D2VK.js";const R={new:{label:"New",icon:V,className:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400"},needs_approval:{label:"Needs Approval",icon:U,className:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400"},qualified:{label:"Qualified",icon:D,className:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400"},converted:{label:"Converted",icon:D,className:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400"},rejected:{label:"Rejected",icon:ue,className:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400"}},xe={form_submit:"Form Submit",booked_call:"Booked Call",paid_checkout:"Paid Checkout",deal_registration:"Deal Registration"};function Be(){const{partner:t}=H(),[L,F]=r.useState([]),[T,I]=r.useState(!0),[x,E]=r.useState(""),[f,P]=r.useState("all"),[A,p]=r.useState(!1),[y,v]=r.useState(!1),{toast:o}=Q(),[s,i]=r.useState({lead_name:"",lead_email:"",lead_phone:"",lead_company:"",notes:""}),g=t?.slug?`${window.location.origin}/p/${t.slug}`:null;r.useEffect(()=>{_()},[t?.id]);const _=async()=>{if(t?.id)try{const{data:a,error:l}=await N.from("referrals").select("*").eq("partner_id",t.id).order("created_at",{ascending:!1});if(l)throw l;F(a||[])}catch(a){console.error("Error fetching referrals:",a),o({title:"Error",description:"Failed to load referrals",variant:"destructive"})}finally{I(!1)}},B=async()=>{if(!s.lead_email){o({title:"Email required",description:"Please enter the lead's email address",variant:"destructive"});return}v(!0);try{const{error:a}=await N.from("referrals").insert({partner_id:t.id,lead_name:s.lead_name||null,lead_email:s.lead_email,lead_phone:s.lead_phone||null,lead_company:s.lead_company||null,notes:s.notes||null,source:"deal_registration",attribution_type:"deal_registration",status:"new"});if(a)throw a;o({title:"Referral submitted!",description:"Your referral has been registered successfully."}),i({lead_name:"",lead_email:"",lead_phone:"",lead_company:"",notes:""}),p(!1),_()}catch(a){console.error("Error submitting referral:",a),o({title:"Error",description:"Failed to submit referral. Please try again.",variant:"destructive"})}finally{v(!1)}},q=()=>{g&&(navigator.clipboard.writeText(g),o({title:"Link copied!",description:"Your referral link has been copied to clipboard."}))},j=L.filter(a=>{const l=a.lead_email.toLowerCase().includes(x.toLowerCase())||a.lead_name?.toLowerCase().includes(x.toLowerCase())||a.lead_company?.toLowerCase().includes(x.toLowerCase()),b=f==="all"||a.status===f;return l&&b});return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Referrals"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Submit referrals and track their progress"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[g&&e.jsxs(d,{variant:"outline",onClick:q,className:"gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"Copy Link"]}),e.jsxs(W,{open:A,onOpenChange:p,children:[e.jsx(Z,{asChild:!0,children:e.jsxs(d,{className:"gap-2",children:[e.jsx(C,{className:"h-4 w-4"}),"Submit Referral"]})}),e.jsxs(ee,{children:[e.jsxs(ae,{children:[e.jsx(se,{children:"Submit New Referral"}),e.jsx(le,{children:"Register a lead for deal attribution. This ensures you get credit if they become a client."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"lead_email",children:"Email *"}),e.jsx(c,{id:"lead_email",type:"email",placeholder:"lead@company.com",value:s.lead_email,onChange:a=>i({...s,lead_email:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"lead_name",children:"Full Name"}),e.jsx(c,{id:"lead_name",placeholder:"John Smith",value:s.lead_name,onChange:a=>i({...s,lead_name:a.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"lead_phone",children:"Phone"}),e.jsx(c,{id:"lead_phone",placeholder:"(555) 123-4567",value:s.lead_phone,onChange:a=>i({...s,lead_phone:a.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"lead_company",children:"Company"}),e.jsx(c,{id:"lead_company",placeholder:"Acme Inc",value:s.lead_company,onChange:a=>i({...s,lead_company:a.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"notes",children:"Notes"}),e.jsx(de,{id:"notes",placeholder:"Any additional context about this referral...",value:s.notes,onChange:a=>i({...s,notes:a.target.value})})]})]}),e.jsxs(re,{children:[e.jsx(d,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(d,{onClick:B,disabled:y,children:y?"Submitting...":"Submit Referral"})]})]})]})]})]}),e.jsx(w,{children:e.jsx(S,{className:"py-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(c,{placeholder:"Search by name, email, or company...",className:"pl-10",value:x,onChange:a=>E(a.target.value)})]}),e.jsxs(te,{value:f,onValueChange:P,children:[e.jsxs(ie,{className:"w-[180px]",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),e.jsx(ne,{placeholder:"Filter by status"})]}),e.jsxs(oe,{children:[e.jsx(n,{value:"all",children:"All Status"}),e.jsx(n,{value:"new",children:"New"}),e.jsx(n,{value:"needs_approval",children:"Needs Approval"}),e.jsx(n,{value:"qualified",children:"Qualified"}),e.jsx(n,{value:"converted",children:"Converted"}),e.jsx(n,{value:"rejected",children:"Rejected"})]})]})]})})}),e.jsxs(w,{children:[e.jsxs(J,{children:[e.jsx(X,{children:"Your Referrals"}),e.jsxs(z,{children:[j.length," referral",j.length!==1?"s":""," found"]})]}),e.jsx(S,{children:T?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((a,l)=>e.jsx(ce,{className:"h-16 w-full"},l))}):j.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Y,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"No referrals yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Submit your first referral or share your link to start earning commissions."}),e.jsx("div",{className:"flex justify-center gap-2",children:e.jsxs(d,{onClick:()=>p(!0),children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Submit Referral"]})})]}):e.jsxs(G,{children:[e.jsx(K,{children:e.jsxs(k,{children:[e.jsx(m,{children:"Lead"}),e.jsx(m,{children:"Company"}),e.jsx(m,{children:"Source"}),e.jsx(m,{children:"Status"}),e.jsx(m,{children:"Date"})]})}),e.jsx(M,{children:j.map(a=>{const l=R[a.status]||R.new,b=l.icon;return e.jsxs(k,{children:[e.jsx(h,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.lead_name||"—"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.lead_email})]})}),e.jsx(h,{children:a.lead_company||"—"}),e.jsx(h,{children:e.jsx("span",{className:"text-sm",children:xe[a.source]||a.source})}),e.jsx(h,{children:e.jsxs($,{className:l.className,children:[e.jsx(b,{className:"h-3 w-3 mr-1"}),l.label]})}),e.jsx(h,{children:e.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(a.created_at).toLocaleDateString()})})]},a.id)})})]})})]})]})}export{Be as default};
