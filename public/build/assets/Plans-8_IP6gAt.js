import{c as Ye,u as De,w as Pe,s as ne,r as o,q as ie,j as e,B as b,X as es,m as M,R as Se,v as ss,i as ts,H as rs,E as as,L as ls,P as ns,b6 as is,aJ as cs,aK as os,aL as ds}from"./app-C0WycfZe.js";import{I as x}from"./input-B1mdCLd5.js";import{T as V}from"./textarea-HgaMdGFR.js";import{L as d}from"./label-BqY6sEFX.js";import{D as fe,a as be,c as Ne,d as _e}from"./dialog-BrdWhXwW.js";import{S as N,a as _,b as w,c as C,d as c}from"./select-DQRCPwkF.js";import{T as us,a as hs,b as we,c as I,d as ms,e as R}from"./table-D6JhU9yR.js";import{e as ps,f as gs,g as xs,h as js}from"./useAdminQueries-Bpz03Mtn.js";import{u as ke}from"./useMutation-HYWZGZXg.js";import{c as ce}from"./admin-api-CvF4xGn2.js";import{U as Ce}from"./upload-BPhQo0Ew.js";import{I as ys}from"./info-BVKCw84N.js";import{A as vs,a as fs}from"./arrow-up-Iuc7k1Ih.js";import{A as bs}from"./arrow-down-DakVNnj8.js";/* empty css            */import"./index-B-RSaXN7.js";import"./index-Cch_8Clv.js";import"./Combination-COh087cd.js";import"./index-BdQq_4o_.js";import"./index-CQc07GE5.js";import"./index-CuknWpgH.js";import"./check-43nAdBq2.js";import"./chevron-up-DGGjGr1B.js";const Ns=[["rect",{width:"18",height:"7",x:"3",y:"3",rx:"1",key:"f1a2em"}],["rect",{width:"9",height:"7",x:"3",y:"14",rx:"1",key:"jqznyg"}],["rect",{width:"5",height:"7",x:"16",y:"14",rx:"1",key:"q5h2i8"}]],_s=Ye("LayoutTemplate",Ns);function ws(){return De({queryKey:["admin","products"],queryFn:()=>ce("get_products"),staleTime:300*1e3})}function Cs(){const n=Pe();return ke({mutationFn:p=>ce("create_product",void 0,p),onSuccess:()=>{n.invalidateQueries({queryKey:["admin","products"]})}})}function Te(){const n=Pe();return ke({mutationFn:({id:p,...D})=>ce("update_product",{id:p},D),onSuccess:()=>{n.invalidateQueries({queryKey:["admin","products"]})}})}function Fe(){return De({queryKey:["categories"],queryFn:async()=>{const{data:n,error:p}=await ne.from("categories").select("*").order("name",{ascending:!0});if(p)throw p;return n}})}function Le({value:n,onChange:p,label:D="Image",folder:P="general"}){const[f,q]=o.useState(!1),[F,W]=o.useState(!1),g=o.useRef(null),{toast:S}=ie(),j=async u=>{if(!u.type.startsWith("image/")){S({title:"Invalid file type",description:"Please select an image file.",variant:"destructive"});return}if(u.size>5*1024*1024){S({title:"File too large",description:"Please select an image under 5MB.",variant:"destructive"});return}q(!0);try{const r=u.name.split(".").pop(),O=`${P}/${Date.now()}-${Math.random().toString(36).substring(7)}.${r}`,{data:L,error:y}=await ne.storage.from("plan-product-images").upload(O,u);if(y)throw y;const{data:B}=ne.storage.from("plan-product-images").getPublicUrl(L.path);p(B.publicUrl),S({title:"Image uploaded",description:"Your image has been uploaded successfully."})}catch(r){console.error("Upload error:",r),S({title:"Upload failed",description:"Failed to upload image. Please try again.",variant:"destructive"})}finally{q(!1),g.current&&(g.current.value="")}},$=async u=>{const r=u.target.files?.[0];r&&await j(r)},a=u=>{u.preventDefault(),u.stopPropagation(),W(!0)},h=u=>{u.preventDefault(),u.stopPropagation(),W(!1)},k=async u=>{u.preventDefault(),u.stopPropagation(),W(!1);const r=u.dataTransfer.files?.[0];r&&await j(r)},T=()=>{p(null)};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:D}),e.jsxs("div",{className:"flex flex-col gap-3",children:[n?e.jsxs("div",{className:"relative w-full max-w-xs",children:[e.jsx("img",{src:n,alt:"Uploaded",className:"w-full h-32 object-cover rounded-lg border border-border"}),e.jsx(b,{type:"button",variant:"destructive",size:"icon",className:"absolute -top-2 -right-2 h-6 w-6",onClick:T,children:e.jsx(es,{className:"h-3 w-3"})})]}):e.jsx("div",{className:`w-full max-w-xs h-32 border-2 border-dashed rounded-lg flex flex-col items-center justify-center gap-2 cursor-pointer transition-colors ${F?"border-primary bg-primary/10":"border-border hover:border-primary/50"}`,onClick:()=>g.current?.click(),onDragOver:a,onDragLeave:h,onDrop:k,children:f?e.jsx(M,{className:"h-8 w-8 animate-spin text-muted-foreground"}):e.jsxs(e.Fragment,{children:[e.jsx(Ce,{className:"h-8 w-8 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground text-center px-2",children:F?"Drop file here":"Drop file here or click to upload"})]})}),e.jsx(x,{ref:g,type:"file",accept:"image/*",onChange:$,className:"hidden"}),n&&e.jsxs(b,{type:"button",variant:"outline",size:"sm",className:"w-fit",onClick:()=>g.current?.click(),disabled:f,children:[f?e.jsx(M,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Change Image"]})]})]})}function Ds({product:n,onSuccess:p,onCancel:D,onDelete:P}){const{toast:f}=ie(),q=Cs(),F=Te(),{data:W=[]}=Fe(),[g,S]=o.useState(""),[j,$]=o.useState(!1),[a,h]=o.useState({product_name:n?.product_name||"",product_sku:n?.product_sku||"",slug:n?.slug||"",short_description:n?.short_description||"",price:n?.price??"",billing_type:n?.billing_type||"one_time",url:n?.url||"",product_status:n?.product_status||"draft",full_description:n?.full_description||"",image_url:n?.image_url||null,category_id:n?.category_id||null,type:n?.type||"product"}),k=q.isPending||F.isPending,T=async r=>{r.preventDefault();const O={product_name:a.product_name,product_sku:a.product_sku||null,slug:a.slug||null,short_description:a.short_description||null,full_description:a.full_description||null,price:a.price,billing_type:a.billing_type,url:a.url||null,product_status:a.product_status,image_url:a.image_url,category_id:a.category_id,type:a.type};try{n?(await F.mutateAsync({id:n.id,...O}),f({title:"Product Updated",description:`${a.product_name} has been updated successfully.`})):(await q.mutateAsync(O),f({title:"Product Created",description:`${a.product_name} has been created successfully.`})),p()}catch{f({title:"Error",description:"Failed to save product. Please try again.",variant:"destructive"})}},u=()=>{if(console.log("=== DELETE CLICKED ==="),console.log("Product:",n?.id,n?.product_name),console.log("onDelete exists:",!!P),console.log("deleteConfirmText:",g),console.log("isDeleting:",j),!n)throw console.error("DELETE ABORT: No product"),new Error("No product to delete");if(!P)throw console.error("DELETE ABORT: onDelete handler missing"),new Error("onDelete handler is required but was not provided");if(g!=="Delete"){console.error("DELETE ABORT: Confirmation text mismatch");return}if(j){console.log("DELETE ABORT: Already deleting");return}console.log("=== CALLING onDelete ==="),$(!0),P(n.id,n.product_name).then(()=>{console.log("=== DELETE FINISHED (SUCCESS) ===")}).catch(r=>{console.error("=== DELETE FINISHED (FAILED) ===",r),f({title:"Delete Failed",description:"Could not delete product. Check console for details.",variant:"destructive"})}).finally(()=>{$(!1)})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"product_name",children:"Name"}),e.jsx(x,{id:"product_name",value:a.product_name,onChange:r=>h({...a,product_name:r.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"product_sku",children:"SKU"}),e.jsx(x,{id:"product_sku",value:a.product_sku,onChange:r=>h({...a,product_sku:r.target.value}),placeholder:"PROD-001"})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"slug",children:"Slug"}),e.jsx(x,{id:"slug",value:a.slug,onChange:r=>h({...a,slug:r.target.value}),placeholder:"my-product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"category",children:"Category"}),e.jsxs(N,{value:a.category_id||"none",onValueChange:r=>h({...a,category_id:r==="none"?null:r}),children:[e.jsx(_,{children:e.jsx(w,{placeholder:"Select category"})}),e.jsxs(C,{children:[e.jsx(c,{value:"none",children:"No Category"}),W.map(r=>e.jsx(c,{value:r.id,children:r.name},r.id))]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"short_description",children:"Description"}),e.jsx(V,{id:"short_description",value:a.short_description,onChange:r=>h({...a,short_description:r.target.value})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"price",children:"Price"}),e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{id:"price",type:"number",step:"0.01",value:a.price,onChange:r=>h({...a,price:r.target.value===""?"":parseFloat(r.target.value)||0}),placeholder:"0.00",className:"pl-9",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"billing_type",children:"Billing Type"}),e.jsxs(N,{value:a.billing_type,onValueChange:r=>h({...a,billing_type:r}),children:[e.jsx(_,{children:e.jsx(w,{})}),e.jsxs(C,{children:[e.jsx(c,{value:"one_time",children:"One-Time"}),e.jsx(c,{value:"monthly_subscription",children:"Monthly"}),e.jsx(c,{value:"annual_subscription",children:"Annual"}),e.jsx(c,{value:"subscription_with_minimum_commitment",children:"Subscription"}),e.jsx(c,{value:"usage_based",children:"Usage-Based"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"url",children:"Website URL"}),e.jsx(x,{id:"url",value:a.url,onChange:r=>h({...a,url:r.target.value}),placeholder:"/products/my-product"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"type",children:"Type"}),e.jsxs(N,{value:a.type,onValueChange:r=>h({...a,type:r}),children:[e.jsx(_,{children:e.jsx(w,{})}),e.jsxs(C,{children:[e.jsx(c,{value:"plan",children:"Plan"}),e.jsx(c,{value:"product",children:"Product"}),e.jsx(c,{value:"service",children:"Service"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"product_status",children:"Status"}),e.jsxs(N,{value:a.product_status,onValueChange:r=>h({...a,product_status:r}),children:[e.jsx(_,{children:e.jsx(w,{})}),e.jsxs(C,{children:[e.jsx(c,{value:"draft",children:"Draft"}),e.jsx(c,{value:"active",children:"Active"}),e.jsx(c,{value:"hidden",children:"Hidden"}),e.jsx(c,{value:"test",children:"Test"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"full_description",children:"Full Description"}),e.jsx(V,{id:"full_description",value:a.full_description,onChange:r=>h({...a,full_description:r.target.value}),rows:5,placeholder:"Detailed product description..."})]}),e.jsx(Le,{value:a.image_url,onChange:r=>h({...a,image_url:r}),label:"Product Image",folder:"products"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(b,{type:"button",variant:"outline",onClick:D,children:"Cancel"}),e.jsxs(b,{type:"submit",disabled:k,children:[k&&e.jsx(M,{className:"h-4 w-4 mr-2 animate-spin"}),n?"Update":"Create"]})]})]}),n&&P&&e.jsx("div",{className:"border-t pt-4 mt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-destructive font-medium",children:"Danger Zone"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Are you sure you want to delete this Product? This cannot be undone."}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{placeholder:'Type "Delete" to confirm',value:g,onChange:r=>S(r.target.value),className:"max-w-[200px]"}),e.jsxs("button",{type:"button",disabled:g!=="Delete"||j,className:"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-destructive text-destructive-foreground hover:bg-destructive/90 h-10 px-4 py-2",onClick:u,children:[j&&e.jsx(M,{className:"h-4 w-4 mr-2 animate-spin"}),"Delete Product"]})]})]})})]})}const le={name:180,sku:100,status:110,type:100,category:120,price:90,billing:100,url:160};function Gs(){const{toast:n}=ie(),{url:p}=ss(),D=o.useMemo(()=>new URLSearchParams(p.split("?")[1]??""),[p]),P=o.useCallback(s=>{const t=new URLSearchParams(s).toString();ts.visit(`/admin/plans${t?`?${t}`:""}`,{replace:!0,preserveState:!0,preserveScroll:!0})},[]),{data:f=[],isLoading:q}=ps(),{data:F=[],isLoading:W}=ws(),{data:g=[]}=Fe(),S=gs(),j=xs(),$=js(),a=Te(),h=q||W,k=s=>s&&g.find(l=>l.id===s)?.name||"—",T=o.useMemo(()=>{const s=f.map(l=>({id:l.id,name:l.name,sku:l.sku,status:l.status,type:l.type,category_id:l.category_id,price:l.price,billing:l.billing_period,url:l.slug?`/plans/${l.slug}`:null,source:"plan",originalData:l})),t=F.map(l=>({id:l.id,name:l.product_name,sku:l.product_sku,status:l.product_status,type:l.type,category_id:l.category_id,price:l.price,billing:l.billing_type.replace(/_/g," "),url:l.url,source:"product",originalData:l}));return[...s,...t]},[f,F]),[u,r]=o.useState(!1),[O,L]=o.useState(!1),[y,B]=o.useState(null),[Q,X]=o.useState(null),[Z,Ee]=o.useState("name"),[G,oe]=o.useState("asc"),[H,de]=o.useState(()=>D.get("search")||""),[J,Ae]=o.useState(le);o.useEffect(()=>{const s=D.get("search")||"";s!==H&&s&&de(s)},[D]);const Ue=s=>{de(s),P(s?{search:s}:{})},[K,ue]=o.useState(""),[he,me]=o.useState(!1),[i,v]=o.useState({name:"",slug:"",sku:"",description:"",price:"",billing_period:"monthly",url:"",features:"",status:"draft",display_order:"",image_url:null,category_id:null}),[Ie,pe]=o.useState(null),[ge,xe]=o.useState({}),Y=o.useRef(0),ee=o.useRef(0),m=s=>ge[s]!==void 0?ge[s]:J[s]||le[s]||150,Re=o.useCallback((s,t)=>{s.preventDefault(),s.stopPropagation(),pe(t),Y.current=s.clientX,ee.current=J[t]||le[t]||150;const l=te=>{const re=te.clientX-Y.current,ae=Math.max(50,ee.current+re);xe(z=>({...z,[t]:ae}))},ye=te=>{const re=te.clientX-Y.current,ae=Math.max(50,ee.current+re);Ae(z=>({...z,[t]:ae})),xe(z=>{const ve={...z};return delete ve[t],ve}),pe(null),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",ye)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",ye)},[J]),je=S.isPending||j.isPending||$.isPending,qe=()=>{v({name:"",slug:"",sku:"",description:"",price:"",billing_period:"monthly",url:"",features:"",status:"hidden",display_order:"",image_url:null,category_id:null}),B(null)},We=()=>{X(null),L(!0)},$e=s=>{if(s.source==="plan"){const t=s.originalData;B(t),v({name:t.name,slug:t.slug,sku:t.sku||"",description:t.description||"",price:t.price,billing_period:t.billing_period,url:t.url||"",features:Array.isArray(t.features)?t.features.join(`
`):"",status:t.status,display_order:t.display_order,image_url:t.image_url||null,category_id:t.category_id||null}),r(!0)}else X(s.originalData),L(!0)},Me=async s=>{s.preventDefault();const t={name:i.name,slug:i.slug,sku:i.sku||null,description:i.description||null,price:typeof i.price=="string"?parseFloat(i.price)||0:i.price,billing_period:i.billing_period,url:i.url||null,features:i.features.split(`
`).filter(l=>l.trim()),status:i.status,display_order:typeof i.display_order=="string"?parseInt(i.display_order)||0:i.display_order,image_url:i.image_url,category_id:i.category_id};try{y?await j.mutateAsync({id:y.id,...t}):await S.mutateAsync(t),n({title:y?"Plan Updated":"Plan Created",description:`${i.name} has been ${y?"updated":"created"} successfully.`}),r(!1),qe()}catch{n({title:"Error",description:"Failed to save plan. Please try again.",variant:"destructive"})}},Oe=async()=>{if(!(!y||K!=="Delete")){me(!0);try{await $.mutateAsync(y.id),n({title:"Plan Deleted",description:`${y.name} has been deleted.`}),r(!1),B(null),ue("")}catch{n({title:"Error",description:"Failed to delete plan. Please try again.",variant:"destructive"})}finally{me(!1)}}},Be=async(s,t)=>{try{s.source==="plan"?await j.mutateAsync({id:s.id,status:t}):await a.mutateAsync({id:s.id,product_status:t}),n({title:"Status Updated",description:`${s.name} status changed to ${t}.`})}catch{n({title:"Error",description:"Failed to update status. Please try again.",variant:"destructive"})}},He=async(s,t)=>{try{s.source==="plan"?await j.mutateAsync({id:s.id,category_id:t}):await a.mutateAsync({id:s.id,category_id:t}),n({title:"Category Updated",description:`${s.name} category changed.`})}catch{n({title:"Error",description:"Failed to update category. Please try again.",variant:"destructive"})}},ze=async(s,t)=>{try{s.source==="plan"?await j.mutateAsync({id:s.id,type:t}):await a.mutateAsync({id:s.id,type:t}),n({title:"Type Updated",description:`${s.name} type changed.`})}catch{n({title:"Error",description:"Failed to update type. Please try again.",variant:"destructive"})}},Ve=s=>s?{product:"Product",service:"Service"}[s]||s:"—",Qe=s=>({draft:"Draft",active:"Active",hidden:"Hidden",test:"Test"})[s]||s,Xe=s=>({monthly:"Monthly",quarterly:"Quarterly",annual:"Annual","one-time":"One-time","one time":"One-Time","monthly subscription":"Monthly","annual subscription":"Annual","subscription with minimum commitment":"Subscription","usage based":"Usage-Based"})[s.toLowerCase()]||s,Ze=e.jsxs("div",{className:"space-y-2 text-sm max-w-xs",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Draft"})," – Saved but not visible to customers. Not live or purchasable."]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Active"})," – Live on the website and available for purchase."]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Hidden"})," – Live and fully functional but not displayed on the website. Can be accessed via direct link or internal use."]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Test"})," – Used only for testing live payment flows. Not intended for real customer purchases."]})]}),E=s=>{Z===s?oe(G==="asc"?"desc":"asc"):(Ee(s),oe("asc"))},A=s=>Z!==s?e.jsx(vs,{className:"h-4 w-4 ml-1 opacity-50"}):G==="asc"?e.jsx(fs,{className:"h-4 w-4 ml-1"}):e.jsx(bs,{className:"h-4 w-4 ml-1"}),se=T.filter(s=>{if(!H.trim())return!0;const t=H.toLowerCase(),l=k(s.category_id).toLowerCase();return s.name.toLowerCase().includes(t)||s.sku&&s.sku.toLowerCase().includes(t)||s.billing.toLowerCase().includes(t)||s.status.toLowerCase().includes(t)||l.includes(t)||s.source.toLowerCase().includes(t)}),Ge=[...se].sort((s,t)=>{const l=G==="asc"?1:-1;switch(Z){case"name":return l*s.name.localeCompare(t.name);case"sku":return l*(s.sku||"").localeCompare(t.sku||"");case"status":return l*s.status.localeCompare(t.status);case"type":return l*(s.type||"").localeCompare(t.type||"");case"category":return l*k(s.category_id).localeCompare(k(t.category_id));case"price":return l*(s.price-t.price);case"billing":return l*s.billing.localeCompare(t.billing);case"url":return l*(s.url||"").localeCompare(t.url||"");default:return 0}}),Je=()=>{L(!1),X(null)},Ke=async(s,t)=>{},U=({column:s})=>e.jsx("div",{className:`absolute right-0 top-0 h-full w-1 cursor-col-resize hover:bg-primary/50 transition-colors ${Ie===s?"bg-primary":"bg-transparent"}`,onMouseDown:t=>Re(t,s)});return e.jsxs(e.Fragment,{children:[e.jsx(rs,{children:e.jsx("title",{children:"Products | Admin"})}),e.jsxs("div",{className:"flex flex-col h-[calc(100vh-64px)] overflow-hidden",children:[e.jsx("div",{className:"flex-shrink-0 p-6 pb-4 space-y-4 bg-background",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Products"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[T.length," total products"]})]}),e.jsx("div",{className:"flex items-center gap-1 border-l pl-6",children:e.jsx(b,{variant:"secondary",size:"sm",className:"text-sm",children:"All"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(as,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Search products...",value:H,onChange:s=>Ue(s.target.value),className:"pl-9 w-64"})]}),e.jsx(b,{asChild:!0,variant:"outline",children:e.jsxs(ls,{href:"/admin/product-template",children:[e.jsx(_s,{className:"h-4 w-4 mr-2"}),"View Template"]})}),e.jsxs(b,{onClick:We,children:[e.jsx(ns,{className:"h-4 w-4 mr-2"}),"Add Product"]})]})]})}),e.jsx(fe,{open:u,onOpenChange:r,children:e.jsxs(be,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsx(Ne,{children:e.jsx(_e,{children:y?"Edit Plan":"Create New Plan"})}),e.jsxs("form",{onSubmit:Me,className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"name",children:"Name"}),e.jsx(x,{id:"name",value:i.name,onChange:s=>v({...i,name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"slug",children:"Slug"}),e.jsx(x,{id:"slug",value:i.slug,onChange:s=>v({...i,slug:s.target.value}),placeholder:"unique-identifier",required:!0})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"sku",children:"SKU"}),e.jsx(x,{id:"sku",value:i.sku,onChange:s=>v({...i,sku:s.target.value}),placeholder:"PLAN-001"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"category",children:"Category"}),e.jsxs(N,{value:i.category_id||"none",onValueChange:s=>v({...i,category_id:s==="none"?null:s}),children:[e.jsx(_,{children:e.jsx(w,{placeholder:"Select category"})}),e.jsxs(C,{children:[e.jsx(c,{value:"none",children:"No Category"}),g.map(s=>e.jsx(c,{value:s.id,children:s.name},s.id))]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"description",children:"Description"}),e.jsx(V,{id:"description",value:i.description,onChange:s=>v({...i,description:s.target.value})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"price",children:"Price"}),e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{id:"price",type:"number",step:"0.01",value:i.price,onChange:s=>v({...i,price:s.target.value}),placeholder:"0.00",className:"pl-9",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"billing_period",children:"Billing Period"}),e.jsxs(N,{value:i.billing_period,onValueChange:s=>v({...i,billing_period:s}),children:[e.jsx(_,{children:e.jsx(w,{})}),e.jsxs(C,{children:[e.jsx(c,{value:"monthly",children:"Monthly"}),e.jsx(c,{value:"quarterly",children:"Quarterly"}),e.jsx(c,{value:"annual",children:"Annual"}),e.jsx(c,{value:"one-time",children:"One-time"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"url",children:"Website URL"}),e.jsx(x,{id:"url",value:i.url,onChange:s=>v({...i,url:s.target.value}),placeholder:"/plans/essentials"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"status",children:"Status"}),e.jsxs(N,{value:i.status,onValueChange:s=>v({...i,status:s}),children:[e.jsx(_,{children:e.jsx(w,{})}),e.jsxs(C,{children:[e.jsx(c,{value:"draft",children:"Draft"}),e.jsx(c,{value:"active",children:"Active"}),e.jsx(c,{value:"hidden",children:"Hidden"}),e.jsx(c,{value:"test",children:"Test"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"features",children:"Features (one per line)"}),e.jsx(V,{id:"features",value:i.features,onChange:s=>v({...i,features:s.target.value}),rows:5,placeholder:`Feature 1
Feature 2
Feature 3`})]}),e.jsx(Le,{value:i.image_url,onChange:s=>v({...i,image_url:s}),label:"Plan Image",folder:"plans"}),y&&e.jsx("div",{className:"border-t pt-4 mt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-destructive font-medium",children:"Danger Zone"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Are you sure you want to delete this Plan? This cannot be undone."}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x,{placeholder:'Type "Delete" to confirm',value:K,onChange:s=>ue(s.target.value),className:"max-w-[200px]"}),e.jsxs(b,{type:"button",variant:"destructive",disabled:K!=="Delete"||he,onClick:Oe,children:[he&&e.jsx(M,{className:"h-4 w-4 mr-2 animate-spin"}),"Delete Plan"]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>r(!1),children:"Cancel"}),e.jsxs(b,{type:"submit",disabled:je,children:[je&&e.jsx(M,{className:"h-4 w-4 mr-2 animate-spin"}),y?"Update":"Create"]})]})]})]})}),e.jsx(fe,{open:O,onOpenChange:L,children:e.jsxs(be,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsx(Ne,{children:e.jsx(_e,{children:Q?"Edit Product":"Create New Product"})}),e.jsx(Ds,{product:Q,onSuccess:Je,onCancel:()=>L(!1),onDelete:Q?Ke:void 0})]})}),e.jsx("div",{className:"flex-1 overflow-hidden px-6",children:e.jsx("div",{className:"border rounded-lg h-full overflow-auto",children:h&&T.length===0?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(M,{className:"h-8 w-8 animate-spin text-primary"})}):se.length===0&&H?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No items match your search."}):T.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:'No items yet. Click "Add Product" to get started.'}):e.jsxs(us,{children:[e.jsx(hs,{children:e.jsxs(we,{children:[e.jsxs(I,{className:"relative group sticky top-0 bg-background z-10",style:{width:m("name"),minWidth:100},children:[e.jsxs("button",{className:"flex items-center hover:text-foreground transition-colors",onClick:()=>E("name"),children:["Name ",A("name")]}),e.jsx(U,{column:"name"})]}),e.jsxs(I,{className:"relative group",style:{width:m("sku"),minWidth:80},children:[e.jsxs("button",{className:"flex items-center hover:text-foreground transition-colors",onClick:()=>E("sku"),children:["SKU ",A("sku")]}),e.jsx(U,{column:"sku"})]}),e.jsxs(I,{className:"relative group",style:{width:m("status"),minWidth:100},children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("button",{className:"flex items-center hover:text-foreground transition-colors",onClick:()=>E("status"),children:["Status ",A("status")]}),e.jsx(is,{children:e.jsxs(cs,{children:[e.jsx(os,{asChild:!0,children:e.jsx(ys,{className:"h-4 w-4 text-muted-foreground hover:text-foreground cursor-help"})}),e.jsx(ds,{side:"top",className:"max-w-sm",children:Ze})]})})]}),e.jsx(U,{column:"status"})]}),e.jsxs(I,{className:"relative group",style:{width:m("type"),minWidth:90},children:[e.jsxs("button",{className:"flex items-center hover:text-foreground transition-colors",onClick:()=>E("type"),children:["Type ",A("type")]}),e.jsx(U,{column:"type"})]}),e.jsxs(I,{className:"relative group",style:{width:m("category"),minWidth:100},children:[e.jsxs("button",{className:"flex items-center hover:text-foreground transition-colors",onClick:()=>E("category"),children:["Category ",A("category")]}),e.jsx(U,{column:"category"})]}),e.jsxs(I,{className:"relative group",style:{width:m("price"),minWidth:80},children:[e.jsxs("button",{className:"flex items-center hover:text-foreground transition-colors",onClick:()=>E("price"),children:["Price ",A("price")]}),e.jsx(U,{column:"price"})]}),e.jsxs(I,{className:"relative group",style:{width:m("billing"),minWidth:100},children:[e.jsxs("button",{className:"flex items-center hover:text-foreground transition-colors",onClick:()=>E("billing"),children:["Billing ",A("billing")]}),e.jsx(U,{column:"billing"})]}),e.jsxs(I,{className:"relative group",style:{width:m("url"),minWidth:120},children:[e.jsxs("button",{className:"flex items-center hover:text-foreground transition-colors",onClick:()=>E("url"),children:["Website URL ",A("url")]}),e.jsx(U,{column:"url"})]})]})}),e.jsx(ms,{children:Ge.map(s=>e.jsxs(we,{children:[e.jsx(R,{style:{width:m("name")},children:e.jsx("button",{className:"font-medium text-left hover:text-primary hover:underline transition-colors",onClick:()=>$e(s),children:s.name})}),e.jsx(R,{className:"text-muted-foreground",style:{width:m("sku")},children:s.sku||"—"}),e.jsx(R,{style:{width:m("status")},children:e.jsxs(N,{value:s.status,onValueChange:t=>Be(s,t),children:[e.jsx(_,{className:"w-[100px] h-8",children:e.jsx(w,{children:Qe(s.status)})}),e.jsxs(C,{children:[e.jsx(c,{value:"draft",children:"Draft"}),e.jsx(c,{value:"active",children:"Active"}),e.jsx(c,{value:"hidden",children:"Hidden"}),e.jsx(c,{value:"test",children:"Test"})]})]})}),e.jsx(R,{style:{width:m("type")},children:e.jsxs(N,{value:s.type||"none",onValueChange:t=>ze(s,t==="none"?null:t),children:[e.jsx(_,{className:"w-[90px] h-8",children:e.jsx(w,{children:Ve(s.type)})}),e.jsxs(C,{children:[e.jsx(c,{value:"none",children:"—"}),e.jsx(c,{value:"product",children:"Product"}),e.jsx(c,{value:"service",children:"Service"})]})]})}),e.jsx(R,{style:{width:m("category")},children:e.jsxs(N,{value:s.category_id||"none",onValueChange:t=>He(s,t==="none"?null:t),children:[e.jsx(_,{className:"w-[110px] h-8",children:e.jsx(w,{children:k(s.category_id)})}),e.jsxs(C,{children:[e.jsx(c,{value:"none",children:"—"}),g.map(t=>e.jsx(c,{value:t.id,children:t.name},t.id))]})]})}),e.jsxs(R,{style:{width:m("price")},children:["$",s.price.toLocaleString()]}),e.jsx(R,{className:"capitalize",style:{width:m("billing")},children:Xe(s.billing)}),e.jsx(R,{style:{width:m("url")},children:s.url?e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline truncate block max-w-[160px]",children:s.url}):"—"})]},`${s.source}-${s.id}`))})]})})}),e.jsx("div",{className:"flex-shrink-0 px-6 py-4 bg-background border-t",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Showing ",se.length," of ",T.length," products"]})})})})]})]})}export{Gs as default};
