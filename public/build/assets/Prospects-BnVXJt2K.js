import{r as c,a as Oe,s as ve,j as e,p as K,n as ce,X as Ne,g as oe,B as T,U as Le,C as Fe,H as Me,I as Ie}from"./app-Ce4dIZFB.js";import{I as A}from"./input-Ck65_zG1.js";import{u as Re,S as Ue,a as ze}from"./SaveViewDialog-BbhHJurT.js";import{c as Be}from"./admin-api-C_7TBYZU.js";import{S as He}from"./switch-B4qgPMvb.js";import{S as de,a as ue,b as me,c as he,d as B}from"./select-B_YrNYUx.js";import{T as Je}from"./textarea-C7BHIkU1.js";import{f as Xe}from"./phone-input-D9l_zW-h.js";import{f as ye}from"./errorMessages-9RXyVjba.js";import{C as j}from"./CenteredDash-CoYbgBDC.js";import{G as Ge}from"./grip-vertical-BQCDSvF5.js";import{C as Ye}from"./check-B6cWYwLG.js";import{A as qe,a as Qe}from"./arrow-up-l3clcINa.js";import{A as Ze}from"./arrow-down-BSBfaw8J.js";import{L as E}from"./label-QfJu9XvN.js";import{S as Ke}from"./scroll-area-DmGKFs8l.js";import{V as et,p as tt,b as Se,U as st}from"./contact-DOVP-MxH.js";import{C as _e,a as ke}from"./card-adEYQJfr.js";import{T as at}from"./trending-up-Dxs1uZgs.js";import{S as rt,a as nt,b as lt,c as it}from"./sheet-D0Jb1F1E.js";import{P as Pe,a as Te,b as De}from"./popover-B8zNM3AK.js";import{P as ot,a as ct,b as we,c as dt,d as ut,e as mt}from"./pagination-eXo_NiKx.js";import{F as ht}from"./filter-CxDpjXo9.js";import{S as xt}from"./settings-2-xrcQjJZS.js";import{U as pt}from"./user-plus-LYV0KU0B.js";/* empty css            */import"./dialog-B7SUd-9S.js";import"./index-CnNtUvTF.js";import"./Combination-PdYEIAXI.js";import"./checkbox-C1P8t78S.js";import"./index-CFzD5U6q.js";import"./index-yuBTQaZo.js";import"./index-BdQq_4o_.js";import"./index-B1d3PRdL.js";import"./chevron-up-TKJMd5rw.js";import"./index-DB7rwMQy.js";import"./separator-CDwdzzip.js";import"./index-C1-Y4VPz.js";import"./rotate-ccw-DpLFNu_R.js";import"./star-ClButd2R.js";import"./eye-off-Dopg9dsK.js";import"./eye-7FHfmGld.js";import"./alert-dialog-DZmWaCFN.js";import"./useAutoSave-C2o7u3g9.js";import"./user-DupxOlzc.js";import"./phone-DK7B23s9.js";import"./building-2-6_r0c7In.js";import"./target-GdEokezj.js";import"./tag-Pg1UBPa5.js";const gt=["name","email","phone","company","services","status","sales_rep","partner_name","lead_source","last_meeting","last_outreach","next_outreach","next_meeting","est_closing_date","estimated_value","sdr_set","notes","tags"];function ft(){return Re({tableName:"prospect_view_preferences",defaultColumnOrder:gt,defaultSortColumn:"name",defaultSortDirection:"asc"})}function bt(t){const[d,p]=c.useState([]),[l,x]=c.useState(0),[y,C]=c.useState(0),[S,i]=c.useState(!0),[o,u]=c.useState(null),[m,f]=c.useState(null),{toast:_}=Oe(),v=c.useCallback(async()=>{i(!0),u(null);try{const g=await Be("get_prospects",{page:t.page.toString(),limit:t.limit.toString(),sortColumn:t.sortColumn,sortDirection:t.sortDirection,search:t.search,filters:JSON.stringify(t.filters),includeSummary:"true"});p(g.prospects||[]),x(g.total||0),C(g.totalPages||0),f(g.summary||null)}catch(g){const D=g instanceof Error?g.message:"Failed to fetch prospects";u(D),_({title:"Error",description:D,variant:"destructive"})}finally{i(!1)}},[t.page,t.limit,t.sortColumn,t.sortDirection,t.search,t.filters,_]);return c.useEffect(()=>{v()},[v]),{prospects:d,total:l,totalPages:y,loading:S,error:o,summary:m,refetch:v}}function We(){const[t,d]=c.useState(!1),[p,l]=c.useState(!1),{toast:x}=Oe();return{updateProspect:async(i,o)=>{d(!0);try{const{data:{session:u}}=await ve.auth.getSession();if(!u)return x({title:"Error",description:"Not authenticated",variant:"destructive"}),null;const m=await fetch("undefined/functions/v1/update-prospect",{method:"POST",headers:{Authorization:`Bearer ${u.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({id:i,updates:o})});if(!m.ok){const _=await m.json();throw new Error(_.error||"Failed to update prospect")}const f=await m.json();return x({title:"Success",description:"Prospect updated successfully"}),f.prospect}catch(u){const m=u instanceof Error?u.message:"Failed to update prospect",f=ye(m,"prospect");return x({title:"Error",description:f,variant:"destructive"}),null}finally{d(!1)}},createProspect:async i=>{d(!0);try{const{data:{session:o}}=await ve.auth.getSession();if(!o)return x({title:"Error",description:"Not authenticated",variant:"destructive"}),null;const u=await fetch("undefined/functions/v1/create-prospect",{method:"POST",headers:{Authorization:`Bearer ${o.access_token}`,"Content-Type":"application/json"},body:JSON.stringify(i)});if(!u.ok){const f=await u.json();throw new Error(f.error||"Failed to create prospect")}const m=await u.json();return x({title:"Success",description:"Prospect created successfully"}),m.prospect}catch(o){const u=o instanceof Error?o.message:"Failed to create prospect",m=ye(u,"prospect");return x({title:"Error",description:m,variant:"destructive"}),null}finally{d(!1)}},deleteProspect:async i=>{l(!0);try{const{data:{session:o}}=await ve.auth.getSession();if(!o)return x({title:"Error",description:"Not authenticated",variant:"destructive"}),!1;const u=await fetch("undefined/functions/v1/delete-prospect",{method:"POST",headers:{Authorization:`Bearer ${o.access_token}`,"Content-Type":"application/json"},body:JSON.stringify({id:i})});if(!u.ok){const m=await u.json();throw new Error(m.error||"Failed to delete prospect")}return x({title:"Success",description:"Prospect deleted successfully"}),!0}catch(o){const u=o instanceof Error?o.message:"Failed to delete prospect";return x({title:"Error",description:u,variant:"destructive"}),!1}finally{l(!1)}},updating:t,deleting:p}}const jt=[{value:"website_form",label:"Website Form"},{value:"cold",label:"Aware"},{value:"warm",label:"Interested"},{value:"hot",label:"Committed"}],$={name:{key:"name",label:"Name",sortable:!0,minWidth:120,defaultWidth:180,editable:!0,editType:"text"},email:{key:"email",label:"Email",sortable:!0,minWidth:150,defaultWidth:220,editable:!0,editType:"email"},phone:{key:"phone",label:"Phone",sortable:!0,minWidth:150,defaultWidth:180,centered:!0,editable:!0,editType:"tel",render:t=>Xe(t.phone)||e.jsx(j,{})},company:{key:"company",label:"Company",sortable:!0,minWidth:120,defaultWidth:150,editable:!0,editType:"text",render:t=>t.company||e.jsx(j,{})},services:{key:"services",label:"Services",sortable:!0,minWidth:120,defaultWidth:150,centered:!0,editable:!0,editType:"text",render:t=>t.services||e.jsx(j,{})},status:{key:"status",label:"Status",sortable:!0,minWidth:80,defaultWidth:120,centered:!0,editable:!0,editType:"select",selectOptions:jt,render:t=>{const d=t.status||"cold",p={website_form:"Website Form",cold:"Aware",warm:"Interested",hot:"Committed"},l=x=>{switch(x){case"hot":return"bg-green-100 text-green-800 border-green-300 dark:bg-green-900/30 dark:text-green-400 dark:border-green-800";case"warm":return"bg-amber-100 text-amber-800 border-amber-300 dark:bg-amber-900/30 dark:text-amber-400 dark:border-amber-800";case"cold":return"bg-sky-100 text-sky-800 border-sky-300 dark:bg-sky-900/30 dark:text-sky-400 dark:border-sky-800";default:return"bg-muted text-muted-foreground border-border"}};return e.jsx(oe,{variant:"outline",className:l(d),children:p[d]||d})}},sales_rep:{key:"sales_rep",label:"Sales",sortable:!0,minWidth:100,defaultWidth:130,editable:!0,editType:"text",render:t=>t.sales_rep||e.jsx(j,{})},partner_name:{key:"partner_name",label:"Partner",sortable:!0,minWidth:100,defaultWidth:130,editable:!0,editType:"text",render:t=>t.partner_name||e.jsx(j,{})},tags:{key:"tags",label:"Tags",sortable:!1,minWidth:120,defaultWidth:180,editable:!1,render:t=>!t.tags||t.tags.length===0?e.jsx(j,{}):e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[t.tags.slice(0,3).map(d=>e.jsx(oe,{variant:"outline",className:"text-xs",children:d},d)),t.tags.length>3&&e.jsxs(oe,{variant:"outline",className:"text-xs",children:["+",t.tags.length-3]})]})},lead_source:{key:"lead_source",label:"Source",sortable:!0,minWidth:100,defaultWidth:130,editable:!0,editType:"text",render:t=>t.lead_source||e.jsx(j,{})},interested_plan:{key:"interested_plan",label:"Interested Plan",sortable:!0,minWidth:100,defaultWidth:150,editable:!0,editType:"text",render:t=>t.interested_plan||e.jsx(j,{})},last_meeting:{key:"last_meeting",label:"Last Meeting",sortable:!0,minWidth:100,defaultWidth:130,centered:!0,editable:!0,editType:"date",render:t=>t.last_meeting?K(t.last_meeting):e.jsx(j,{})},last_outreach:{key:"last_outreach",label:"Last Outreach",sortable:!0,minWidth:100,defaultWidth:130,centered:!0,editable:!0,editType:"date",render:t=>t.last_outreach?K(t.last_outreach):e.jsx(j,{})},next_outreach:{key:"next_outreach",label:"Next Outreach",sortable:!0,minWidth:100,defaultWidth:130,editable:!0,editType:"date",render:t=>t.next_outreach?K(t.next_outreach):e.jsx(j,{})},next_meeting:{key:"next_meeting",label:"Next Meeting",sortable:!0,minWidth:100,defaultWidth:130,centered:!0,editable:!0,editType:"date",render:t=>t.next_meeting?K(t.next_meeting):e.jsx(j,{})},est_closing_date:{key:"est_closing_date",label:"Est Closing",sortable:!0,minWidth:100,defaultWidth:130,centered:!0,editable:!0,editType:"date",render:t=>t.est_closing_date?K(t.est_closing_date):e.jsx(j,{})},estimated_value:{key:"estimated_value",label:"Est Amount",sortable:!0,minWidth:100,defaultWidth:130,centered:!0,editable:!0,editType:"number",render:t=>t.estimated_value?`$${t.estimated_value.toLocaleString()}`:e.jsx(j,{})},sdr_set:{key:"sdr_set",label:"SDR Set",sortable:!0,minWidth:80,defaultWidth:100,centered:!0,editable:!0,editType:"toggle"},notes:{key:"notes",label:"Notes",sortable:!1,minWidth:150,defaultWidth:200,editable:!0,editType:"textarea",render:t=>t.notes?e.jsx("span",{className:"line-clamp-2 text-xs",children:t.notes}):e.jsx(j,{})}};function vt({prospects:t,loading:d,columnOrder:p,hiddenColumns:l,columnWidths:x,sortColumn:y,sortDirection:C,onSort:S,onProspectClick:i,onColumnResize:o,onColumnReorder:u,onProspectUpdated:m}){const f=p.filter(s=>!l.includes(s)&&$[s]),[_,v]=c.useState(null),[g,D]=c.useState({}),H=c.useRef(0),I=c.useRef(0),[k,R]=c.useState(null),[J,L]=c.useState(null),[F,U]=c.useState(null),[P,O]=c.useState(""),{updateProspect:X,updating:z}=We(),[ee,G]=c.useState({});c.useEffect(()=>{G({})},[t]);const Y=(s,a)=>ee[s.id]?.[a]!==void 0?ee[s.id][a]:s[a],te=s=>g[s]!==void 0?g[s]:x[s]||$[s]?.defaultWidth||150,xe=c.useCallback((s,a)=>{s.preventDefault(),s.stopPropagation(),v(a),H.current=s.clientX,I.current=x[a]||$[a]?.defaultWidth||150;const r=h=>{const w=h.clientX-H.current,W=Math.max(20,I.current+w);D(N=>({...N,[a]:W}))},n=h=>{const w=h.clientX-H.current,W=Math.max(20,I.current+w);o(a,W),D(N=>{const ie={...N};return delete ie[a],ie}),v(null),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",n)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",n)},[x,o]),q=c.useCallback((s,a)=>{R(a),s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("text/plain",a)},[]),M=c.useCallback((s,a)=>{s.preventDefault(),s.dataTransfer.dropEffect="move",k&&a!==k&&L(a)},[k]),se=c.useCallback(()=>{L(null)},[]),pe=c.useCallback((s,a)=>{if(s.preventDefault(),!k||k===a){R(null),L(null);return}const r=[...p],n=r.indexOf(k),h=r.indexOf(a);n!==-1&&h!==-1&&(r.splice(n,1),r.splice(h,0,k),u(r)),R(null),L(null)},[k,p,u]),ae=c.useCallback(()=>{R(null),L(null)},[]),ge=(s,a,r)=>{if($[a]?.editType==="date"&&r){const h=new Date(r);O(h.toISOString().split("T")[0])}else O(r?.toString()||"");U({prospectId:s,field:a})},Q=()=>{U(null),O("")},re=async(s,a)=>{if(z)return;const r=$[a];let n=P||null;r?.editType==="number"&&P&&(n=parseFloat(P)),await X(s,{[a]:n})&&(U(null),O(""),m?.())},fe=async(s,a,r)=>{G(n=>({...n,[s]:{...n[s],[a]:r}})),await X(s,{[a]:r})},ne=async(s,a,r)=>{G(n=>({...n,[s]:{...n[s],[a]:r}})),await X(s,{[a]:r||null})},le=(s,a,r)=>{s.key==="Enter"&&$[r]?.editType!=="textarea"?(s.preventDefault(),re(a,r)):s.key==="Escape"&&Q()},be=({column:s})=>y!==s?e.jsx(qe,{className:"h-4 w-4 ml-1 opacity-50 flex-shrink-0"}):C==="asc"?e.jsx(Qe,{className:"h-4 w-4 ml-1 flex-shrink-0"}):e.jsx(Ze,{className:"h-4 w-4 ml-1 flex-shrink-0"});return d&&t.length===0?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ce,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):!d&&t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:[e.jsx("p",{children:"No prospects found"}),e.jsx("p",{className:"text-sm",children:"Try adjusting your search or filters"})]}):e.jsxs("div",{className:"relative",children:[d&&e.jsx("div",{className:"absolute inset-0 bg-background/50 flex items-center justify-center z-20",children:e.jsx(ce,{className:"h-6 w-6 animate-spin text-primary"})}),e.jsxs("table",{style:{tableLayout:"fixed",width:"max-content",minWidth:"100%"},className:"w-full caption-bottom text-sm",children:[e.jsx("thead",{className:"[&_tr]:border-b",children:e.jsx("tr",{className:"border-b transition-colors bg-background",children:f.map((s,a)=>{const r=$[s],n=te(s),h=k===s,w=J===s,W=a===0;return e.jsxs("th",{className:`h-12 px-4 text-left align-middle font-medium text-muted-foreground bg-background relative group transition-all sticky top-0 ${h?"opacity-50":""} ${w?"bg-primary/10 border-l-2 border-primary":""} ${W?"left-0 z-30 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]":"z-20"}`,style:{width:`${n}px`,minWidth:"20px"},draggable:!0,onDragStart:N=>q(N,s),onDragOver:N=>M(N,s),onDragLeave:se,onDrop:N=>pe(N,s),onDragEnd:ae,children:[e.jsxs("div",{className:`flex items-start pr-3 ${r.sortable?"cursor-pointer select-none hover:text-foreground":""}`,onClick:()=>r.sortable&&S(s),children:[e.jsx(Ge,{className:"h-4 w-4 mr-1 opacity-30 group-hover:opacity-70 cursor-grab flex-shrink-0 mt-0.5"}),e.jsx("span",{style:{wordBreak:"keep-all",overflowWrap:"normal",whiteSpace:"normal"},children:r.label}),r.headerExtra,r.sortable&&e.jsx(be,{column:s})]}),e.jsx("div",{className:`absolute right-0 top-0 h-full w-1 cursor-col-resize hover:bg-primary/50 transition-colors ${_===s?"bg-primary":"bg-transparent group-hover:bg-border"}`,onMouseDown:N=>xe(N,s)})]},s)})})}),e.jsx("tbody",{className:"[&_tr:last-child]:border-0",children:t.map(s=>e.jsx("tr",{className:"border-b transition-colors hover:bg-muted/50 align-top",children:f.map((a,r)=>{const n=$[a],h=a==="name",w=te(a),W=n.editable===!0,N=F?.prospectId===s.id&&F?.field===a,ie=r===0,je=new Date(new Date().toDateString()),Ve=a==="last_outreach"&&!s.last_outreach,Ee=a==="next_outreach"&&(!s.next_outreach||new Date(s.next_outreach)<je),$e=a==="next_meeting"&&(!s.next_meeting||new Date(s.next_meeting)<je),Ae=a==="est_closing_date"&&(!s.est_closing_date||new Date(s.est_closing_date)<je),Ce=Ve||Ee||$e||Ae,Z=ie?"sticky left-0 z-10 bg-background shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]":"";if(n.editType==="toggle"){const V=Y(s,a);return e.jsx("td",{className:`p-4 align-middle ${Z}`,style:{width:`${w}px`,maxWidth:`${w}px`},children:e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(He,{checked:V===!0,onCheckedChange:b=>fe(s.id,a,b),disabled:z,className:"h-4 w-7 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input [&>span]:h-3 [&>span]:w-3 [&>span]:data-[state=checked]:translate-x-3"})})},a)}if(n.editType==="select"&&n.selectOptions){const V=Y(s,a);return e.jsx("td",{className:`p-2 align-middle ${Z}`,style:{width:`${w}px`,maxWidth:`${w}px`},children:e.jsx("div",{className:"flex justify-center items-center",children:e.jsxs(de,{value:V||"cold",onValueChange:b=>ne(s.id,a,b),disabled:z,children:[e.jsx(ue,{className:"h-8 w-full",children:e.jsx(me,{})}),e.jsx(he,{children:n.selectOptions.map(b=>e.jsx(B,{value:b.value,children:b.label},b.value))})]})})},a)}if(N&&W){const V=n.editType==="number"?"number":n.editType==="date"?"date":n.editType==="email"?"email":n.editType==="tel"?"tel":"text";return e.jsx("td",{className:`p-1 align-middle ${Z}`,style:{width:`${w}px`,maxWidth:`${w}px`},children:e.jsxs("div",{className:"flex items-center gap-1",children:[n.editType==="textarea"?e.jsx(Je,{value:P,onChange:b=>O(b.target.value),onKeyDown:b=>{b.key==="Escape"&&Q()},className:"min-h-[60px] text-sm",autoFocus:!0,placeholder:"Enter notes"}):e.jsx(A,{type:V,value:P,onChange:b=>O(b.target.value),onKeyDown:b=>le(b,s.id,a),className:"h-8 text-sm",autoFocus:!0,step:n.editType==="number"?"0.01":void 0}),e.jsx("button",{onClick:()=>re(s.id,a),className:"p-1 hover:bg-primary/10 rounded",disabled:z,children:e.jsx(Ye,{className:"h-4 w-4 text-green-600"})}),e.jsx("button",{onClick:Q,className:"p-1 hover:bg-destructive/10 rounded",children:e.jsx(Ne,{className:"h-4 w-4 text-destructive"})})]})},a)}if(W){const V=s[a],b=n.render?n.render(s):V?.toString()||e.jsx(j,{});return e.jsx("td",{onClick:()=>{h?i(s):ge(s.id,a,V)},className:`p-4 align-middle break-words align-top cursor-pointer hover:bg-primary/5 transition-colors ${h?"font-medium text-primary hover:underline":""} ${n.centered?"text-center":""} ${Z}`,style:{width:`${w}px`,maxWidth:`${w}px`,wordBreak:"break-word",backgroundColor:Ce?"hsla(0, 60%, 75%, 0.3)":void 0},title:h?"Click to view details":"Click to edit",children:n.centered?e.jsx("div",{className:"flex justify-center items-center",children:b}):b},a)}return e.jsx("td",{onClick:()=>h&&i(s),className:`p-4 align-middle break-words align-top ${h?"font-medium text-primary hover:underline cursor-pointer":""} ${n.centered?"text-center":""} ${Z}`,style:{width:`${w}px`,maxWidth:`${w}px`,wordBreak:"break-word",backgroundColor:Ce?"hsla(0, 60%, 75%, 0.3)":void 0},children:n.centered?e.jsx("div",{className:"flex justify-center items-center",children:n.render?n.render(s):s[a]||e.jsx(j,{})}):n.render?n.render(s):s[a]||e.jsx(j,{})},a)})},s.id))})]})]})}const wt=[{value:"all",label:"All"},{value:"cold",label:"Cold"},{value:"warm",label:"Warm"},{value:"hot",label:"Hot"}],Nt=[{value:"all",label:"All"},{value:"true",label:"Yes"},{value:"false",label:"No"}];function Ct({activeFilters:t,onFilterChange:d,onClearFilters:p}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium",children:"Filters"}),e.jsxs(T,{variant:"ghost",size:"sm",onClick:p,children:[e.jsx(Ne,{className:"h-3 w-3 mr-1"}),"Clear all"]})]}),e.jsx(Ke,{className:"h-[300px] pr-3",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{className:"text-xs",children:"Status"}),e.jsxs(de,{value:t.status||"all",onValueChange:l=>d("status",l==="all"?"":l),children:[e.jsx(ue,{children:e.jsx(me,{placeholder:"Select status"})}),e.jsx(he,{children:wt.map(l=>e.jsx(B,{value:l.value,children:l.label},l.value))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{className:"text-xs",children:"Company"}),e.jsx(A,{placeholder:"Filter by company...",value:t.company||"",onChange:l=>d("company",l.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{className:"text-xs",children:"Services"}),e.jsx(A,{placeholder:"Filter by services...",value:t.services||"",onChange:l=>d("services",l.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{className:"text-xs",children:"Source"}),e.jsx(A,{placeholder:"Filter by source...",value:t.lead_source||"",onChange:l=>d("lead_source",l.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{className:"text-xs",children:"Sales"}),e.jsx(A,{placeholder:"Filter by sales...",value:t.sales_rep||"",onChange:l=>d("sales_rep",l.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{className:"text-xs",children:"Partner"}),e.jsx(A,{placeholder:"Filter by partner...",value:t.partner_name||"",onChange:l=>d("partner_name",l.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{className:"text-xs",children:"Tag"}),e.jsx(A,{placeholder:"Filter by tag...",value:t.tags||"",onChange:l=>d("tags",l.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(E,{className:"text-xs",children:"SDR Set"}),e.jsxs(de,{value:t.sdr_set||"all",onValueChange:l=>d("sdr_set",l==="all"?"":l),children:[e.jsx(ue,{children:e.jsx(me,{placeholder:"Select SDR Set"})}),e.jsx(he,{children:Nt.map(l=>e.jsx(B,{value:l.value,children:l.label},l.value))})]})]})]})})]})}const yt={name:"Prospect Name",email:"Email",phone:"Phone",company:"Company",services:"Services",status:"Status",interested_plan:"Interested Plan",estimated_value:"Est. Value",lead_source:"Lead Source",last_activity:"Last Activity",last_contact:"Last Contact",last_meeting:"Last Meeting",last_outreach:"Last Outreach",next_outreach:"Next Outreach",next_meeting:"Next Meeting",est_closing_date:"Est. Closing",sdr_set:"SDR Set",sales_rep:"Sales",partner_name:"Partner",tags:"Tags",notes:"Notes"};function St(t){return e.jsx(et,{columnOrder:t.columnOrder,hiddenColumns:t.hiddenColumns,savedViews:t.savedViews,activeViewName:t.activeViewName,defaultViewName:t.defaultViewName??null,columnLabels:yt,onColumnOrderChange:t.onColumnOrderChange,onToggleColumn:t.onToggleColumn,onLoadView:t.onLoadView,onDeleteView:t.onDeleteView,onSetDefaultView:t.onSetDefaultView??(()=>{}),onResetToDefault:t.onResetToDefault})}function _t({prospect:t,onClose:d,onUpdated:p,isCreating:l=!1}){const{updateProspect:x,createProspect:y,deleteProspect:C,updating:S,deleting:i}=We(),o=t?tt(t):null,u=c.useCallback(async f=>{if(l){const g=Se(f);return await y(g)?(p(),!0):!1}if(!t)return!1;const _=Se(f);return await x(t.id,_)?(p(),!0):!1},[l,t,y,x,p]),m=c.useCallback(async()=>{if(!t)return!1;const f=await C(t.id);return f&&(d(),p()),f},[t,C,d,p]);return e.jsx(st,{contact:o,contactType:"prospect",onClose:d,onSave:u,onDelete:l?void 0:m,isCreating:l,saving:S,deleting:i})}const kt=["January","February","March","April","May","June","July","August","September","October","November","December"];function Pt({summary:t,loading:d,hasActiveFilters:p}){const l=i=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(i),x=new Date,y=i=>{const o=(x.getMonth()+i)%12;return kt[o]},C=t?.monthlyData||[],S=[{label:p?"Filtered Prospects":"All Prospects",dollarAmount:l(t?.totalEstimatedValue||0),showPerMonth:!0,rows:[{label:"Total",value:t?.totalProspects||0},{label:"Committed",value:`${t?.hotCount||0} (${l(t?.hotValue||0)})`},{label:"Interested",value:`${t?.warmCount||0} (${l(t?.warmValue||0)})`},{label:"Aware",value:`${t?.coldCount||0} (${l(t?.coldValue||0)})`}],icon:Le,color:"text-emerald-600 dark:text-emerald-400",bgColor:"bg-emerald-50 dark:bg-emerald-950/30"},...[0,1,2].map(i=>{const o=C[i],u=y(i),m=i===0;return{label:u,dollarAmount:l(o?.value||0),showPerMonth:!0,isCurrentMonth:m,rows:[{label:"Prospects",value:o?.count||0},{label:"Committed",value:`${o?.hotCount||0} (${l(o?.hotValue||0)})`},{label:"Interested",value:`${o?.warmCount||0} (${l(o?.warmValue||0)})`},{label:"Aware",value:`${o?.coldCount||0} (${l(o?.coldValue||0)})`}],icon:m?at:Fe,color:m?"text-blue-600 dark:text-blue-400":i===1?"text-purple-600 dark:text-purple-400":"text-amber-600 dark:text-amber-400",bgColor:m?"bg-blue-50 dark:bg-blue-950/30":i===1?"bg-purple-50 dark:bg-purple-950/30":"bg-amber-50 dark:bg-amber-950/30"}})];return d?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:S.map((i,o)=>e.jsx(_e,{className:"border-border/50",children:e.jsxs(ke,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:i.label}),e.jsx("div",{className:`p-2 rounded-lg ${i.bgColor}`,children:e.jsx(i.icon,{className:`h-4 w-4 ${i.color}`})})]}),e.jsx(ce,{className:"h-6 w-6 animate-spin text-muted-foreground"})]})},o))}):e.jsxs("div",{className:"space-y-2",children:[p&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{variant:"secondary",className:"text-xs",children:"Filtered Results"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Metrics reflect your current filter selection"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:S.map((i,o)=>e.jsx(_e,{className:"border-border/50",children:e.jsxs(ke,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:`p-2 rounded-lg ${i.bgColor}`,children:e.jsx(i.icon,{className:`h-4 w-4 ${i.color}`})}),e.jsxs("p",{className:"text-xs font-medium text-muted-foreground",children:[i.label,i.isCurrentMonth&&e.jsx("span",{className:"ml-1 text-xs text-primary",children:"(Current)"})]})]}),e.jsx("div",{className:"mb-2",children:e.jsxs("p",{className:"text-2xl font-bold text-foreground",children:[i.dollarAmount,i.showPerMonth&&e.jsx("span",{className:"text-sm font-normal text-muted-foreground",children:"/mo"})]})}),e.jsx("div",{className:"space-y-1",children:i.rows.map((u,m)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:[u.label,":"]}),e.jsx("span",{className:"font-medium text-foreground",children:u.value})]},m))})]})},o))})]})}function ys(){const{preferences:t,loading:d,setSort:p,setFilter:l,clearFilters:x,setRowsPerPage:y,setColumnOrder:C,setColumnWidth:S,toggleColumnVisibility:i,saveView:o,loadView:u,deleteView:m,setDefaultView:f,resetToDefault:_}=ft(),[v,g]=c.useState(1),[D,H]=c.useState(""),[I,k]=c.useState(""),[R,J]=c.useState(null),[L,F]=c.useState(!1),[U,P]=c.useState(!1),[O,X]=c.useState(!1),[z,ee]=c.useState(!1),[G,Y]=c.useState(!1),te=r=>{H(r);const n=setTimeout(()=>{k(r),g(1)},300);return()=>clearTimeout(n)},{prospects:xe,total:q,totalPages:M,loading:se,summary:pe,refetch:ae}=bt({page:v,limit:t.rowsPerPage,sortColumn:t.sortColumn,sortDirection:t.sortDirection,search:I,filters:t.activeFilters}),ge=r=>{J(r),P(!1),F(!0)},Q=()=>{F(!1),J(null),P(!1)},re=()=>{ae()},fe=r=>{const n=t.sortColumn===r&&t.sortDirection==="asc"?"desc":"asc";p(r,n),g(1)},ne=(r,n)=>{l(r,n),g(1)},le=()=>{x(),g(1)},be=r=>{y(parseInt(r)),g(1)},s=()=>{J(null),P(!0),F(!0)},a=Object.keys(t.activeFilters).length;return d?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(ce,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{children:e.jsx("title",{children:"Prospects | Admin"})}),e.jsxs("div",{className:"flex flex-col h-[calc(100vh-64px)] overflow-hidden",children:[e.jsxs("div",{className:"flex-shrink-0 p-6 pb-4 space-y-4 bg-background",children:[e.jsx(Pt,{summary:pe,loading:se,hasActiveFilters:a>0||I.length>0}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Prospects"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[q," total prospects"]})]}),e.jsxs("div",{className:"flex items-center gap-1 border-l pl-6",children:[e.jsx(T,{variant:t.activeViewName===null?"secondary":"ghost",size:"sm",onClick:_,className:"text-sm",children:"All"}),t.savedViews.map(r=>e.jsx(T,{variant:t.activeViewName===r.name?"secondary":"ghost",size:"sm",onClick:()=>u(r.name),className:"text-sm",children:r.name},r.name)),t.savedViews.length<3&&e.jsxs(T,{variant:"ghost",size:"sm",onClick:()=>Y(!0),className:"text-sm text-muted-foreground",children:[e.jsx(Ue,{className:"h-3 w-3 mr-1"}),"Save View"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(A,{placeholder:"Search prospects...",value:D,onChange:r=>te(r.target.value),className:"pl-9 w-64"})]}),e.jsxs(Pe,{open:O,onOpenChange:X,children:[e.jsx(Te,{asChild:!0,children:e.jsxs(T,{variant:"outline",className:"relative",children:[e.jsx(ht,{className:"h-4 w-4 mr-2"}),"Filters",a>0&&e.jsx("span",{className:"absolute -top-1 -right-1 h-5 w-5 rounded-full bg-primary text-primary-foreground text-xs flex items-center justify-center",children:a})]})}),e.jsx(De,{className:"w-80",align:"end",children:e.jsx(Ct,{activeFilters:t.activeFilters,onFilterChange:ne,onClearFilters:le})})]}),e.jsxs(Pe,{open:z,onOpenChange:ee,children:[e.jsx(Te,{asChild:!0,children:e.jsxs(T,{variant:"outline",children:[e.jsx(xt,{className:"h-4 w-4 mr-2"}),"Columns"]})}),e.jsx(De,{className:"w-80",align:"end",children:e.jsx(St,{columnOrder:t.columnOrder,hiddenColumns:t.hiddenColumns,savedViews:t.savedViews,activeViewName:t.activeViewName,onColumnOrderChange:C,onToggleColumn:i,onLoadView:u,onDeleteView:m,onResetToDefault:_})})]}),e.jsxs(T,{onClick:s,children:[e.jsx(pt,{className:"h-4 w-4 mr-2"}),"Add Prospect"]})]})]}),a>0&&e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Active filters:"}),Object.entries(t.activeFilters).map(([r,n])=>e.jsxs(T,{variant:"secondary",size:"sm",onClick:()=>ne(r,""),className:"h-6 text-xs",children:[r,": ",n,e.jsx(Ne,{className:"h-3 w-3 ml-1"})]},r)),e.jsx(T,{variant:"ghost",size:"sm",onClick:le,className:"h-6 text-xs",children:"Clear all"})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden px-6",children:e.jsx("div",{className:"border rounded-lg h-full overflow-auto",children:e.jsx(vt,{prospects:xe,loading:se,columnOrder:t.columnOrder,hiddenColumns:t.hiddenColumns,columnWidths:t.columnWidths,sortColumn:t.sortColumn,sortDirection:t.sortDirection,onSort:fe,onProspectClick:ge,onColumnResize:S,onColumnReorder:C,onProspectUpdated:ae})})}),e.jsx("div",{className:"flex-shrink-0 px-6 py-4 bg-background border-t",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Rows per page:"}),e.jsxs(de,{value:t.rowsPerPage.toString(),onValueChange:be,children:[e.jsx(ue,{className:"w-20",children:e.jsx(me,{})}),e.jsxs(he,{children:[e.jsx(B,{value:"25",children:"25"}),e.jsx(B,{value:"50",children:"50"}),e.jsx(B,{value:"100",children:"100"})]})]}),e.jsxs("span",{className:"text-sm text-muted-foreground ml-4",children:["Showing ",(v-1)*t.rowsPerPage+1," - ",Math.min(v*t.rowsPerPage,q)," of ",q]})]}),M>1&&e.jsx(ot,{children:e.jsxs(ct,{children:[e.jsx(we,{children:e.jsx(dt,{onClick:()=>g(r=>Math.max(1,r-1)),className:v===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:Math.min(5,M)},(r,n)=>{const h=v<=3?n+1:v+n-2;return h<1||h>M?null:e.jsx(we,{children:e.jsx(ut,{onClick:()=>g(h),isActive:v===h,className:"cursor-pointer",children:h})},h)}),e.jsx(we,{children:e.jsx(mt,{onClick:()=>g(r=>Math.min(M,r+1)),className:v===M?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})})]}),e.jsx(rt,{open:L,onOpenChange:F,children:e.jsxs(nt,{className:"w-full sm:max-w-xl overflow-y-auto",children:[e.jsx(lt,{children:e.jsx(it,{children:U?"Add Prospect":"Prospect Details"})}),e.jsx(_t,{prospect:R,onClose:Q,onUpdated:re,isCreating:U})]})}),e.jsx(ze,{open:G,onOpenChange:Y,existingViewNames:t.savedViews.map(r=>r.name),onSave:(r,n)=>{o(r)&&n&&f(r)}})]})}export{ys as default};
