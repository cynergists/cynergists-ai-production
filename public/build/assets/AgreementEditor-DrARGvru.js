import{a as b,r as n,s as x,l as o,j as e,B as y,n as N,H as _,f as w}from"./app-CjsYDFmT.js";import{u as E,M as k}from"./MSAWorkflow-BPVYOvwV.js";/* empty css            */import"./index-BnQVtZcd.js";import"./separator-Ve78g3In.js";import"./index-Dgr0VTlB.js";import"./dropdown-menu-zG8CxerM.js";import"./index-DBv-4Y1r.js";import"./index-G0k2b-8C.js";import"./Combination-Mg1W9W58.js";import"./index-CHEq1ta4.js";import"./check-BI7rB0RY.js";import"./circle-BFFpQF7i.js";import"./table-eclqq7yM.js";import"./dialog-vfH9N2qe.js";import"./index-58Jk2LJy.js";import"./scroll-area-CAOC7FXS.js";import"./index-BdQq_4o_.js";import"./alert-BViR3xpl.js";import"./chevron-up-CP4nq72x.js";import"./bell-gB8R7oTg.js";import"./square-pen-BxaxdQ49.js";import"./eye-DdZvHegw.js";import"./label-Dvt0WIie.js";import"./index-CSw9D2VK.js";import"./textarea-DjNE0yWa.js";import"./input-BBc2sdOt.js";import"./admin-api-BAkP0p9n.js";import"./triangle-alert-CdOhDIXa.js";import"./send-tLH8sm7e.js";const P={msa:{documentType:"msa",title:"Master Services Agreements",pageTitle:"Plans MSA | Admin",defaultContent:"<h1>Master Services Agreements</h1><p>Your master services agreements content here...</p>"},terms:{documentType:"terms",title:"Terms & Conditions",pageTitle:"Terms & Conditions | Admin",defaultContent:"<h1>Terms & Conditions</h1><p>Your terms and conditions content here...</p>"},privacy:{documentType:"privacy",title:"Privacy Policy",pageTitle:"Privacy Policy | Admin",defaultContent:"<h1>Privacy Policy</h1><p>Your privacy policy content here...</p>"},partner:{documentType:"partner",title:"Partner Agreements",pageTitle:"Partner Agreements | Admin",defaultContent:"<h1>Partner Agreements</h1><p>Your partner agreements content here...</p>"},"sales-reps":{documentType:"sales_reps",title:"Sales Agreements",pageTitle:"Sales Agreements | Admin",defaultContent:"<h1>Sales Agreements</h1><p>Your sales agreements content here...</p>"}};function ce({agreementType:l}){const{toast:p}=b(),[M,d]=n.useState(null),[u,h]=n.useState(null),[A,g]=n.useState(!0),[i,f]=n.useState(null),[T,v]=n.useState(!0),{callApi:a,loading:j}=E(),t=l?P[l]:null;n.useEffect(()=>{const{data:{subscription:r}}=x.auth.onAuthStateChange((s,m)=>{h(m),d(m?.user??null),m?g(!1):o.visit("/signin")});return x.auth.getSession().then(({data:{session:s}})=>{h(s),d(s?.user??null),s?g(!1):o.visit("/signin")}),()=>r.unsubscribe()},[navigate]),n.useEffect(()=>{u&&t&&c()},[u,t]);const c=async()=>{if(t){v(!0);try{const r=await a("get_active_document_template",{type:t.documentType});f(r)}catch(r){console.error(`Error loading ${t.title} template:`,r),f({id:"",title:t.title,content:t.defaultContent,version:1,document_type:t.documentType})}finally{v(!1)}}},C=async r=>{if(t){if(!i?.id){try{await a("create_document_template",{},{title:t.title,content:r,document_type:t.documentType}),await c(),p({title:"Success",description:`${t.title} created`})}catch{p({title:"Error",description:`Failed to create ${t.title}`,variant:"destructive"})}return}await a("update_document_template",{id:i.id},{content:r})}},S=async()=>{i?.id&&(await a("update_document_template",{id:i.id},{version:i.version+1}),await c())};return t?A||T?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx(N,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(e.Fragment,{children:[e.jsx(_,{children:e.jsx("title",{children:t.pageTitle})}),e.jsxs("div",{className:"flex flex-col h-screen overflow-hidden",children:[e.jsx("div",{className:"shrink-0 p-6 pb-2",children:e.jsxs(y,{variant:"ghost",size:"sm",onClick:()=>o.visit("/admin/agreements"),className:"mb-2",children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Back to Contracts"]})}),e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden px-6 pb-6",children:e.jsx(k,{template:i,onSaveContent:C,onUpdateVersion:S,isLoading:j})})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground mb-2",children:"Invalid Agreement Type"}),e.jsxs("p",{className:"text-muted-foreground mb-4",children:['The agreement type "',l,'" is not recognized.']}),e.jsx(y,{onClick:()=>o.visit("/admin/agreements"),children:"Back to Contracts"})]})})}export{ce as default};
