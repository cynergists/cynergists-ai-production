import{r as e,k as m}from"./app-DEGgoab9.js";function O({data:r,onSave:a,delay:l=1e3,enabled:S=!0,initialData:u,showToast:i=!0}){const[y,v]=e.useState(!1),[R,p]=e.useState(null),t=e.useRef(null),n=e.useRef(JSON.stringify(u??r)),o=e.useRef(!0),s=e.useRef(null);e.useEffect(()=>()=>{t.current&&clearTimeout(t.current)},[]),e.useEffect(()=>{u&&(n.current=JSON.stringify(u),o.current=!0)},[u]);const c=e.useCallback(async f=>{v(!0);try{await a(f)!==!1&&(p(new Date),n.current=JSON.stringify(f),i&&m.success("Saved",{duration:1500}))}catch(g){console.error("Auto-save failed:",g),i&&m.error("Failed to save changes")}finally{v(!1),s.current=null}},[a,i]);e.useEffect(()=>{if(!S)return;if(o.current){o.current=!1;return}JSON.stringify(r)!==n.current&&(s.current=r,t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{s.current&&c(s.current)},l))},[r,S,l,c]);const N=e.useCallback(async()=>{t.current&&clearTimeout(t.current),JSON.stringify(r)!==n.current&&await c(r)},[r,c]);return{isSaving:y,lastSaved:R,saveNow:N}}export{O as u};
