import{q as w,be as k,r as a,i as u,f as j,j as e,m as x,H as A,aC as E,X as L,B as S,t as I}from"./app-4HzrmfBH.js";import{I as P}from"./input-CBRyo5y3.js";import{L as _}from"./label-DFO8C8uk.js";import{u as T}from"./useDebounce-0FvemYhn.js";import{C as F}from"./check-Cdb1fOfs.js";/* empty css            */import"./index-BCi5JGFD.js";function Y(c){return c.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").substring(0,30)}function D(){const{toast:c}=w(),{data:i,isLoading:y}=k(),[l,h]=a.useState(""),[v,p]=a.useState(!1),[n,o]=a.useState(null),[g,r]=a.useState(""),[d,f]=a.useState(!1),m=T(l,500);a.useEffect(()=>{if(i?.company_name&&!l){const s=Y(i.company_name);s.length>=3&&h(s)}},[i?.company_name,l]),a.useEffect(()=>{i&&!i.is_temp_subdomain&&u.visit("/portal")},[i]);const b=a.useCallback(async s=>{if(s.length<3){o(null),r("Minimum 3 characters");return}p(!0);try{const t=await j.post("/api/portal/tenant/check-subdomain",{subdomain:s});o(t.available),t.available?r("Available!"):t.reason==="invalid_format"?r(t.message||"Invalid format"):r("Already taken")}catch(t){console.error("Error checking subdomain:",t),o(null),r("Error checking availability")}finally{p(!1)}},[]);a.useEffect(()=>{m?b(m):(o(null),r(""))},[m,b]);const N=s=>{const t=s.target.value.toLowerCase().replace(/[^a-z0-9-]/g,"");h(t),o(null),r("")},C=async()=>{if(!(!n||d)){f(!0);try{const s=await j.post("/api/portal/tenant/claim-subdomain",{subdomain:l});if(s.success)c({title:"Portal address claimed!",description:`Your portal is now at ${l}.cynergists.com`}),u.visit("/portal"),u.visit("/portal");else throw new Error(s.error||"Failed to claim subdomain")}catch(s){console.error("Error claiming subdomain:",s),c({title:"Failed to claim address",description:s instanceof Error?s.message:"Please try again.",variant:"destructive"})}finally{f(!1)}}};return y?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx(x,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(e.Fragment,{children:[e.jsx(A,{children:e.jsx("title",{children:"Choose Your Portal Address | Cynergists"})}),e.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-background",children:e.jsxs("div",{className:"w-full max-w-md bg-card border border-border rounded-2xl p-8 shadow-xl",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("img",{src:E,alt:"Cynergists",className:"h-10 w-auto"})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground mb-2",children:"Choose Your Portal Address"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your team will access your portal at this address"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"subdomain",children:"Portal Address"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(P,{id:"subdomain",value:l,onChange:N,placeholder:"your-company",className:"pr-10 bg-input border-border",maxLength:30}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:v?e.jsx(x,{className:"h-4 w-4 animate-spin text-muted-foreground"}):n===!0?e.jsx(F,{className:"h-4 w-4 text-green-500"}):n===!1?e.jsx(L,{className:"h-4 w-4 text-destructive"}):null})]}),e.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:".cynergists.com"})]}),g&&e.jsx("p",{className:`text-xs ${n?"text-green-500":n===!1?"text-destructive":"text-muted-foreground"}`,children:g})]}),e.jsx(S,{onClick:C,disabled:!n||d,className:"w-full bg-primary hover:bg-primary/90 text-primary-foreground font-semibold py-3",children:d?e.jsx(x,{className:"h-4 w-4 animate-spin"}):"Claim This Address"}),e.jsx("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsx("p",{children:e.jsx("strong",{children:"Tips:"})}),e.jsxs("ul",{className:"list-disc list-inside space-y-0.5",children:[e.jsx("li",{children:"Use lowercase letters, numbers, and hyphens"}),e.jsx("li",{children:"Keep it short and memorable"}),e.jsx("li",{children:"This cannot be changed later"})]})]})]})})]})]})})]})}export{D as default};
