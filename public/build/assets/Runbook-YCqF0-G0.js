import{c as w,r as o,j as e,B as n,L as r,g as W,R as d,F as L,C as y,U as b,s as t,e as S}from"./app-4HzrmfBH.js";import{C as h,b as m,c as u,d as j,a as x}from"./card-Bm8wZBfx.js";import{R as B}from"./refresh-cw-DKWV9xk1.js";import{T as g}from"./triangle-alert-BbkJ67nd.js";import{C as E}from"./circle-check-CNlsgO6M.js";import{E as q}from"./external-link-D_5Gt5zw.js";/* empty css            */const T=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],H=w("Book",T);const z=[["path",{d:"M18 16.98h-5.99c-1.1 0-1.95.94-2.48 1.9A4 4 0 0 1 2 17c.01-.7.2-1.4.57-2",key:"q3hayz"}],["path",{d:"m6 17 3.13-5.78c.53-.97.1-2.18-.5-3.1a4 4 0 1 1 6.89-4.06",key:"1go1hn"}],["path",{d:"m12 6 3.13 5.73C15.66 12.7 16.9 13 18 13a4 4 0 0 1 0 8",key:"qlwsc0"}]],A=w("Webhook",z);function G(){const[s,C]=o.useState({failedWebhooks:0,failedPayouts:0,failedReports:0,newFraudFlags:0,openDisputes:0,pendingReconciliation:0,highRiskPartners:0,unresolvedNotifications:0}),[N,v]=o.useState(!0),[R,P]=o.useState(new Date),k=async()=>{try{v(!0);const{count:c}=await t.from("webhook_events").select("*",{count:"exact",head:!0}).eq("status","failed"),{count:i}=await t.from("partner_payouts").select("*",{count:"exact",head:!0}).eq("status","failed"),f=0,{count:p}=await t.from("partners").select("*",{count:"exact",head:!0}).eq("has_fraud_flag",!0),{count:l}=await t.from("disputes").select("*",{count:"exact",head:!0}).eq("status","open"),{count:F}=await t.from("partner_payouts").select("*",{count:"exact",head:!0}).in("status",["scheduled","ready"]),{count:_}=await t.from("partners").select("*",{count:"exact",head:!0}).in("risk_level",["medium","high"]),{count:D}=await t.from("notifications").select("*",{count:"exact",head:!0}).is("resolved_at",null);C({failedWebhooks:c||0,failedPayouts:i||0,failedReports:f||0,newFraudFlags:p||0,openDisputes:l||0,pendingReconciliation:F||0,highRiskPartners:_||0,unresolvedNotifications:D||0}),P(new Date)}catch(c){console.error("Failed to fetch runbook stats:",c)}finally{v(!1)}};o.useEffect(()=>{k()},[]);const a=({label:c,value:i,link:f,icon:p,isWarning:l=!1})=>e.jsx(r,{href:f,children:e.jsxs("div",{className:`flex items-center justify-between p-4 rounded-lg border hover:bg-accent transition-colors ${l&&i>0?"border-destructive/50 bg-destructive/5":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p,{className:`h-5 w-5 ${l&&i>0?"text-destructive":"text-muted-foreground"}`}),e.jsx("span",{className:"font-medium",children:c})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{variant:l&&i>0?"destructive":"secondary",children:i}),e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]})]})});return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(H,{className:"h-6 w-6"}),"Operations Runbook"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Daily, weekly, and month-end operational checklists"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Last refresh: ",R.toLocaleTimeString()]}),e.jsxs(n,{onClick:k,variant:"outline",size:"sm",disabled:N,children:[e.jsx(B,{className:`h-4 w-4 mr-2 ${N?"animate-spin":""}`}),"Refresh"]})]})]}),s.unresolvedNotifications>0&&e.jsxs("div",{className:"p-4 rounded-lg border border-destructive/50 bg-destructive/5 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"h-5 w-5 text-destructive"}),e.jsxs("span",{className:"font-medium",children:[s.unresolvedNotifications," unresolved system notification",s.unresolvedNotifications>1?"s":""]})]}),e.jsx(n,{variant:"destructive",size:"sm",asChild:!0,children:e.jsx(r,{href:"/admin/notifications",children:"View Notifications"})})]}),e.jsxs(h,{children:[e.jsxs(m,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),"Daily Checks"]}),e.jsx(j,{children:"Review these items every day to catch issues early"})]}),e.jsxs(x,{className:"space-y-3",children:[e.jsx(a,{label:"Failed Webhooks",value:s.failedWebhooks,link:"/admin/tracking",icon:A,isWarning:!0}),e.jsx(a,{label:"Failed Payouts",value:s.failedPayouts,link:"/admin/payouts",icon:d,isWarning:!0}),e.jsx(a,{label:"Failed Reports (7 days)",value:s.failedReports,link:"/admin/tracking",icon:L,isWarning:!0}),e.jsx(a,{label:"Partners with Fraud Flags",value:s.newFraudFlags,link:"/admin/partners?filter=fraud",icon:g,isWarning:!0})]})]}),e.jsxs(h,{children:[e.jsxs(m,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),"Weekly Checks"]}),e.jsx(j,{children:"Review these items weekly to maintain system health"})]}),e.jsxs(x,{className:"space-y-3",children:[e.jsx(a,{label:"Open Dispute Backlog",value:s.openDisputes,link:"/admin/disputes",icon:g,isWarning:s.openDisputes>5}),e.jsx(a,{label:"Pending Reconciliation Items",value:s.pendingReconciliation,link:"/admin/payouts",icon:d}),e.jsx(a,{label:"Medium/High Risk Partners",value:s.highRiskPartners,link:"/admin/partners?filter=risk",icon:b,isWarning:s.highRiskPartners>0})]})]}),e.jsxs(h,{children:[e.jsxs(m,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),"Month-End Checks"]}),e.jsx(j,{children:"Critical tasks for month-end close and payout processing"})]}),e.jsx(x,{className:"space-y-4",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border",children:[e.jsx("input",{type:"checkbox",className:"h-5 w-5 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Payout Batch Created (16th)"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"On the 16th of each month, verify payout batches are created for all eligible commissions"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border",children:[e.jsx("input",{type:"checkbox",className:"h-5 w-5 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Payout Execution (1st)"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"On the 1st of each month (or next business day), execute all ready payouts"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border",children:[e.jsx("input",{type:"checkbox",className:"h-5 w-5 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Report Schedules Current"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Verify all active report schedules have next_run_at in the future"})]})]}),e.jsxs("div",{className:"flex items-start gap-3 p-4 rounded-lg border",children:[e.jsx("input",{type:"checkbox",className:"h-5 w-5 mt-0.5"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Reconcile Commission Totals"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Verify payout totals match sum of linked commissions"})]})]})]})})]}),e.jsxs(h,{children:[e.jsx(m,{children:e.jsx(u,{children:"Quick Links"})}),e.jsx(x,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(n,{variant:"outline",asChild:!0,className:"h-auto py-3",children:e.jsxs(r,{href:"/admin/partners",className:"flex flex-col items-center gap-1",children:[e.jsx(b,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm",children:"Partners"})]})}),e.jsx(n,{variant:"outline",asChild:!0,className:"h-auto py-3",children:e.jsxs(r,{href:"/admin/commissions",className:"flex flex-col items-center gap-1",children:[e.jsx(d,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm",children:"Commissions"})]})}),e.jsx(n,{variant:"outline",asChild:!0,className:"h-auto py-3",children:e.jsxs(r,{href:"/admin/payouts",className:"flex flex-col items-center gap-1",children:[e.jsx(d,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm",children:"Payouts"})]})}),e.jsx(n,{variant:"outline",asChild:!0,className:"h-auto py-3",children:e.jsxs(r,{href:"/admin/launch-checklist",className:"flex flex-col items-center gap-1",children:[e.jsx(E,{className:"h-5 w-5"}),e.jsx("span",{className:"text-sm",children:"Launch Checklist"})]})})]})})]})]})})}export{G as default};
