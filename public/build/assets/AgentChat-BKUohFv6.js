import{as as q,r as a,u as y,j as e,n as p,B as N,L as A,d as L,b as d,a as v,h as x,f as h,i as g}from"./app-C9sJHYCL.js";import{C as b}from"./card-xM_T_QEq.js";import{I as k}from"./input-BIyZmrfA.js";import{S as R}from"./scroll-area-C84zghn6.js";import{u as M}from"./useMutation-Dhp3buk0.js";import{U as $}from"./user-KPGr3U8Z.js";import{S as B}from"./send-CAL3Q9oR.js";/* empty css            */import"./index-mEKJzlVy.js";import"./index-BdQq_4o_.js";function P({agentId:r}){const w=q(),[c,j]=a.useState(""),[n,m]=a.useState([]),[i,f]=a.useState(!1),u=a.useRef(null),S=a.useRef(null),{data:t,isLoading:C}=y({queryKey:["agent-details",r],queryFn:async()=>{if(!r)return null;try{const s=await h.get(`/api/portal/agents/${r}`);return s.agent?s.agent.is_active?s.agent:(x.error("This agent is no longer active"),g.visit("/portal/agents"),null):(x.error("Agent not found"),g.visit("/portal/agents"),null)}catch(s){return console.error("Error fetching agent:",s),x.error("Agent not found"),g.visit("/portal/agents"),null}},enabled:!!r}),{data:l}=y({queryKey:["agent-conversation",r],queryFn:async()=>{if(!r)return null;try{return(await h.get(`/api/portal/agents/${r}/conversation`)).conversation}catch(s){return console.error("Error loading conversation:",s),null}},enabled:!!r});a.useEffect(()=>{if(l?.messages)try{const s=typeof l.messages=="string"?JSON.parse(l.messages):l.messages;m(s)}catch(s){console.error("Error parsing messages:",s)}},[l]),a.useEffect(()=>{u.current&&(u.current.scrollTop=u.current.scrollHeight)},[n]);const E=M({mutationFn:async s=>{if(!t||!r)throw new Error("No agent selected");const o=[...n,{role:"user",content:s}];return m(o),f(!0),await h.post(`/api/portal/agents/${r}/message`,{message:s})},onSuccess:s=>{f(!1),m(s.messages),w.invalidateQueries({queryKey:["agent-details",r]})},onError:s=>{f(!1),x.error(s.message),m(o=>o.slice(0,-1))}}),_=s=>{s.preventDefault(),!(!c.trim()||i)&&(E.mutate(c.trim()),j(""))};return C?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(p,{className:"h-8 w-8 animate-spin text-primary"})}):t?e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"border-b border-border p-4 flex items-center gap-4",children:[e.jsx(N,{variant:"ghost",size:"icon",asChild:!0,children:e.jsx(A,{href:"/portal/agents",children:e.jsx(L,{className:"h-4 w-4"})})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(d,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-semibold",children:t.agent_name}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:t.agent_type})]})]}),t.usage_limit&&e.jsxs("div",{className:"ml-auto text-sm text-muted-foreground",children:[t.usage_count||0," / ",t.usage_limit," messages"]})]}),e.jsx(R,{className:"flex-1 p-4",ref:u,children:e.jsxs("div",{className:"max-w-3xl mx-auto space-y-4",children:[n.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(d,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Start a conversation"}),e.jsxs("p",{className:"text-muted-foreground",children:["Ask ",t.agent_name," anything. I'm here to help!"]})]}):n.map((s,o)=>e.jsxs("div",{className:v("flex gap-3",s.role==="user"?"justify-end":"justify-start"),children:[s.role==="assistant"&&e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(d,{className:"h-5 w-5 text-primary"})}),e.jsx(b,{className:v("px-4 py-3 max-w-[80%]",s.role==="user"?"bg-primary text-primary-foreground":"bg-muted"),children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:s.content})}),s.role==="user"&&e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary flex items-center justify-center flex-shrink-0",children:e.jsx($,{className:"h-5 w-5 text-primary-foreground"})})]},o)),i&&n[n.length-1]?.role!=="assistant"&&e.jsxs("div",{className:"flex gap-3 justify-start",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(d,{className:"h-5 w-5 text-primary"})}),e.jsx(b,{className:"px-4 py-3 bg-muted",children:e.jsx(p,{className:"h-4 w-4 animate-spin"})})]})]})}),e.jsx("div",{className:"border-t border-border p-4",children:e.jsxs("form",{onSubmit:_,className:"max-w-3xl mx-auto flex gap-2",children:[e.jsx(k,{ref:S,value:c,onChange:s=>j(s.target.value),placeholder:`Message ${t.agent_name}...`,disabled:i,className:"flex-1"}),e.jsx(N,{type:"submit",disabled:!c.trim()||i,children:i?e.jsx(p,{className:"h-4 w-4 animate-spin"}):e.jsx(B,{className:"h-4 w-4"})})]})})]}):null}export{P as default};
